var Midi=(function(){var e={NOTE_OFF:128,NOTE_ON:144,KEY_PRESSURE:160,CONTROL_CHANGE:176,PROGRAM_CHANGE:192,CHANNEL_PRESSURE:208,PITCH_BEND:224,SYSTEM:240,INVALID:0,isStatus:function(s){return s!=e.INVALID&&e.STRING_TABLE[s]!=null},toString:function(s){return e.STRING_TABLE[s]}};e.STRING_TABLE={};e.STRING_TABLE[e.NOTE_OFF]="NOTE_OFF";e.STRING_TABLE[e.NOTE_ON]="NOTE_ON";e.STRING_TABLE[e.KEY_PRESSURE]="KEY_PRESSURE";e.STRING_TABLE[e.CONTROL_CHANGE]="CONTROL_CHANGE";e.STRING_TABLE[e.PROGRAM_CHANGE]="PROGRAM_CHANGE";e.STRING_TABLE[e.CHANNEL_PRESSURE]="CHANNEL_PRESSURE";e.STRING_TABLE[e.PITCH_BEND]="PITCH_BEND";e.STRING_TABLE[e.SYSTEM]="SYSTEM";e.STRING_TABLE[e.INVALID]="INVALID";function a(s){this.status=typeof(s)==="undefined"?0:s}a.prototype.encode=function(s){};a.prototype.toString=function(){return"[Message(status="+e.toString(this.status)+")]"};function f(t,s,u){a.call(this,t);this.data1=typeof(s)==="undefined"?0:s;this.data2=typeof(u)==="undefined"?0:u}f.prototype=new a();f.prototype.combinedData=function(){var s=this.data2;s<<=7;s|=this.data1;return s};function g(t,u,s,v){f.call(this,t,s,v);this.channel=typeof(u)==="undefined"?0:u}g.prototype=new f();g.prototype.encode=function(s){s.writeByte(this.status|this.channel);s.writeByte(Math.round(this.data1));s.writeByte(Math.round(this.data2))};g.prototype.toString=function(){return"[ChannelMessage(status="+e.toString(this.status)+" channel="+this.channel+" data1="+this.data1.toString(16)+" data2="+this.data2.toString(16)+")]"};function m(t,u,s,v){g.call(this,t,u,s,v)}m.prototype=new g();m.prototype.octave=function(){return Math.floor(this.data1/12)-1};m.prototype.pitch=function(){return this.data1};m.prototype.note=function(){return this.pitch()%12};m.prototype.velocity=function(){return this.data2};m.prototype.toString=function(){return"[VoiceMessage(status="+e.toString(this.status)+" channel="+this.channel+" note="+p.toString(this.note())+" octave="+this.octave()+" velocity="+this.velocity()+")]"};var p={C:0,C_SHARP:1,D:2,D_SHARP:3,E:4,F:5,F_SHARP:6,G:7,G_SHARP:8,A:9,A_SHARP:10,B:11,toString:function(s){switch(s){case this.C:return"C";case this.C_SHARP:return"C#";case this.D:return"D";case this.D_SHARP:return"D#";case this.E:return"E";case this.F:return"F";case this.F_SHARP:return"F#";case this.G:return"G";case this.G_SHARP:return"G#";case this.A:return"A";case this.A_SHARP:return"A#";case this.B:return"B"}return"UNKNOWN"}};var q={SEQUENCE_NUM:0,TEXT:1,COPYRIGHT:2,TRACK_NAME:3,INSTRUMENT_NAME:4,LYRIC:5,MARKER:6,CUE_POINT:7,PROGRAM_NAME:8,DEVICE_NAME:9,CHANNEL_PREFIX:32,MIDI_PORT:33,END_OF_TRACK:47,SET_TEMPO:81,SMPTE_OFFSET:84,TIME_SIGNATURE:88,KEY_SIGNATURE:89,SEQUENCER_SPECIFIC:127};var d={SYS_EX_START:0,MIDI_TIME_CODE:1,SONG_POSITION:2,SONG_SELECT:3,TUNE_REQUEST:6,SYS_EX_END:7,TIMING_CLOCK:8,START:10,CONTINUE:11,STOP:12,ACTIVE_SENSING:14,SYSTEM_RESET:15,toString:function(s){switch(s){case this.SYS_EX_START:return"SYS_EX_START";case this.MIDI_TIME_CODE:return"MIDI_TIME_CODE";case this.SONG_POSITION:return"SONG_POSITION";case this.SONG_SELECT:return"SONG_SELECT";case this.TUNE_REQUEST:return"TUNE_REQUEST";case this.SYS_EX_END:return"SYS_EX_END";case this.TIMING_CLOCK:return"TIMING_CLOCK";case this.START:return"START";case this.CONTINUE:return"CONTINUE";case this.STOP:return"STOP";case this.ACTIVE_SENSING:return"ACTIVE_SENSING";case this.SYSTEM_RESET:return"SYSTEM_RESET"}return"UNKNOWN"}};function i(s){a.call(this,d.SYSTEM_RESET);this.type=s}i.prototype=new a();function l(s){i.call(this,s)}l.prototype=new i();l.prototype.END_OF_TRACK=new l(q.END_OF_TRACK);l.prototype.encode=function(s){s.writeByte(255);s.writeByte(47);s.writeByte(0)};function c(t,s){g.call(this,e.PROGRAM_CHANGE,t,s)}c.prototype=new g();c.prototype.encode=function(s){s.writeByte(this.status|this.channel);s.writeByte(this.data1)};c.prototype.toString=function(){return"[ProgramChangeMessage(channel="+this.channel+" program="+this.data1+")]"};function h(s){i.call(this,q.SET_TEMPO);this.microsPerQuarter=s}h.prototype=new i();h.prototype.encode=function(s){s.writeByte(255);s.writeByte(81);o(s,3);s.writeByte((this.microsPerQuarter>>16)&255);s.writeByte((this.microsPerQuarter>>8)&255);s.writeByte((this.microsPerQuarter)&255)};h.prototype.toString=function(){return"[SetTempoMessage(microsPerQuarter="+this.microsPerQuarter+")]"};function b(t,s){this.eventTime=t;this.eventMessage=s}b.prototype.encode=function(s){o(s,this.eventTime);this.eventMessage.encode(s)};b.prototype.toString=function(){return"[MIDITrackEvent(time="+this.eventTime+" message="+this.eventMessage+")]"};function n(s){this.trackEvents=s}n.prototype.toString=function(){return"[MIDITrack(events=\n\t"+this.trackEvents.join("\n\t")+")]"};function k(t,u,s){this.fileFormat=t;this.midiDivision=u;this.midiTracks=s?s:[]}k.prototype.numTracks=function(){return this.midiTracks.length};k.prototype.toString=function(){return"[MIDIFile(format="+this.fileFormat+" division="+this.midiDivision+" numTracks="+this.midiTracks.length+" tracks=\n\t"+this.midiTracks.join("\n\t")+")]"};function j(){}j.prototype.MIDI_FILE_HEADER_TAG=1297377380;j.prototype.MIDI_FILE_HEADER_SIZE=6;j.prototype.MIDI_TRACK_HEADER_TAG=1297379947;j.prototype.encodeEvents=function(v,t){for(var s=0;s<t.length;s++){var u=t[s];u.encode(v)}};j.prototype.encodeFile=function(K,J){K.writeInt(this.MIDI_FILE_HEADER_TAG);K.writeInt(this.MIDI_FILE_HEADER_SIZE);var E=J.fileFormat;var s=J.midiTracks.length;var x=J.midiDivision;if(typeof(E)==="undefined"){logit("format undef...")}if(typeof(s)==="undefined"){logit("numtracks undef...")}if(typeof(x)==="undefined"){logit("divisiion undef...")}K.writeShort(E);K.writeShort(s);K.writeShort(x);var F=J.midiTracks;var B;var u;var I;var w;var A;var t;var C;var G;var z;var y;var H;for(var D=0;D<s;D++){B=F[D];t=B.trackEvents;K.writeInt(this.MIDI_TRACK_HEADER_TAG);var v=new FakeByteArray();this.encodeEvents(v,t);K.writeInt(v.length);K.appendByteArray(v)}};function o(x,v){var u=4294967167;var t=[];for(var w=0;w<4;w++){var s=v&u;var y=s&127;if(s){t.push(y)}v=v>>7}if(t.length==0){t.push(0)}for(w=t.length-1;w>=0;w--){y=t[w];if(w!=0){y=y|128}x.writeByte(y)}}function r(v,I){var x=[];if(typeof(v.midiTracks)==="undefined"){logit("Midi data missing midiTracks property<br />");return}if(typeof(v.midiTracks.length)==="undefined"){logit("Midi data midiTracks property not an array<br />");return}var w=v.midiTracks;w.push({});for(var G=0;G<w.length-1;G++){var A=[];var C=w[G];if(typeof(C.trackEvents)==="undefined"){return}var s=C.trackEvents;for(var E=0;E<s.length;E++){var F=s[E];if(typeof(F.eventTime)==="undefined"){return}var B=F.eventTime;if(typeof(F.eventMessage)==="undefined"){return}var t=F.eventMessage;if(typeof(t.messageClass)==="undefined"){return}var y=t.messageClass;var z=null;var J="";var D=0;switch(y){case"ChannelMessage":J=t.status;D=e.CONTROL_CHANGE;switch(J){case"CONTROL_CHANGE":D=e.CONTROL_CHANGE;break}z=new g(D,t.channel,t.data1,t.data2);break;case"VoiceMessage":J=t.status;D=e.NOTE_OFF;switch(J){case"NOTE_ON":D=e.NOTE_ON;break;case"NOTE_OFF":D=e.NOTE_OFF;break}z=new m(D,t.channel,t.data1,t.data2);break;case"EndTrackMessage":z=l.prototype.END_OF_TRACK;break;case"ProgramChangeMessage":z=new c(t.channel,t.program);break;case"SetTempoMessage":z=new h(t.microsPerQuarter);break}if(z!=null){A.push(new b(B,z))}else{logit("message was "+z+" "+y)}}x.push(new n(A))}var u=new k(v.fileFormat,v.midiDivisions,x);var H=new j();H.encodeFile(I,u)}return{encodeMidi:r}})();function FakeByteArray(){this.position=0;this.length=0;this.data=[];this.lengths=[]}FakeByteArray.prototype.toBuffer=function(){var a=new ArrayBuffer(this.length);var c=new DataView(a);var f=0;for(var b=0;b<this.data.length;b++){var g=this.data[b];var e=this.lengths[b];switch(e){case 1:c.setUint8(f,g);break;case 2:c.setUint16(f,g);break;case 4:c.setUint32(f,g);break}f+=e}return a};FakeByteArray.prototype.appendByteArray=function(a){for(var b=0;b<a.data.length;b++){var e=a.data[b];var c=a.lengths[b];switch(c){case 1:this.writeByte(e);break;case 2:this.writeShort(e);break;case 4:this.writeInt(e);break}}};FakeByteArray.prototype.writeByte=function(a){if(typeof(a)==="undefined"){logit("bad byte...")}this.length+=1;this.data[this.position]=a;this.lengths[this.position]=1;this.position+=1};FakeByteArray.prototype.writeInt=function(a){if(typeof(a)==="undefined"){logit("bad int...")}this.length+=4;this.data[this.position]=a;this.lengths[this.position]=4;this.position+=1};FakeByteArray.prototype.writeShort=function(a){if(typeof(a)==="undefined"){logit("bad short...")}this.length+=2;this.data[this.position]=a;this.lengths[this.position]=2;this.position+=1};var TWEEN=TWEEN||(function(){var a=[];return{REVISION:"7",getAll:function(){return a},removeAll:function(){a=[]},add:function(b){a.push(b)},remove:function(c){var b=a.indexOf(c);if(b!==-1){a.splice(b,1)}},update:function(d){if(a.length===0){return false}var c=0,b=a.length;d=d!==undefined?d:Date.now();while(c<b){if(a[c].update(d)){c++}else{a.splice(c,1);b--}}return true}}})();TWEEN.Tween=function(e){var m=e;var l={};var i={};var f=1000;var k=0;var b=null;var n=TWEEN.Easing.Linear.None;var a=TWEEN.Interpolation.Linear;var h=[];var d=null;var j=false;var g=null;var c=null;this.to=function(o,p){if(p!==null){f=p}i=o;return this};this.start=function(p){TWEEN.add(this);j=false;b=p!==undefined?p:Date.now();b+=k;for(var o in i){if(m[o]===null){continue}if(i[o] instanceof Array){if(i[o].length===0){continue}i[o]=[m[o]].concat(i[o])}l[o]=m[o]}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(o){k=o;return this};this.easing=function(o){n=o;return this};this.interpolation=function(o){a=o;return this};this.chain=function(){h=arguments;return this};this.onStart=function(o){d=o;return this};this.onUpdate=function(o){g=o;return this};this.onComplete=function(o){c=o;return this};this.update=function(u){if(u<b){return true}if(j===false){if(d!==null){d.call(m)}j=true}var q=(u-b)/f;q=q>1?1:q;var t=n(q);for(var s in l){var v=l[s];var p=i[s];if(p instanceof Array){m[s]=a(p,t)}else{m[s]=v+(p-v)*t}}if(g!==null){g.call(m,t)}if(q==1){if(c!==null){c.call(m)}for(var r=0,o=h.length;r<o;r++){h[r].start(u)}return false}return true}};TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){if((a*=2)<1){return 0.5*a*a}return -0.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return --a*a*a+1},InOut:function(a){if((a*=2)<1){return 0.5*a*a*a}return 0.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1-(--a*a*a*a)},InOut:function(a){if((a*=2)<1){return 0.5*a*a*a*a}return -0.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return --a*a*a*a*a+1},InOut:function(a){if((a*=2)<1){return 0.5*a*a*a*a*a}return 0.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return 0.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return a===0?0:Math.pow(1024,a-1)},Out:function(a){return a===1?1:1-Math.pow(2,-10*a)},InOut:function(a){if(a===0){return 0}if(a===1){return 1}if((a*=2)<1){return 0.5*Math.pow(1024,a-1)}return 0.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1-(--a*a))},InOut:function(a){if((a*=2)<1){return -0.5*(Math.sqrt(1-a*a)-1)}return 0.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(c){var d,b=0.1,e=0.4;if(c===0){return 0}if(c===1){return 1}if(!b||b<1){b=1;d=e/4}else{d=e*Math.asin(1/b)/(2*Math.PI)}return -(b*Math.pow(2,10*(c-=1))*Math.sin((c-d)*(2*Math.PI)/e))},Out:function(c){var d,b=0.1,e=0.4;if(c===0){return 0}if(c===1){return 1}if(!b||b<1){b=1;d=e/4}else{d=e*Math.asin(1/b)/(2*Math.PI)}return(b*Math.pow(2,-10*c)*Math.sin((c-d)*(2*Math.PI)/e)+1)},InOut:function(c){var d,b=0.1,e=0.4;if(c===0){return 0}if(c===1){return 1}if(!b||b<1){b=1;d=e/4}else{d=e*Math.asin(1/b)/(2*Math.PI)}if((c*=2)<1){return -0.5*(b*Math.pow(2,10*(c-=1))*Math.sin((c-d)*(2*Math.PI)/e))}return b*Math.pow(2,-10*(c-=1))*Math.sin((c-d)*(2*Math.PI)/e)*0.5+1}},Back:{In:function(a){var b=1.70158;return a*a*((b+1)*a-b)},Out:function(a){var b=1.70158;return --a*a*((b+1)*a+b)+1},InOut:function(a){var b=1.70158*1.525;if((a*=2)<1){return 0.5*(a*a*((b+1)*a-b))}return 0.5*((a-=2)*a*((b+1)*a+b)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){if(a<(1/2.75)){return 7.5625*a*a}else{if(a<(2/2.75)){return 7.5625*(a-=(1.5/2.75))*a+0.75}else{if(a<(2.5/2.75)){return 7.5625*(a-=(2.25/2.75))*a+0.9375}else{return 7.5625*(a-=(2.625/2.75))*a+0.984375}}}},InOut:function(a){if(a<0.5){return TWEEN.Easing.Bounce.In(a*2)*0.5}return TWEEN.Easing.Bounce.Out(a*2-1)*0.5+0.5}}};TWEEN.Interpolation={Linear:function(c,b){var a=c.length-1,g=a*b,d=Math.floor(g),e=TWEEN.Interpolation.Utils.Linear;if(b<0){return e(c[0],c[1],g)}if(b>1){return e(c[a],c[a-1],a-g)}return e(c[d],c[d+1>a?a:d+1],g-d)},Bezier:function(d,c){var a=0,h=d.length-1,f=Math.pow,g=TWEEN.Interpolation.Utils.Bernstein,e;for(e=0;e<=h;e++){a+=f(1-c,h-e)*f(c,e)*d[e]*g(h,e)}return a},CatmullRom:function(c,b){var a=c.length-1,g=a*b,d=Math.floor(g),e=TWEEN.Interpolation.Utils.CatmullRom;if(c[0]===c[a]){if(b<0){d=Math.floor(g=a*(1+b))}return e(c[(d-1+a)%a],c[d],c[(d+1)%a],c[(d+2)%a],g-d)}else{if(b<0){return c[0]-(e(c[0],c[0],c[1],c[1],-g)-c[0])}if(b>1){return c[a]-(e(c[a],c[a],c[a-1],c[a-1],g-a)-c[a])}return e(c[d?d-1:0],c[d],c[a<d+1?a:d+1],c[a<d+2?a:d+2],g-d)}},Utils:{Linear:function(c,b,a){return(b-c)*a+c},Bernstein:function(c,a){var b=TWEEN.Interpolation.Utils.Factorial;return b(c)/b(a)/b(c-a)},Factorial:(function(){var b=[1];return function(d){var c=1,a;if(b[d]){return b[d]}for(a=d;a>1;a--){c*=a}return b[d]=c}})(),CatmullRom:function(h,g,e,d,i){var f=(e-h)*0.5,c=(d-g)*0.5,b=i*i,a=i*b;return(2*g-2*e+f+c)*a+(-3*g+3*e-2*f-c)*b+f*i+g}}};var ClassicalNoise=function(b){if(b==undefined){b=Math}this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];this.p=[];for(var a=0;a<256;a++){this.p[a]=Math.floor(b.random()*256)}this.perm=[];for(var a=0;a<512;a++){this.perm[a]=this.p[a&255]}};ClassicalNoise.prototype.dot=function(b,a,d,c){return b[0]*a+b[1]*d+b[2]*c};ClassicalNoise.prototype.mix=function(d,c,e){return(1-e)*d+e*c};ClassicalNoise.prototype.fade=function(a){return a*a*a*(a*(a*6-15)+10)};ClassicalNoise.prototype.noise=function(s,r,p){var h=Math.floor(s);var f=Math.floor(r);var e=Math.floor(p);s=s-h;r=r-f;p=p-e;h=h&255;f=f&255;e=e&255;var c=this.perm[h+this.perm[f+this.perm[e]]]%12;var a=this.perm[h+this.perm[f+this.perm[e+1]]]%12;var o=this.perm[h+this.perm[f+1+this.perm[e]]]%12;var m=this.perm[h+this.perm[f+1+this.perm[e+1]]]%12;var F=this.perm[h+1+this.perm[f+this.perm[e]]]%12;var E=this.perm[h+1+this.perm[f+this.perm[e+1]]]%12;var L=this.perm[h+1+this.perm[f+1+this.perm[e]]]%12;var K=this.perm[h+1+this.perm[f+1+this.perm[e+1]]]%12;var k=this.dot(this.grad3[c],s,r,p);var H=this.dot(this.grad3[F],s-1,r,p);var D=this.dot(this.grad3[o],s,r-1,p);var i=this.dot(this.grad3[L],s-1,r-1,p);var j=this.dot(this.grad3[a],s,r,p-1);var G=this.dot(this.grad3[E],s-1,r,p-1);var C=this.dot(this.grad3[m],s,r-1,p-1);var g=this.dot(this.grad3[K],s-1,r-1,p-1);var B=this.fade(s);var A=this.fade(r);var t=this.fade(p);var d=this.mix(k,H,B);var b=this.mix(j,G,B);var q=this.mix(D,i,B);var n=this.mix(C,g,B);var J=this.mix(d,q,A);var I=this.mix(b,n,A);var l=this.mix(J,I,t);return l};function JQueryComponent(){this.$component=null;this.cssClassName="component";this.otherCssClasses=[];this.id="";this.tagName="div";this.children=[];this._constructorName="JQueryComponent"}JQueryComponent.prototype.counters={};JQueryComponent.prototype.setUniqueId=function(){var a=JQueryComponent.prototype.counters[this.cssClassName];if(!a){a=1}else{a++}JQueryComponent.prototype.counters[this.cssClassName]=a;this.id=this.cssClassName+"-"+a};JQueryComponent.prototype.hide=function(){this.$component.hide()};JQueryComponent.prototype.show=function(){this.$component.show()};JQueryComponent.prototype.addChild=function(a){this.children.push(a)};JQueryComponent.prototype.addStartHtmlString=function(a){a.push("<"+this.tagName+' class="'+this.cssClassName+(this.otherCssClasses.length>0?" "+this.otherCssClasses.join(" "):"")+'" '+(this.id?'id="'+this.id+'" ':"")+this.getTagAttributeString()+" >")};JQueryComponent.prototype.getTagAttributeString=function(){var a="";var c={};this.getTagAttributes(c);for(var b in c){a+=" "+b+'="'+c[b]+" "}return a};JQueryComponent.prototype.getTagAttributes=function(a){};JQueryComponent.prototype.addEndHtmlString=function(a){a.push("</"+this.tagName+">")};JQueryComponent.prototype.spawn=function(d){var a=[];this.createJQueryStrings(a);var c=$(a.join(""));var b=d.$component;if(!b){b=d}b.append(c);this.jQueryCreated(b)};JQueryComponent.prototype.jQueryCreated=function(c){var a="."+this.cssClassName;if(c.is(a)){this.$component=c}else{this.$component=c.find("."+this.cssClassName)}if(this.id){this.$component=this.$component.filter("#"+this.id)}for(var b=0;b<this.children.length;b++){this.children[b].jQueryCreated(c)}};JQueryComponent.prototype.createJQueryStrings=function(b){this.addStartHtmlString(b);this.getHtmlContentBeforeChildren(b);for(var a=0;a<this.children.length;a++){this.getHtmlContentBeforeChild(b,a);this.children[a].createJQueryStrings(b);this.getHtmlContentAfterChild(b,a)}this.getHtmlContentAfterChildren(b);this.addEndHtmlString(b)};JQueryComponent.prototype.getHtmlContentBeforeChildren=function(a){};JQueryComponent.prototype.getHtmlContentAfterChildren=function(a){};JQueryComponent.prototype.getHtmlContentBeforeChild=function(a,b){};JQueryComponent.prototype.getHtmlContentAfterChild=function(a,b){};JQueryComponent.prototype.enable=function(){};JQueryComponent.prototype.disable=function(){};function JQueryButton(a){JQueryComponent.call(this,a);this.tagName="button";this.text=getValueOrDefault(a,"text","");this.enableText=getValueOrDefault(a,"enableText",true);this.primaryIcon=getValueOrDefault(a,"primaryIcon","");this.secondaryIcon=getValueOrDefault(a,"secondaryIcon","");this.cssClassName="jquery-button";this.setUniqueId();this.clickListeners=[];this._constructorName="JQueryButton"}JQueryButton.prototype=new JQueryComponent();JQueryButton.prototype.enable=function(){this.$component.button("enable")};JQueryButton.prototype.disable=function(){this.$component.button("disable")};JQueryButton.prototype.jQueryCreated=function(a){JQueryComponent.prototype.jQueryCreated.call(this,a);var b={};b.text=this.enableText;if(this.primaryIcon||this.secondaryIcon){b.icons={};if(this.primaryIcon){b.icons.primary=this.primaryIcon}if(this.secondaryIcon){b.icons.secondary=this.secondaryIcon}}this.$component.button(b);this.$component.click(this,this.buttonClick)};JQueryButton.prototype.buttonClick=function(b){var a=b.data;$.each(a.clickListeners,function(c,d){d.clicked(d.data)})};JQueryButton.prototype.addClickListener=function(a){this.clickListeners.push(a);return this};JQueryButton.prototype.getHtmlContentBeforeChildren=function(a){a.push(this.text)};function JQueryPanel(){JQueryComponent.call(this);this._constructorName="JQueryPanel"}JQueryPanel.prototype=new JQueryComponent();function JQueryListItem(){JQueryPanel.call(this);this.cssClassName="list-item";this.otherCssClasses.push("ui-widget-content");this.tagName="li";this._constructorName="JQueryListItem"}JQueryListItem.prototype=new JQueryPanel();function JQueryVerticalListItemDragHandle(){JQueryComponent.call(this);this.iconClass="ui-icon-carat-2-n-s";this.otherCssClasses.push("vertical-list-item-drag-handle");this._constructorName="JQueryVerticalListItemDragHandle"}JQueryVerticalListItemDragHandle.prototype=new JQueryComponent();JQueryVerticalListItemDragHandle.prototype.getHtmlContentBeforeChildren=function(a){a.push("<span class='ui-icon "+this.iconClass+"'></span>")};var GuiPropertyDataType={INT:0,FLOAT:1,STRING:2,BOOLEAN:3,ID_REFERENCE:4,UNIQUE_ID:5,INT_LIST:6,INT_SET:7,INT_LIST_2D:8,FLOAT_LIST:9,FLOAT_SET:10,FLOAT_LIST_2D:11,STRING_LIST:12,STRING_SET:13,STRING_LIST_2D:14,BOOLEAN_LIST:15,BOOLEAN_LIST_2D:16,OBJECT_LIST:17,OBJECT:18,PROCEDURE:19,POSITIONED_1D_LIST:20,OTHER:21,ID_REFERENCE_LIST:22};var StringListPropertyDisplayHint={TEXT:0,TEXT_AREA:1,TEXT_LIST:2,SELECT_LIST:3};var NumberListPropertyDisplayHint={TEXT:0,TEXT_AREA:1,TEXT_LIST:2,SELECT_LIST:3};var NumberList2DPropertyDisplayHint={TEXT:0,TEXT_AREA:1,TEXT_LIST:2};var NumberPropertyDisplayHint={TEXT:0,SLIDER:1,SPINNER:2,COMBOBOX:3,LIST:4,TABLE:5,SPINNER_SLIDER:6,RADIO_BUTTON:7,SELECT:8};var StringPropertyDisplayHint={TEXT:0,COMBOBOX:1,LIST:2,TABLE:3,SELECT:4,TEXT_AREA:5};var BooleanPropertyDisplayHint={TEXT:0,COMBOBOX:1,RADIO_BUTTON:2,SELECT:3};var IdReferencePropertyDisplayHint={TEXT:0,COMBOBOX:1,RADIO_BUTTON:2,SELECT:3};var UniqueIdPropertyDisplayHint={TEXT:0};var ProcedureDisplayHint={BUTTON:0,SELECT:1,MENU:2};var ObjectDisplayHint={PANEL:0,DIALOG:1};var GuiListOrientation={VERTICAL:0,HORIZONTAL:1};var GuiDetailPanelMode={SHARE:0,SEPARATE:1,DIALOG:2};var GuiSplitType={TABS:0,ACCORDION:1,WINDOWS:2};var GuiNewMode={BUTTONS:0,SELECT:1,COMBOBOX:2,DIALOG:3};function GuiPropertyInfos(a){this.infos=getValueOrDefault(a,"infos",new Map(true))}GuiPropertyInfos.prototype.addPropertyInfo=function(a){this.infos.put(a.propertyName,a);return this};GuiPropertyInfos.prototype.getPropertyInfo=function(a){return this.infos.get(a)};GuiPropertyInfos.prototype.getAsArray=function(){return this.infos.listValues()};function IndentInfo(){this.level=0;this.whiteSpaceString=" "}IndentInfo.prototype.getWhiteSpaceString=function(){var a="";for(var b=0;b<this.level;b++){a+=this.whiteSpaceString}return a};function PropertyConstraint(){}PropertyConstraint.prototype.isValid=function(b,a,c){return true};PropertyConstraint.prototype.getInvalidDescription=function(b,a,c){return""};function RangePropertyConstraint(a){this.range=a||[0,1]}RangePropertyConstraint.prototype=new PropertyConstraint();RangePropertyConstraint.prototype.isValid=function(b,a,c){return c>=this.range[0]&&c<=this.range[1]};RangePropertyConstraint.prototype.getInvalidDescription=function(b,a,c){if(c<this.range[0]){return"Must be greater than or equal "+this.range[0]}if(c>this.range[1]){return"Must be less than or equal "+this.range[1]}return""};function MinPropertyConstraint(a){this.minValue=a}MinPropertyConstraint.prototype=new PropertyConstraint();MinPropertyConstraint.prototype.isValid=function(b,a,c){return c>=this.minValue};MinPropertyConstraint.prototype.getInvalidDescription=function(b,a,c){if(c<this.minValue){return"Must be greater than or equal "+this.minValue}return""};function MaxPropertyConstraint(a){this.maxValue=a}MaxPropertyConstraint.prototype=new PropertyConstraint();MaxPropertyConstraint.prototype.isValid=function(b,a,c){return c<=this.maxValue};MaxPropertyConstraint.prototype.getInvalidDescription=function(b,a,c){if(c>this.maxValue){return"Must be less than or equal "+this.maxValue}return""};function ArrayMinLengthConstraint(a){this.minLength=typeof(a)==="undefined"?1:a}ArrayMinLengthConstraint.prototype=new PropertyConstraint();ArrayMinLengthConstraint.prototype.isValid=function(b,a,c){return c.length>=this.minLength};ArrayMinLengthConstraint.prototype.getInvalidDescription=function(b,a,c){if(c.length<this.minLength){return"Must contain at least "+this.minLength+" "+(this.minLength==1?"item":"items")}return""};function ArrayElementConstraint(a){this.elementConstraint=a||{isValid:function(){return true},getInvalidDescription:function(){return""}}}ArrayElementConstraint.prototype=new PropertyConstraint();ArrayElementConstraint.prototype.isValid=function(b,a,d){if(this.elementConstraint){if(isArray(d)){for(var c=0;c<d.length;c++){if(!this.elementConstraint.isValid(b,a+"["+c+"]",d[c])){return false}}}}return true};ArrayElementConstraint.prototype.getInvalidDescription=function(b,a,e){if(this.elementConstraint){if(isArray(e)){for(var c=0;c<e.length;c++){var d=a+"["+c+"]";if(!this.elementConstraint.isValid(b,d,e[c])){return"Item "+(c+1)+": "+this.elementConstraint.getInvalidDescription(b,d,e[c])}}}}return""};function GuiSplitInfo(a){this.group=getValueOrDefault(a,"group","Group");this.groupCaption=getValueOrDefault(a,"groupCaption","");this.splitType=getValueOrDefault(a,"splitType",GuiSplitType.TABS)}function GuiListInfo(a){this.constructorInfos=getValueOrDefault(a,"constructorInfos",[]);this.newMode=getValueOrDefault(a,"newMode",GuiNewMode.BUTTONS);this.itemsDisplayFunction=getValueOrDefault(a,"itemsDisplayFunction",null);this.detailPanelMode=getValueOrDefault(a,"detailPanelMode",GuiDetailPanelMode.SEPARATE);this.possibleValues=getValueOrDefault(a,"possibleValues",[])}function GuiObjectInfo(a){this.constructorInfos=getValueOrDefault(a,"constructorInfos",[]);this.newMode=getValueOrDefault(a,"newMode",GuiNewMode.BUTTONS);this.canUnset=getValueOrDefault(a,"canUnset",true)}function GuiUniqueIdInfo(a){this.manager=getValueOrDefault(a,"manager",null);this.namespace=getValueOrDefault(a,"namespace","ns");this.initPrefix=getValueOrDefault(a,"initPrefix","id")}function GuiProcedureInfo(a){this.args=getValueOrDefault(a,"args",[]);this.targetObject=getValueOrDefault(a,"targetObject",null);this.group=getValueOrDefault(a,"group","procedureGroup")}function GuiConstructorInfo(a){this.name=getValueOrDefault(a,"name","");this.text=getValueOrDefault(a,"text","");this.nameIsConstructor=getValueOrDefault(a,"nameIsConstructor",true);this.createValue=getValueOrDefault(a,"createValue",function(){return 0})}function GuiPositioned1DListInfo(a){this.constructorInfos=getValueOrDefault(a,"constructorInfos",[]);this.newMode=getValueOrDefault(a,"newMode",GuiNewMode.BUTTONS);this.detailPanelMode=getValueOrDefault(a,"detailPanelMode",GuiDetailPanelMode.SEPARATE);this.positionPropertyName=getValueOrDefault(a,"positionPropertyName",null);this.lengthPropertyName=getValueOrDefault(a,"lengthPropertyName",null);this.allowOverlap=getValueOrDefault(a,"allowOverlap",false);this.positionSnapFunction=getValueOrDefault(a,"positionSnapFunction",null);this.lengthSnapFunction=getValueOrDefault(a,"lengthSnapFunction",null)}function GuiOtherInfo(a){this.componentConstructor=getValueOrDefault(a,"componentConstructor","");this.data=getValueOrDefault(a,"data",null)}function GuiPropertyInfo(a){this.propertyName=getValueOrDefault(a,"propertyName","propName");this.propertyCaption=getValueOrDefault(a,"propertyCaption","Prop. Caption");this.dataType=getValueOrDefault(a,"dataType",GuiPropertyDataType.INT);this.possibleValues=getValueOrDefault(a,"possibleValues",[]);this.defaultValue=getValueOrDefault(a,"defaultValue",0);this.allowNull=getValueOrDefault(a,"allowNull",false);this.displayHint=getValueOrDefault(a,"displayHint",NumberPropertyDisplayHint.TEXT);this.shortDescription=getValueOrDefault(a,"shortDescription",null);this.longDescription=getValueOrDefault(a,"longDescription",null);this.multilineDescription=getValueOrDefault(a,"multilineDescription",null);this.convertFunction=getValueOrDefault(a,"convertFunction",null);this.displayFunction=getValueOrDefault(a,"displayFunction",null);this.constraints=getValueOrDefault(a,"constraints",[]);this.splitInfo=getValueOrDefault(a,"splitInfo",null);this.listInfo=getValueOrDefault(a,"listInfo",null);this.objectInfo=getValueOrDefault(a,"objectInfo",null);this.uniqueIdInfo=getValueOrDefault(a,"uniqueIdInfo",null);this.procedureInfo=getValueOrDefault(a,"procedureInfo",null);this.positioned1DListInfo=getValueOrDefault(a,"positioned1DListInfo",null);this.propertyInfoProvider=getValueOrDefault(a,"propertyInfoProvider",null);this.otherInfo=getValueOrDefault(a,"otherInfo",null);this.componentRegisters=getValueOrDefault(a,"componentRegisters",[])}GuiPropertyInfo.prototype.getValue=function(a){};function traverseObject(e,d,b,h,f){try{if(e&&(typeof(e)==="object")){var m=d.getGuiPropertyInfos(e,h);var k=m.getAsArray();for(var g=0;g<k.length;g++){var a=k[g];b(e,a,f);if(a.dataType==GuiPropertyDataType.OBJECT_LIST){var n=e[a.propertyName];if(n){for(var c=0;c<n.length;c++){traverseObject(n[c],d,b,a,f)}}else{logit("Unable to get property "+a.propertyName+" from "+e+" ("+e._constructorName+") <br />")}}else{if(a.dataType==GuiPropertyDataType.OBJECT){var n=e[a.propertyName];traverseObject(n,d,b,h,f)}}}}}catch(l){showStacktraceDialog(l,"traverseObject() constructor: "+e._constructorName)}}function ComponentAlignmentInfo(){this.verticalOffsets=[]}ComponentAlignmentInfo.prototype.setVerticalOffset=function(b,c){var a=this.verticalOffsets[b];if(typeof a==="undefined"){a=c}this.verticalOffsets[b]=Math.max(a,c)};ComponentAlignmentInfo.prototype.getVerticalOffset=function(b){var a=this.verticalOffsets[b];if(typeof a==="undefined"){logit("vertical offset undefined");return 0}return a};function SplitComponent(b,c,a){JQueryComponent.call(this);this.object=b;this.groupMap=c;this.groupCaptions=a}SplitComponent.prototype=new JQueryComponent();SplitComponent.prototype.gatherAlignmentInfo=function(a){};SplitComponent.prototype.setAlignment=function(a){this.alignComponents()};SplitComponent.prototype.alignComponents=function(){for(var a=0;a<this.children.length;a++){var b=new ComponentAlignmentInfo();var c=this.children[a];c.gatherAlignmentInfo(b);c.setAlignment(b)}};function SplitTabsComponent(b,c,a){SplitComponent.call(this,b,c,a);this.cssClassId="ui-widget";this.groupMap.each(function(f,d){for(var e=0;e<d.length;e++){this.addChild(d[e])}},this);this.setUniqueId();this._constructorName="SplitTabsComponent"}SplitTabsComponent.prototype=new SplitComponent();SplitTabsComponent.prototype.createJQueryStrings=function(a){this.addStartHtmlString(a);a.push("<ul>");this.groupMap.each(function(e,b){var d=this.id+"-"+e;var c=this.groupCaptions.get(e);a.push("<li>");a.push("<a ");a.push('href="#'+d+'" ');a.push(">");a.push(c);a.push("</a>");a.push("</li>")},this);a.push("</ul>");this.groupMap.each(function(e,b){var c=this.id+"-"+e;a.push("<div ");a.push(' id="'+c+'" ');a.push(">");for(var d=0;d<b.length;d++){b[d].createJQueryStrings(a)}a.push("</div>")},this);this.addEndHtmlString(a)};SplitTabsComponent.prototype.jQueryCreated=function(a){JQueryComponent.prototype.jQueryCreated.call(this,a);this.$component.tabs()};function GuiPropertiesComponent(a){JQueryComponent.call(this);this.object=getValueOrDefault(a,"object",null);this.propertyInfoProvider=getValueOrDefault(a,"propertyInfoProvider",null);this.componentRegisters=getValueOrDefault(a,"componentRegisters",[]);this.parentPropertyInfo=getValueOrDefault(a,"parentPropertyInfo",null);this.passOnComponentRegisters=getValueOrDefault(a,"passOnComponentRegisters",true);this.propertyInfos=null;this.changeListeners=[];this.cssClassName="properties-component";this.otherCssClasses.push("ui-widget-content");if(this.object!=null){if(this.object.getGuiPropertyInfos){this.propertyInfos=this.object.getGuiPropertyInfos(this.parentPropertyInfo)}if(!this.propertyInfos&&this.propertyInfoProvider){this.propertyInfos=this.propertyInfoProvider.getGuiPropertyInfos(this.object,this.parentPropertyInfo)}if(!this.propertyInfos){logit("GuiPropertiesComponent missing propertyInfos for "+this.object+"<br />")}else{this.createComponents()}}this.setUniqueId();this._constructorName="GuiPropertiesComponent"}GuiPropertiesComponent.prototype=new JQueryComponent();GuiPropertiesComponent.prototype.componentRemoved=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.componentRemoved){b.componentRemoved()}}};GuiPropertiesComponent.prototype.gatherAlignmentInfo=function(a){};GuiPropertiesComponent.prototype.setAlignment=function(a){this.alignComponents()};GuiPropertiesComponent.prototype.alignComponents=function(){var b=new ComponentAlignmentInfo();for(var a=0;a<this.children.length;a++){var d=this.children[a];d.gatherAlignmentInfo(b)}for(var a=0;a<this.children.length;a++){var d=this.children[a];d.setAlignment(b)}};GuiPropertiesComponent.prototype.resetAlignment=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];b.resetAlignment()}};GuiPropertiesComponent.prototype.createIntComponent=function(a,b){switch(b.displayHint){case NumberPropertyDisplayHint.TEXT:return new IntegerTextComponent(a,b);case NumberPropertyDisplayHint.SELECT:return new IntegerSelectComponent(a,b);case NumberPropertyDisplayHint.RADIO_BUTTON:return new IntegerRadioButtonsComponent(a,b)}return null};GuiPropertiesComponent.prototype.createIntListComponent=function(a,b){switch(b.displayHint){case NumberListPropertyDisplayHint.TEXT:return new IntegerListTextComponent(a,b);case NumberListPropertyDisplayHint.SELECT_LIST:return new IntegerListSelectComponent(a,b)}return null};GuiPropertiesComponent.prototype.createIntList2DComponent=function(a,b){switch(b.displayHint){case NumberList2DPropertyDisplayHint.TEXT:return new IntegerList2DTextComponent(a,b)}return null};GuiPropertiesComponent.prototype.createFloatComponent=function(a,b){switch(b.displayHint){case NumberPropertyDisplayHint.TEXT:return new FloatTextComponent(a,b);case NumberPropertyDisplayHint.SELECT:return new FloatSelectComponent(a,b)}return null};GuiPropertiesComponent.prototype.createFloatListComponent=function(a,b){switch(b.displayHint){case NumberListPropertyDisplayHint.TEXT:return new FloatListTextComponent(a,b)}return null};GuiPropertiesComponent.prototype.createFloatList2DComponent=function(a,b){switch(b.displayHint){case NumberList2DPropertyDisplayHint.TEXT:return new FloatList2DTextComponent(a,b)}return null};GuiPropertiesComponent.prototype.createStringComponent=function(a,b){switch(b.displayHint){case StringPropertyDisplayHint.TEXT:return new StringTextComponent(a,b);case StringPropertyDisplayHint.TEXT_AREA:return new StringTextAreaComponent(a,b);case StringPropertyDisplayHint.SELECT:return new StringSelectComponent(a,b)}return null};GuiPropertiesComponent.prototype.createBooleanComponent=function(a,b){switch(b.displayHint){case BooleanPropertyDisplayHint.SELECT:return new BooleanSelectComponent(a,b)}return null};GuiPropertiesComponent.prototype.createIdReferenceComponent=function(a,b){switch(b.displayHint){case IdReferencePropertyDisplayHint.SELECT:return new IdReferenceSelectComponent(a,b)}return null};GuiPropertiesComponent.prototype.createIdReferenceListComponent=function(a,b){switch(b.displayHint){case IdReferencePropertyDisplayHint.SELECT:return new IdReferenceListSelectComponent(a,b)}return null};GuiPropertiesComponent.prototype.createUniqueIdComponent=function(a,b){switch(b.displayHint){case UniqueIdPropertyDisplayHint.TEXT:return new UniqueIdTextComponent(a,b)}return null};GuiPropertiesComponent.prototype.createProcedureComponent=function(a,b){switch(b.displayHint){case ProcedureDisplayHint.BUTTON:return new ProcedureButtonComponent(a,b)}return null};GuiPropertiesComponent.prototype.createOtherComponent=function(object,propertyInfo){var otherInfo=propertyInfo.otherInfo;if(otherInfo){var result=eval("new "+otherInfo.componentConstructor+"()");result.object=object;result.propertyInfo=propertyInfo;return result}return null};GuiPropertiesComponent.prototype.createObjectListComponent=function(a,b){return new GuiObjectListComponent(a,b)};GuiPropertiesComponent.prototype.createObjectComponent=function(a,b){return new GuiObjectComponent(a,b)};GuiPropertiesComponent.prototype.createSplitComponent=function(b,c,a,d){switch(d){case GuiSplitType.TABS:return new SplitTabsComponent(b,c,a)}return null};GuiPropertiesComponent.prototype.createComponent=function(b){var a=null;switch(b.dataType){case GuiPropertyDataType.INT:a=this.createIntComponent(this.object,b);break;case GuiPropertyDataType.INT_LIST:a=this.createIntListComponent(this.object,b);break;case GuiPropertyDataType.INT_LIST_2D:a=this.createIntList2DComponent(this.object,b);break;case GuiPropertyDataType.FLOAT:a=this.createFloatComponent(this.object,b);break;case GuiPropertyDataType.FLOAT_LIST:a=this.createFloatListComponent(this.object,b);break;case GuiPropertyDataType.FLOAT_LIST_2D:a=this.createFloatList2DComponent(this.object,b);break;case GuiPropertyDataType.BOOLEAN:a=this.createBooleanComponent(this.object,b);break;case GuiPropertyDataType.STRING:a=this.createStringComponent(this.object,b);break;case GuiPropertyDataType.ID_REFERENCE:a=this.createIdReferenceComponent(this.object,b);break;case GuiPropertyDataType.ID_REFERENCE_LIST:a=this.createIdReferenceListComponent(this.object,b);break;case GuiPropertyDataType.UNIQUE_ID:a=this.createUniqueIdComponent(this.object,b);break;case GuiPropertyDataType.SIMPLE_LIST:a=this.createSimpleListComponent(this.object,b);break;case GuiPropertyDataType.SIMPLE_SET:a=this.createSimpleSetComponent(this.object,b);break;case GuiPropertyDataType.OBJECT_LIST:a=this.createObjectListComponent(this.object,b);break;case GuiPropertyDataType.OBJECT:a=this.createObjectComponent(this.object,b);break;case GuiPropertyDataType.PROCEDURE:a=this.createProcedureComponent(this.object,b);break;case GuiPropertyDataType.OTHER:a=this.createOtherComponent(this.object,b);break}return a};GuiPropertiesComponent.prototype.createComponents=function(){var b=this.propertyInfos.getAsArray();var g=[];var j=new Map(true);var d=new Map(true);var h=this;for(var e=0;e<b.length;e++){var c=b[e];if(this.passOnComponentRegisters&&this.componentRegisters){c.componentRegisters=this.componentRegisters}var k=this.createComponent(c);k.changeListeners.push(function(q,n,p){for(var o=0;o<h.changeListeners.length;o++){h.changeListeners[o](h,h.object,h.object)}});if(k!=null){var m=c.splitInfo;if(m){var a=j.get(m.splitType);if(!a){a=new Map(true);j.put(m.splitType,a)}var f=a.get(m.group);if(!f){f=[];a.put(m.group,f)}f.push(k);if(m.groupCaption){d.put(m.group,m.groupCaption)}else{var l=d.get(m.group);if(!l){d.put(m.group,"Caption")}}}else{g.push(k)}}else{logit("Could not create a component for data type "+c.dataType+"<br />")}}for(var e=0;e<g.length;e++){this.addChild(g[e])}j.each(function(o,n){var i=this.createSplitComponent(this.object,n,d,o);this.addChild(i)},this)};function GuiPropertyComponent(c,d){JQueryComponent.call(this);this.object=c;this.propertyInfo=d;this.otherCssClasses.push("ui-widget");this.otherCssClasses.push("gui-property-component");this.changeListeners=[];this.hasValueTypeRadios=true;this.$valueType=null;if(this.propertyInfo){var a=this.propertyInfo.componentRegisters;if(a){for(var b=0;b<a.length;b++){a[b].registerComponent(this,this.propertyInfo)}}}this._constructorName="GuiPropertyComponent"}GuiPropertyComponent.prototype=new JQueryComponent();GuiPropertyComponent.prototype.callChangeListeners=function(){var b=this;for(var a=0;a<b.changeListeners.length;a++){b.changeListeners[a](b,b.object,b.object)}};GuiPropertyComponent.prototype.resetAlignment=function(){};GuiPropertyComponent.prototype.componentRemoved=function(){for(var d=0;d<this.children.length;d++){var e=this.children[d];if(e.componentRemoved){e.componentRemoved()}}if(this.propertyInfo){var a=this.propertyInfo.componentRegisters;if(a){for(var b=0;b<a.length;b++){a[b].unregisterComponent(this,this.propertyInfo)}}}};GuiPropertyComponent.prototype.cleanAfterDelete=function(a){if((typeof(a)==="object")&&this.propertyInfo.propertyInfoProvider){}};GuiPropertyComponent.prototype.createNewValue=function(constrInfo,parentPropInfo){var newValue=null;if(constrInfo.nameIsConstructor){newValue=eval("new "+constrInfo.name+"();");if(typeof(newValue)==="object"){}}else{newValue=constrInfo.createValue()}return newValue};GuiPropertyComponent.prototype.getConstructorsHtml=function(d,a,e){if(e==GuiNewMode.BUTTONS){for(var b=0;b<a.length;b++){var c=a[b];d.push("<button ");d.push("id='"+(this.newButtonIdPrefix+"-"+b)+"' ");d.push(">");d.push(c.text);d.push("</button>\n")}}else{logit("select new not supported yet...");for(var b=0;b<a.length;b++){var c=a[b]}}};GuiPropertyComponent.prototype.addConstructorClickListeners=function(b,c,d){var a=this;if(d==GuiNewMode.BUTTONS){$.each(b,function(e,f){var g=a.$component.find("#"+a.newButtonIdPrefix+"-"+e);var h={};h.label=f.text;h.text=true;h.icons={};h.icons.primary="ui-icon-plus";g.button(h);g.on("click",function(){c(f)})})}};GuiPropertyComponent.prototype.gatherAlignmentInfo=function(a){};GuiPropertyComponent.prototype.setAlignment=function(a){};GuiPropertyComponent.prototype.alignComponents=function(){};GuiPropertyComponent.prototype.getValue=function(){var a=this.object[this.propertyInfo.propertyName];if(typeof a==="undefined"){logit("property was undefined "+this.propertyInfo.propertyName+" in "+this.object._constructorName+"<br />");a=this.propertyInfo.defaultValue}if(!this.propertyInfo.allowNull&&a==null){logit("property was null "+this.propertyInfo.propertyName+" in "+this.object._constructorName+"<br />");a=this.propertyInfo.defaultValue}return a};GuiPropertyComponent.prototype.getExpressionPropertyName=function(){return this.propertyInfo.propertyName+"Expression"};GuiPropertyComponent.prototype.getUseExpressionPropertyName=function(){return this.propertyInfo.propertyName+"UseExpression"};GuiPropertyComponent.prototype.getValueExpression=function(){var a=this.getExpressionPropertyName();var b=this.object[a];if(!b){return""}return b};GuiPropertyComponent.prototype.getUniqueIdManager=function(){var a=this.propertyInfo.uniqueIdInfo;if(a){if(a.manager){return a.manager}else{logit("No uniquIdManager found in GuiPropertiesComponent<br />")}}else{logit("No uniquIdInfo found in GuiPropertiesComponent<br />")}return null};GuiPropertyComponent.prototype.getUniqueIdNamespace=function(){var a=this.propertyInfo.uniqueIdInfo;if(a){if(a.namespace){return a.namespace}else{logit("No namespace found in GuiPropertiesComponent<br />")}}else{logit("No namespace found in GuiPropertiesComponent<br />")}return null};GuiPropertyComponent.prototype.verifyNumberConstraints=function(g){var d=false;var a="";for(var b=0;b<this.propertyInfo.constraints.length;b++){var h=this.propertyInfo.constraints[b];if(h.getMinValue){var e=h.getMinValue();if(g<e){d=true;a="Must be greater than or equal "+e}}if(h.getMaxValue){var f=h.getMaxValue();if(g>f){d=true;a="Must be less than or equal "+f}}}this.setError(d,a);return d};GuiPropertyComponent.prototype.setValueVerify=function(f){var b=this.getValue();var e=true;if(b!=f){var a="";if(this.propertyInfo.possibleValues&&this.propertyInfo.possibleValues.length>0){if(!arrayContains(this.propertyInfo.possibleValues,f)){e=false;a="Must be one of: "+this.propertyInfo.possibleValues.join(", ")}}if(e&&this.propertyInfo.constraints){for(var d=0;d<this.propertyInfo.constraints.length;d++){var j=this.propertyInfo.constraints[d];if(j.isValid&&!j.isValid(this.object,this.propertyInfo.propertyName,f)){var g=j.getInvalidDescription(this.object,this.propertyInfo.propertyName,f);a=g;e=false;break}if(j.getPossibleValues){var h=j.getPossibleValues();if(!arrayContains(h,f)){e=false;a="Must be one of: "+h.join(", ");break}}}}if(e){this.setError(false,"");this.object[this.propertyInfo.propertyName]=f;for(var d=0;d<this.changeListeners.length;d++){this.changeListeners[d](this,b,f)}}else{this.setError(true,a)}}else{this.setError(false,"")}return e};GuiPropertyComponent.prototype.setError=function(a,b){};GuiPropertyComponent.prototype.setupExpressionInput=function(c){this.$expressionInput=this.$component.find("#"+this.id+"-expression-input");this.$expressionInput.css("width",c+"px");var a=this.getValueExpression();this.$expressionInput.val(a);var d=!!this.object[this.getUseExpressionPropertyName()];if(d){this.$input.hide()}else{this.$expressionInput.hide()}var b=this;this.$expressionInput.on("keydown keypress keyup change",function(){b.object[b.getExpressionPropertyName()]=b.$expressionInput.val()});this.$expressionInput.on("paste",function(){setTimeout(function(){b.object[b.getExpressionPropertyName()]=b.$expressionInput.val()},100)})};GuiPropertyComponent.prototype.createValueTypeRadioButtons=function(f){if(!this.hasValueTypeRadios){return}var d=this.id+"-value-type";this.$valueType=this.$component.find("#"+d);this.$valueType.buttonset();var g=this.id+"-value-radio";var c=this.id+"-expression-radio";var e=this.$component.find("#"+g);var a=this.$component.find("#"+c);var b=this;e.click(function(){if(b.$expressionInput){b.$input.show();b.$expressionInput.hide();b.object[b.getUseExpressionPropertyName()]=false}});a.click(function(){if(b.$expressionInput){b.$input.hide();b.$expressionInput.show();b.object[b.getUseExpressionPropertyName()]=true}})};GuiPropertyComponent.prototype.getValueTypeButtonsHtml=function(g){if(!this.hasValueTypeRadios){return}var f=!!this.object[this.getUseExpressionPropertyName()];var a="value-type-radio";var c="value-type-radios";var e=this.id+"-value-type";var d=e+"-radio-name";var h=this.id+"-value-radio";var b=this.id+"-expression-radio";g.push("<span ");g.push('id="'+e+'" ');g.push('class="'+c+'" ');g.push(">");g.push('<input type="radio" name="'+d+'" ');g.push('id="'+h+'" ');g.push('class="'+a+'" ');if(!f){g.push('checked="checked" ')}g.push("/>");g.push("<label ");g.push('for="'+h+'" ');g.push(">V</label>");g.push('<input type="radio" name="'+d+'" ');g.push('id="'+b+'" ');g.push('class="'+a+'" ');if(f){g.push('checked="checked" ')}g.push("/>");g.push("<label ");g.push('for="'+b+'" ');g.push(">E</label>");g.push("</span>")};function GuiPropertyTextComponent(a,b){GuiPropertyComponent.call(this,a,b);this.$input=null;this.$label=null;this.$errorLabel=null;this.inputTag="input";this.setUniqueId();this._constructorName="GuiPropertyTextComponent"}GuiPropertyTextComponent.prototype=new GuiPropertyComponent();GuiPropertyTextComponent.prototype.gatherAlignmentInfo=function(b){b.setVerticalOffset(0,this.$label.outerWidth());if(this.$valueType){var a=this.$valueType.position().left;b.setVerticalOffset(1,a)}};GuiPropertyTextComponent.prototype.resetAlignment=function(a){this.$label.css("padding-left","0px");if(this.$valueType){this.$valueType.css("padding-left","0px")}};GuiPropertyTextComponent.prototype.setAlignment=function(f){var a=this.$label.outerWidth();var d=f.getVerticalOffset(0);this.$label.css("padding-left",(d-a)+"px");if(this.$valueType){var c=this.$valueType.position().left;var b=f.getVerticalOffset(1);var e=Math.max(b-c+5,0);this.$valueType.css("padding-left",e+"px")}};GuiPropertyTextComponent.prototype.getHtmlContentBeforeChildren=function(c){var b=this.id+"-input";var a=this.id+"-expression-input";var e=this.id+"-label";var d=this.id+"-error-label";c.push("<span ");c.push('id="'+e+'" ');c.push(">");c.push(this.propertyInfo.propertyCaption+"</span>");c.push("<"+this.inputTag+" ");c.push('class="ui-corner-all" ');c.push('id="'+b+'" ');if(this.propertyInfo.shortDescription){c.push('title="'+this.propertyInfo.shortDescription+'" ')}c.push(" />");c.push("<label ");c.push('id="'+d+'" ');c.push("></label>")};GuiPropertyTextComponent.prototype.setError=function(a,b){if(a){this.$input.addClass("ui-state-error");this.$errorLabel.text(b)}else{this.$input.removeClass("ui-state-error");this.$errorLabel.text("")}};GuiPropertyTextComponent.prototype.setValueVerifyRaw=function(){logit("GuiPropertyTextComponent must implement setValueVerifyRaw() <br />")};GuiPropertyTextComponent.prototype.valueToString=function(a){return a};GuiPropertyTextComponent.prototype.parseInteger=function(d,a){a.error=false;var c=/^[\-\+]?\d+$/g;if(!c.test(d)){a.error=true}if(!a.error){var b=parseInt(d);a.error=isNaN(b);a.value=b}};GuiPropertyTextComponent.prototype.jQueryCreated=function(d){JQueryComponent.prototype.jQueryCreated.call(this,d);var b=this;this.$input=this.$component.find("#"+this.id+"-input");this.$label=this.$component.find("#"+this.id+"-label");this.$errorLabel=this.$component.find("#"+this.id+"-error-label");this.$errorLabel.css("padding-left","0.7em");var a=this.$label.width();this.$label.css("padding-right","0.7em");this.$input.css("width","10em");var c=this.getValue();this.$input.val(this.valueToString(c));var b=this;this.$input.on("keydown keypress keyup change",function(){b.setValueVerifyRaw()});this.$input.on("paste",function(){setTimeout(function(){b.setValueVerifyRaw()},100)})};function GuiPropertySingleOptionComponent(a,b){GuiPropertyComponent.call(this,a,b);this._constructorName="GuiPropertySingleOptionComponent"}GuiPropertySingleOptionComponent.prototype=new GuiPropertyComponent();GuiPropertySingleOptionComponent.prototype.getOptionHtml=function(c,d,a,b){};GuiPropertySingleOptionComponent.prototype.addOption=function(b,a){};GuiPropertySingleOptionComponent.prototype.getValuesAndNamesHtml=function(c,f){for(var b=0;b<f.length;b++){var e=f[b];var d=e[0];var a=e[1];this.getOptionHtml(c,d,a,b)}};GuiPropertySingleOptionComponent.prototype.getValuesAndNames=function(){var a=[];for(var c=0;c<this.propertyInfo.possibleValues.length;c++){var d=this.propertyInfo.possibleValues[c];var b=d;if(this.propertyInfo.displayFunction){b=this.propertyInfo.displayFunction.call(this,this.object,this.propertyInfo.propertyName,d)}a.push([d,b])}return a};GuiPropertySingleOptionComponent.prototype.setOptionsFromValuesAndNames=function(e){this.$input.empty();for(var b=0;b<e.length;b++){var d=e[b];var c=d[0];var a=d[1];this.addOption(c,a)}};function GuiPropertySelectComponent(a,b){GuiPropertySingleOptionComponent.call(this,a,b);this.$input=null;this.$label=null;this.$errorLabel=null;this.setUniqueId();this._constructorName="GuiPropertySelectComponent"}GuiPropertySelectComponent.prototype.componentRemoved=function(){GuiPropertyComponent.prototype.componentRemoved.call(this)};GuiPropertySelectComponent.prototype=new GuiPropertySingleOptionComponent();GuiPropertySelectComponent.prototype.gatherAlignmentInfo=function(a){a.setVerticalOffset(0,this.$label.outerWidth());if(this.$valueType){a.setVerticalOffset(1,this.$valueType.position().left)}};GuiPropertySelectComponent.prototype.resetAlignment=function(a){this.$label.css("padding-left","0px");if(this.$valueType){this.$valueType.css("padding-left","0px")}};GuiPropertySelectComponent.prototype.setAlignment=function(f){var a=this.$label.outerWidth();var d=f.getVerticalOffset(0);this.$label.css("padding-left",(d-a)+"px");if(this.$valueType){var c=this.$valueType.position().left;var b=f.getVerticalOffset(1);var e=Math.max(b-c+5,0);this.$valueType.css("padding-left",e+"px")}};GuiPropertySelectComponent.prototype.getHtmlContentBeforeChildren=function(c){var b=this.id+"-input";var a=this.id+"-expression-input";var e=this.id+"-label";var d=this.id+"-error-label";c.push("<label ");c.push('for="'+b+'" ');c.push('id="'+e+'" ');c.push(">");c.push(this.propertyInfo.propertyCaption+"</label>");c.push("<select ");c.push('class="ui-corner-all" ');if(this.propertyInfo.shortDescription){c.push('title="'+this.propertyInfo.shortDescription+'" ')}c.push('id="'+b+'" ');c.push(">");var f=this.getValuesAndNames();this.getValuesAndNamesHtml(c,f);c.push("</select>");c.push("<label ");c.push('id="'+d+'" ');c.push("></label>")};GuiPropertySelectComponent.prototype.getOptionHtml=function(c,d,a,b){c.push("<option ");c.push('value="'+d+'" ');c.push('class="'+(this.id+"-option")+'" ');c.push(">");c.push(""+a);c.push("</option>")};GuiPropertySelectComponent.prototype.setError=function(a,b){if(a){this.$input.addClass("ui-state-error");this.$errorLabel.text(b)}else{this.$input.removeClass("ui-state-error");this.$errorLabel.text("")}};GuiPropertySelectComponent.prototype.removeOption=function(d,c){var a=this.$component.find("option").filter('[value="'+d+'"]');var b=this.$input.val();if(d==b){}a.remove();var e=this.$input.val();if(e!=b){this.setValueVerifyRaw()}};GuiPropertySelectComponent.prototype.changeOption=function(c,d,a){var b=this.$component.find("option").filter('[value="'+c+'"]');b.val(d);b[0].innerHTML=a;this.setValueVerifyRaw()};GuiPropertySelectComponent.prototype.addOption=function(d,b){var c=[];var e=this.$component.find("option").size();this.getOptionHtml(c,d,b,e-1);var a=$(c.join(""));this.$input.append(a)};GuiPropertySelectComponent.prototype.setValueVerifyRaw=function(){logit("GuiPropertySelectComponent must implement setValueVerifyRaw() <br />")};GuiPropertySelectComponent.prototype.jQueryCreated=function(d){JQueryComponent.prototype.jQueryCreated.call(this,d);this.$input=this.$component.find("#"+this.id+"-input");this.$label=this.$component.find("#"+this.id+"-label");this.$errorLabel=this.$component.find("#"+this.id+"-error-label");this.$errorLabel.css("padding-left","0.7em");var c=10;this.$label.css("padding-right","0.7em");this.$input.css("width","13em");var b=this.getValue();this.$input.val(""+b);var a=this;this.$input.on("change",function(){a.setValueVerifyRaw()})};function GuiPropertyRadioButtonsComponent(a,b){GuiPropertySingleOptionComponent.call(this,a,b);this.$input=null;this.$label=null;this.$errorLabel=null;this.setUniqueId();this._constructorName="GuiPropertyRadioButtonsComponent"}GuiPropertyRadioButtonsComponent.prototype=new GuiPropertySingleOptionComponent();GuiPropertyRadioButtonsComponent.prototype.getHtmlContentBeforeChildren=function(a){var b=this.getValuesAndNames();this.getValuesAndNamesHtml(a,b)};GuiPropertyRadioButtonsComponent.prototype.getOptionHtml=function(d,e,b,c){var a=this.id+"-radio-"+c;var f=this.id+"-label-"+c;d.push("<input ");d.push('type="radio" ');d.push('name="radio" ');d.push('id="'+a+'" ');d.push('class="radiobutton" ');d.push("/>");d.push("<label ");d.push('for="'+a+'" ');d.push('class="radiobutton-label" ');d.push('id="'+f+'" ');d.push(">");d.push(""+b);d.push("</label>")};GuiPropertyRadioButtonsComponent.prototype.removeOption=function(d,c){var a=this.$component.find("button").filter(function(f){var g=$(this).data("optionValue");return d==g});var b=this.$input.val();if(d==b){}a.remove();var e=this.$input.val();if(e!=b){this.setValueVerifyRaw()}};GuiPropertyRadioButtonsComponent.prototype.changeOption=function(b,d,a){var c=this.$component.find("button").filter(function(e){var f=$(this).data("optionValue");return b==f});c.data("optionData",d);c[0].innerHTML=a;this.setValueVerifyRaw()};GuiPropertyRadioButtonsComponent.prototype.addOption=function(d,b){var c=[];this.getOptionHtml(c,d,b);var a=$(c.join(""));a.data("optionValue",d);this.$input.append(a)};GuiPropertyRadioButtonsComponent.prototype.setValueVerifyRaw=function(){logit("GuiPropertySelectComponent must implement setValueVerifyRaw() <br />")};GuiPropertyRadioButtonsComponent.prototype.jQueryCreated=function(h){JQueryComponent.prototype.jQueryCreated.call(this,h);var b=this.$component.find("button").filter(".radiobutton").get();var k=this.$component.find("label").filter(".radiobutton-label").get();if(b.length!=k.length){logit("Buttons not equal count to labels in GuiPropertyRadioButtonsComponent<br/>")}var f=this.getValuesAndNames();for(var d=0;d<b.length;d++){var e=b[d];var g=k[d];var j=f[d][0];$(e).data("optionValue",j);$(g).data("optionValue",j)}this.$component.buttonset();this.$label=this.$component.find("#"+this.id+"-label");var a=250;var c=10;var l=this.$label.width();if(l<a){this.$label.css("padding-left",Math.round((a-l)/15)+"em")}this.$label.css("padding-right","0.7em")};function GuiAbstractListComponent(a,b){GuiPropertyComponent.call(this,a,b);if(b){this.listInfo=b.listInfo}this.$deleteButton=null;this.$list=null;this.listItemCounter=1;this.listItemClass="object-list-item";this.listClass="object-list";this.selectedListItems={};this.listItems={};this._constructorName="GuiAbstractListComponent"}GuiAbstractListComponent.prototype=new GuiPropertyComponent();GuiAbstractListComponent.prototype.componentRemoved=function(){GuiPropertyComponent.prototype.componentRemoved.call(this)};GuiAbstractListComponent.prototype.getListItemContentHtml=function(a,d,c){var e=this.listInfo;if(e.itemsDisplayFunction){d.push(e.itemsDisplayFunction.call(this,a))}else{if(a.id){d.push(a.id)}else{if(typeof(a)==="object"){var b=this.propertyInfo.uniqueIdInfo;if(b){d.push(a.id)}else{logit("Cannot put objects in GuiAbstractListComponent without an id or a unique id manager")}}else{d.push(""+a)}}}};GuiAbstractListComponent.prototype.setIds=function(){this.listId=this.id+"-list";this.newButtonIdPrefix=this.id+"-new-button";this.copyButtonIdPrefix=this.id+"-copy-button";this.newSelectId=this.id+"-new-select";this.deleteButtonId=this.id+"-delete-button";this.copyButtonId=this.id+"-copy-button";this.detailsId=this.id+"-details"};GuiAbstractListComponent.prototype.getHtmlContentBeforeChildren=function(b){var e=this.listInfo;var d=this.getValue();b.push("<span class='ui-widget' >"+this.propertyInfo.propertyCaption+"</span><br />");b.push("<ul ");b.push('id="'+this.listId+'" ');b.push("class='object-list' ");b.push(">\n");for(var a=0;a<d.length;a++){var c=d[a];this.getListItemHtml(c,b,a)}b.push("</ul>\n");b.push("<div>\n");this.getConstructorsHtml(b,this.listInfo.constructorInfos,this.listInfo.newMode);b.push("<button ");b.push('id="'+this.deleteButtonId+'" ');b.push(">");b.push("</button>\n");b.push("<button ");b.push('id="'+this.copyButtonId+'" ');b.push(">");b.push("</button>\n");b.push("</div>\n")};GuiAbstractListComponent.prototype.getListItemHtml=function(a,c,b){var d=this.listInfo;c.push("<li ");c.push("class='"+this.listItemClass+" ui-widget-content' ");c.push("id='"+(this.id+"-item-"+this.listItemCounter)+"' ");c.push(">");c.push("<div class='vertical-list-item-drag-handle' >");c.push("<span class='ui-icon ui-icon-carat-2-n-s'></span>");c.push("</div>");this.listItemCounter++;c.push("<span class='object-list-item-content' >");this.getListItemContentHtml(a,c,b);c.push("</span>");c.push("</li>\n")};GuiAbstractListComponent.prototype.jQueryCreated=function(d){GuiPropertyComponent.prototype.jQueryCreated.call(this,d);var a=this;this.$details=this.$component.find("#"+this.detailsId);this.$list=this.$component.find("#"+this.listId);var b=this.$component.find(".object-list-item");var c=this.getValue();b.each(function(h,i){var f=c[h];if(typeof(f)==="undefined"){logit("could not find value for index "+h+" in "+JSON.stringify(c)+" property: "+a.propertyInfo.propertyName+"<br />")}else{var g=$(i);g.data("value",f);a.listItems[i.id]=i}});this.$list.sortable({handle:".vertical-list-item-drag-handle"});this.$list.on("sortstop",function(f,g){a.itemSortStop(f,g)});this.$list.selectable({selected:function(f,g){a.listItemSelected(f,g)},unselected:function(f,g){a.listItemUnselected(f,g)}});this.addConstructorClickListeners(this.listInfo.constructorInfos,function(f){a.appendNewItem(f,a.propertyInfo)},this.listInfo.newMode);this.$deleteButton=this.$component.find("#"+this.deleteButtonId);var e={};e.label="Delete";e.text=false;e.icons={};e.icons.primary="ui-icon-trash";this.$deleteButton.button(e);this.$deleteButton.button("disable");this.$deleteButton.click(this,function(){a.deleteSelectedItems()});this.$copyButton=this.$component.find("#"+this.copyButtonId);var e={};e.label="Copy";e.text=false;e.icons={};e.icons.primary="ui-icon-copy";this.$copyButton.button(e);this.$copyButton.button("disable");this.$copyButton.click(this,function(){a.copySelectedItems()})};GuiAbstractListComponent.prototype.itemAppended=function(a,b){};GuiAbstractListComponent.prototype.appendNewValue=function(e){var d=this.getValue();var c=[];this.getListItemHtml(e,c,d.length);var b=$(c.join(""));this.$list.append(b);b.data("value",e);this.listItems[b.get(0).id]=b.get(0);d.push(e);var a=this;b.on("change",function(){a.setValueVerifyRaw()});this.itemAppended(b,e);this.callChangeListeners()};GuiAbstractListComponent.prototype.appendNewItem=function(a,c){var b=this.createNewValue(a,c);this.appendNewValue(b)};GuiAbstractListComponent.prototype.clearSelection=function(){var a=this.getSelectedItems();for(var b=0;b<a.length;b++){var c=a[b];delete this.selectedListItems[c.id]}this.selectedListItems={};return this};GuiAbstractListComponent.prototype.getSelectedItems=function(){var a=[];$.each(this.selectedListItems,function(b,c){if(c.id){a.push(c)}else{}});return a};GuiAbstractListComponent.prototype.copySelectedItems=function(){var c=this.getSelectedItems();if(c.length>0){var e=this.getValue();var b=this.propertyInfo.uniqueIdInfo;for(var d=0;d<c.length;d++){var h=c[d];var g=$(h);var f=g.data("value");var j={};var a=copyValueDeep(f);this.appendNewValue(a)}}};GuiAbstractListComponent.prototype.deleteSelectedItems=function(){var g=this.getSelectedItems();if(g.length>0){var f=this.getValue();var c=this.propertyInfo.uniqueIdInfo;for(var d=0;d<g.length;d++){var e=g[d];var b=$(e);var a=b.data("value");if(typeof(a)!="undefined"){b.remove();arrayDelete(f,a);this.cleanAfterDelete(a)}else{logit("Can not find a value for item with index "+d+" and id "+e.id+"<br />")}}this.clearSelection();this.$deleteButton.button("disable");this.callChangeListeners()}};GuiAbstractListComponent.prototype.listItemSelected=function(a,b){this.$deleteButton.button("enable");this.$copyButton.button("enable");this.selectedListItems[b.selected.id]=b.selected};GuiAbstractListComponent.prototype.listItemUnselected=function(a,b){delete this.selectedListItems[b.unselected.id];if(this.getSelectedItems().length==0){this.$deleteButton.button("disable");this.$copyButton.button("disable")}};GuiAbstractListComponent.prototype.itemSortStop=function(c,e){var b=[];var a=this;this.$component.find(".object-list-item").each(function(h,i){var g=$(i);var f=g.data("value");b.push(f)});var d=this.getValue();d.length=0;addAll(d,b);this.callChangeListeners()};function GuiPropertySelectListComponent(a,b){GuiAbstractListComponent.call(this,a,b);this.cssClassName="object-list-panel";this.otherCssClasses.push("ui-widget-content");this.setUniqueId();this.setIds();this._constructorName="GuiPropertySelectListComponent"}GuiPropertySelectListComponent.prototype=new GuiAbstractListComponent();GuiPropertySelectListComponent.prototype.getValueItemId=function(a,b){return this.id+"-option-"+a+"-"+b};GuiPropertySelectListComponent.prototype.getOptionHtml=function(d,e,a,b,c){d.push("<option ");d.push("value='"+e+"' ");d.push("class='"+(this.id+"-option")+"' ");d.push("id='"+this.getValueItemId(b,c)+"' ");d.push(">");d.push(""+a);d.push("</option>")};GuiPropertySelectListComponent.prototype.getValuesAndNamesHtml=function(d,g,c){for(var b=0;b<g.length;b++){var f=g[b];var e=f[0];var a=f[1];this.getOptionHtml(d,e,a,c,b)}};GuiPropertySelectListComponent.prototype.getValuesAndNames=function(){var a=[];for(var c=0;c<this.propertyInfo.listInfo.possibleValues.length;c++){var e=this.propertyInfo.listInfo.possibleValues[c];var b=e;var d=[];GuiAbstractListComponent.prototype.getListItemContentHtml.call(this,e,d);b=d.join("");a.push([e,b])}return a};GuiPropertySelectListComponent.prototype.getListItemContentHtml=function(a,d,c){var b=this.id+"-select-"+c;d.push("<select ");d.push("class='"+this.id+"-select' ");d.push("id='"+b+"' ");d.push(">");var e=this.getValuesAndNames();this.getValuesAndNamesHtml(d,e,c);d.push("</select>")};GuiPropertySelectListComponent.prototype.jQueryCreated=function(e){GuiAbstractListComponent.prototype.jQueryCreated.call(this,e);var d=this.getValue();var b=this;for(var c=0;c<d.length;c++){var a=this.$component.find("#"+this.id+"-select-"+c);a.val(""+d[c]);a.on("change",function(){b.setValueVerifyRaw(c)})}};GuiPropertySelectListComponent.prototype.getItemValue=function(a){return a};GuiPropertySelectListComponent.prototype.setValueVerifyRaw=function(e){var d=this.getValue();var a=this;var b=this.$component.find(".object-list-item");var c=this.$component.find("."+this.id+"-select");b.each(function(h,i){var g=$(c.get(h));var f=g.val();d[h]=a.getItemValue(f);$(i).data("value",d[h])});this.callChangeListeners();this.setValueVerify(d)};GuiPropertySelectListComponent.prototype.itemAppended=function(a,b){a.find("select").val(""+b)};GuiPropertySelectListComponent.prototype.removeOption=function(c,b){var a=this.$component.find("option").filter('[value="'+c+'"]');a.remove();this.setValueVerifyRaw()};GuiPropertySelectListComponent.prototype.changeOption=function(b,d,a){var c=this.$component.find("option").filter('[value="'+b+'"]');c.each(function(f,g){g.innerHTML=a;var e=$(g);e.val(d)});this.setValueVerifyRaw()};GuiPropertySelectListComponent.prototype.addOption=function(d,b){var c=this.$component.find("."+this.id+"-select");var a=this;c.each(function(g,h){var i=[];var e=$(h);var j=e.find("option").size();a.getOptionHtml(i,d,b,j-1);var f=$(i.join(""));e.append(f)})};function GuiPropertySliderComponent(a,b){GuiPropertyComponent.call(this,a,b);this.$input=null;this.$label=null;this.inputTag="span";this.setUniqueId();this._constructorName="GuiPropertySliderComponent"}GuiPropertySliderComponent.prototype=new GuiPropertyComponent();GuiPropertySliderComponent.prototype.gatherAlignmentInfo=function(a){a.setVerticalOffset(0,this.$label.outerWidth())};GuiPropertySliderComponent.prototype.setAlignment=function(c){var a=this.$label.outerWidth();var b=c.getVerticalOffset(0);this.$label.css("padding-left",(b-a)+"px")};GuiPropertySliderComponent.prototype.resetAlignment=function(){this.$label.css("padding-left","0px")};GuiPropertySliderComponent.prototype.getHtmlContentBeforeChildren=function(b){var a=this.id+"-input";var c=this.id+"-label";b.push("<span ");b.push('id="'+c+'" ');b.push(">");b.push(this.propertyInfo.propertyCaption+"</span>");b.push("<"+this.inputTag+" ");b.push('id="'+a+'" ');b.push(" />")};GuiPropertySliderComponent.prototype.setError=function(a,b){logit("Error not implemented in GuiPropertySliderComponent")};GuiPropertySliderComponent.prototype.setValueVerifyRaw=function(){logit("GuiPropertySliderComponent must implement setValueVerifyRaw() <br />")};GuiPropertySliderComponent.prototype.jQueryCreated=function(d){JQueryComponent.prototype.jQueryCreated.call(this,d);var a=this;this.$input=this.$component.find("#"+this.id+"-input");this.$label=this.$component.find("#"+this.id+"-label");var c=10;var b=this.getValue();this.$input.slider({value:b,slide:function(e,f){a.setValueVerifyRaw()}});this.$label.css("padding-right","0.7em");this.$input.css("width","13em");var a=this};function IdReferenceListSelectComponent(a,c){GuiPropertySelectListComponent.call(this,a,c);var b=this.getUniqueIdManager();if(b){b.addUniqueIdListener(this.propertyInfo.uniqueIdInfo.namespace,this)}else{logit("Could not find unique id manager in IdReferenceListSelectComponent<br />")}}IdReferenceListSelectComponent.prototype=new GuiPropertySelectListComponent();IdReferenceListSelectComponent.prototype.getItemValue=function(a){return a};IdReferenceListSelectComponent.prototype.componentRemoved=function(){GuiPropertySelectListComponent.prototype.componentRemoved.call(this);var a=this.getUniqueIdManager();if(a){a.removeUniqueIdListener(this.propertyInfo.uniqueIdInfo.namespace,this)}};IdReferenceListSelectComponent.prototype.uniqueIdAdded=function(a,c,b){this.addOption(b,b)};IdReferenceListSelectComponent.prototype.uniqueIdChanged=function(a,c,d,b){this.changeOption(d,b,b)};IdReferenceListSelectComponent.prototype.uniqueIdRemoved=function(a,c,b){this.removeOption(b,"")};IdReferenceListSelectComponent.prototype.getValuesAndNames=function(){var a=[["","None"]];var c=this.getUniqueIdManager();if(c){var d=c.getUniqueIds(this.getUniqueIdNamespace());for(var b=0;b<d.length;b++){a.push([d[b],d[b]])}}return a};function IntegerSelectComponent(a,b){GuiPropertySelectComponent.call(this,a,b)}IntegerSelectComponent.prototype=new GuiPropertySelectComponent();IntegerSelectComponent.prototype.setValueVerifyRaw=function(){var c=this.$input.val();var b=parseInt(c);var a=isNaN(b);this.setError(a,"Invalid integer");if(!a){this.setValueVerify(b)}};function IntegerListSelectComponent(a,b){GuiPropertySelectListComponent.call(this,a,b)}IntegerListSelectComponent.prototype=new GuiPropertySelectListComponent();IntegerListSelectComponent.prototype.getItemValue=function(a){var b=parseInt(a);return b};function FloatSelectComponent(a,b){GuiPropertySelectComponent.call(this,a,b)}FloatSelectComponent.prototype=new GuiPropertySelectComponent();FloatSelectComponent.prototype.setValueVerifyRaw=function(){var b=this.$input.val();var c=parseFloat(b);var a=isNaN(c);this.setError(a,"Invalid decimal");if(!a){this.setValueVerify(c)}};function StringSelectComponent(a,b){GuiPropertySelectComponent.call(this,a,b)}StringSelectComponent.prototype=new GuiPropertySelectComponent();StringSelectComponent.prototype.setValueVerifyRaw=function(){var a=this.$input.val();this.setValueVerify(a)};function BooleanSelectComponent(a,b){GuiPropertySelectComponent.call(this,a,b)}BooleanSelectComponent.prototype=new GuiPropertySelectComponent();BooleanSelectComponent.prototype.setValueVerifyRaw=function(){var a=this.$input.val();var b=a=="true"?true:false;this.setValueVerify(b)};BooleanSelectComponent.prototype.getValuesAndNames=function(){var a=[];var b=[true,false];for(var d=0;d<b.length;d++){var e=b[d];var c=e;if(this.propertyInfo.displayFunction){c=this.propertyInfo.displayFunction.call(this,this.object,this.propertyInfo.propertyName,e)}a.push([e,c])}return a};function IntegerTextComponent(a,b){GuiPropertyTextComponent.call(this,a,b)}IntegerTextComponent.prototype=new GuiPropertyTextComponent();IntegerTextComponent.prototype.setValueVerifyRaw=function(){var b=false;var a=this.$input.val();var c={};this.parseInteger(a,c);b=c.error;if(!c.error){b=this.verifyNumberConstraints(c.value);if(b){return}}this.setError(b,"Invalid integer");if(!b){this.setValueVerify(c.value)}};function StringTextAreaComponent(a,b){GuiPropertyTextComponent.call(this,a,b);this.inputTag="textarea"}StringTextAreaComponent.prototype=new GuiPropertyTextComponent();StringTextAreaComponent.prototype.setValueVerifyRaw=function(){var a=this.$input.val();this.setValueVerify(a)};function IntegerListTextComponent(a,b){GuiPropertyTextComponent.call(this,a,b)}IntegerListTextComponent.prototype=new GuiPropertyTextComponent();IntegerListTextComponent.prototype.valueToString=function(a){return a.join(" ")};IntegerListTextComponent.prototype.setValueVerifyRaw=function(){var d=false;var c="";var a=this.$input.val();a=$.trim(a);var b=a.split(" ");var f=[];for(var e=0;e<b.length;e++){var h=$.trim(b[e]);if(h){var g={};this.parseInteger(h,g);if(!g.error){f.push(g.value)}d=g.error}if(d){c="Invalid integer: '"+h+"'";break}}this.setError(d,c);if(!d){this.setValueVerify(f)}};function IntegerList2DTextComponent(a,b){GuiPropertyTextComponent.call(this,a,b)}IntegerList2DTextComponent.prototype=new GuiPropertyTextComponent();IntegerList2DTextComponent.prototype.valueToString=function(d){var b="";for(var c=0;c<d.length;c++){var a=d[c];b+=a.join(" ");if(c<d.length-1){b+=", "}}return b};IntegerList2DTextComponent.prototype.setValueVerifyRaw=function(){var k=false;var g="";var c=this.$input.val();c=$.trim(c);var h=[];var f=c.split(",");for(var d=0;d<f.length;d++){var l=f[d];var b=l.split(" ");var n=[];for(var e=0;e<b.length;e++){var m=$.trim(b[e]);if(m){var a={};this.parseInteger(m,a);if(!a.error){n.push(a.value)}k=a.error}if(k){g="Invalid integer: '"+m+"'";break}}if(k){break}if(n.length>0){h.push(n)}}this.setError(k,g);if(!k){this.setValueVerify(h)}};function FloatTextComponent(a,b){GuiPropertyTextComponent.call(this,a,b)}FloatTextComponent.prototype=new GuiPropertyTextComponent();FloatTextComponent.prototype.setValueVerifyRaw=function(){var b=false;var a=this.$input.val();if(!b){var c=parseFloat(a);b=isNaN(c)}if(!b){b=this.verifyNumberConstraints(c);if(b){return}}this.setError(b,"Invalid decimal");if(!b){this.setValueVerify(c)}};function FloatListTextComponent(a,b){GuiPropertyTextComponent.call(this,a,b)}FloatListTextComponent.prototype=new GuiPropertyTextComponent();FloatListTextComponent.prototype.valueToString=function(a){return a.join(" ")};FloatListTextComponent.prototype.setValueVerifyRaw=function(){var e=false;var d="";var a=this.$input.val();a=$.trim(a);var c=a.split(" ");var b=[];for(var f=0;f<c.length;f++){var h=$.trim(c[f]);if(h){var g=parseFloat(h);e=isNaN(g);if(!e){b.push(g)}}if(e){d="Invalid decimal: '"+h+"'";break}}this.setError(e,d);if(!e){this.setValueVerify(b)}};function FloatList2DTextComponent(a,b){GuiPropertyTextComponent.call(this,a,b)}FloatList2DTextComponent.prototype=new GuiPropertyTextComponent();FloatList2DTextComponent.prototype.valueToString=function(d){var b="";for(var c=0;c<d.length;c++){var a=d[c];b+=a.join(" ");if(c<d.length-1){b+=", "}}return b};FloatList2DTextComponent.prototype.setValueVerifyRaw=function(){var k=false;var h="";var c=this.$input.val();c=$.trim(c);var n=[];if(c!=""){var g=c.split(",");for(var d=0;d<g.length;d++){var l=g[d];var b=l.split(" ");var a=[];for(var e=0;e<b.length;e++){var m=$.trim(b[e]);if(m){var f=parseFloat(m);k=isNaN(f);if(!k){a.push(f)}}if(k){h="Invalid decimal: '"+m+"'";break}}if(k){break}n.push(a)}this.setError(k,h)}if(!k){this.setValueVerify(n)}};function StringNotEmptyConstraint(a){this.errorMessage=getValueOrDefault(a,"errorMessage","Must not be empty")}StringNotEmptyConstraint.prototype.isValid=function(a,c,b){return b!=""};StringNotEmptyConstraint.prototype.getInvalidDescription=function(a,c,b){return this.errorMessage};function StringLengthConstraint(a){this.maxLength=getValueOrDefault(a,"maxLength",9999999999999);this.minLength=getValueOrDefault(a,"minLength",0)}StringLengthConstraint.prototype.isValid=function(a,c,b){return b.length<=this.maxLength&&b.length>=this.minLength};StringLengthConstraint.prototype.getInvalidDescription=function(a,d,c){if(c.length<this.minLength){var b=this.minLength==1?"character":"characters";return"Must have at least "+this.minLength+" "+b}if(c.length>this.maxLength){var b=this.maxLength==1?"character":"characters";return"Must have at most "+this.maxLength+" "+b}return""};function StringTextComponent(a,b){GuiPropertyTextComponent.call(this,a,b)}StringTextComponent.prototype=new GuiPropertyTextComponent();StringTextComponent.prototype.setValueVerifyRaw=function(){var b=false;var a=this.$input.val();if(!b){this.setValueVerify(a)}};function IdReferenceSelectComponent(a,c){GuiPropertySelectComponent.call(this,a,c);var b=this.getUniqueIdManager();if(b){b.addUniqueIdListener(this.propertyInfo.uniqueIdInfo.namespace,this)}else{logit("Could not find unique id manager in IdReferenceSelectComponent<br />")}}IdReferenceSelectComponent.prototype=new GuiPropertySelectComponent();IdReferenceSelectComponent.prototype.componentRemoved=function(){GuiPropertySelectComponent.prototype.componentRemoved.call(this);var a=this.getUniqueIdManager();if(a){a.removeUniqueIdListener(this.propertyInfo.uniqueIdInfo.namespace,this)}};IdReferenceSelectComponent.prototype.uniqueIdAdded=function(a,c,b){this.addOption(b,b)};IdReferenceSelectComponent.prototype.uniqueIdChanged=function(a,c,d,b){this.changeOption(d,b,b)};IdReferenceSelectComponent.prototype.uniqueIdRemoved=function(a,c,b){this.removeOption(b,"")};IdReferenceSelectComponent.prototype.getValuesAndNames=function(){var a=[["","None"]];var c=this.getUniqueIdManager();if(c){var d=c.getUniqueIds(this.getUniqueIdNamespace());for(var b=0;b<d.length;b++){a.push([d[b],d[b]])}}return a};IdReferenceSelectComponent.prototype.setValueVerifyRaw=function(){var a=this.$input.val();this.setValueVerify(a)};function ProcedureButtonComponent(a,b){GuiPropertyComponent.call(this,a,b);this.tagName="button";this.setUniqueId()}ProcedureButtonComponent.prototype=new GuiPropertyComponent();ProcedureButtonComponent.prototype.getHtmlContentBeforeChildren=function(a){a.push(this.propertyInfo.propertyCaption)};ProcedureButtonComponent.prototype.jQueryCreated=function(d){GuiPropertyComponent.prototype.jQueryCreated.call(this,d);this.$component.button();var c=this.propertyInfo;var b=this.object;var a=this;this.$component.on("click",function(){var e=c.procedureInfo;var h=[];var g=null;if(e){h=e.args;g=e.targetObject}if(!g){g=a}var f=g[c.propertyName];if(f&&$.isFunction(f)){f.apply(g,h)}else{logit("Could not find procedure "+c.propertyName+" in ProcedureButtonComponent<br />");logit(""+g._constructorName+" "+c.propertyName+"<br />")}})};function UniqueIdTextComponent(a,b){GuiPropertyTextComponent.call(this,a,b);this.hasValueTypeRadios=false}UniqueIdTextComponent.prototype=new GuiPropertyTextComponent();UniqueIdTextComponent.prototype.setValueVerifyRaw=function(){var d=false;var b="";var a=this.$input.val();if(!a){d=true;b="ID can not be empty"}var c=this.getValue();if(!d&&c!=a){var e=this.getUniqueIdManager();var f=this.getUniqueIdNamespace();d=!e.uniqueIdAvailable(this.object,f,a);if(d){b="ID already exists"}}if(!d){if(this.setValueVerify(a)&&c!=a){e.changeUniqueId(this.object,f,c,a)}}else{this.setError(true,b)}};function GuiObjectComponent(a,b){GuiPropertyComponent.call(this,a,b);this.$details=null;this.cssClassName="object-list-panel";this.otherCssClasses.push("ui-widget-content");this.setUniqueId();this.detailsId=this.id+"-details";this.newButtonIdPrefix=this.id+"-new-button";this.detailsComponent=null;this._constructorName="GuiObjectComponent"}GuiObjectComponent.prototype=new GuiPropertyComponent();GuiObjectComponent.prototype.componentRemoved=function(){GuiPropertyComponent.prototype.componentRemoved.call(this);if(this.detailsComponent){this.detailsComponent.componentRemoved()}};GuiObjectComponent.prototype.removeDetailsComponent=function(){if(this.detailsComponent){this.detailsComponent.componentRemoved();this.detailsComponent=null}};GuiObjectComponent.prototype.getHtmlContentBeforeChildren=function(b){b.push("<div>"+this.propertyInfo.propertyCaption+"</div>");var a=this.propertyInfo.objectInfo;this.getConstructorsHtml(b,a.constructorInfos,a.newMode);b.push("<div ");b.push('id="'+this.detailsId+'" ');b.push(">\n");b.push("</div>\n")};GuiObjectComponent.prototype.jQueryCreated=function(c){GuiPropertyComponent.prototype.jQueryCreated.call(this,c);this.$details=this.$component.find("#"+this.detailsId);var b=this.propertyInfo.objectInfo;var a=this;this.addConstructorClickListeners(b.constructorInfos,function(d){var e=a.createNewValue(d,a.propertyInfo);a.setValueVerify(e);a.updateDetailsPanel()},b.newMode);this.updateDetailsPanel()};GuiObjectComponent.prototype.updateDetailsPanel=function(){var f=this.getValue();var a=this.propertyInfo;this.$details.empty();this.removeDetailsComponent();var e=null;var b=a.objectInfo.constructorInfos;if(b.length>1){for(var d=0;d<b.length;d++){var c=b[d];if(c.nameIsConstructor&&c.name==f._constructorName){e=c.text;break}}}var g=new GuiPropertiesComponent({propertyInfoProvider:a.propertyInfoProvider,object:f,componentRegisters:a.componentRegisters});g.spawn(this.$details);if(e){g.$component.prepend($("<div><p>"+e+"</p></div>"))}g.alignComponents();this.detailsComponent=g};function IntegerSliderComponent(a,b){GuiPropertySliderComponent.call(this,a,b)}IntegerSliderComponent.prototype=new GuiPropertySliderComponent();IntegerSliderComponent.prototype.setValueVerifyRaw=function(){var a=false;var b=this.$input.slider("value");if(!a){this.setValueVerify(b)}};function GuiObjectListComponent(b,c){GuiAbstractListComponent.call(this,b,c);this.$details=null;this.cssClassName="object-list-panel";this.otherCssClasses.push("ui-widget-content");this.setUniqueId();this.setIds();this._constructorName="GuiObjectListComponent";this.currentDetailComponent=null;var a=c.uniqueIdInfo}GuiObjectListComponent.prototype=new GuiAbstractListComponent();GuiObjectListComponent.prototype.componentRemoved=function(){GuiAbstractListComponent.prototype.componentRemoved.call(this);var a=this.propertyInfo.uniqueIdInfo;if(this.currentDetailComponent){this.currentDetailComponent.componentRemoved()}};GuiObjectListComponent.prototype.getHtmlContentBeforeChildren=function(a){GuiAbstractListComponent.prototype.getHtmlContentBeforeChildren.call(this,a);a.push("<div ");a.push('id="'+this.detailsId+'" ');a.push(">\n");a.push("</div>\n")};GuiObjectListComponent.prototype.jQueryCreated=function(a){GuiAbstractListComponent.prototype.jQueryCreated.call(this,a);this.$details=this.$component.find("#"+this.detailsId)};GuiObjectListComponent.prototype.itemAppended=function(a,b){GuiAbstractListComponent.prototype.itemAppended.call(this,a,b);this.callChangeListeners()};GuiObjectListComponent.prototype.deleteSelectedItems=function(){GuiAbstractListComponent.prototype.deleteSelectedItems.call(this);this.updateDetailsPanel();this.callChangeListeners()};GuiObjectListComponent.prototype.removeDetailComponent=function(){if(this.currentDetailComponent){this.currentDetailComponent.componentRemoved();this.currentDetailComponent=null}};GuiObjectListComponent.prototype.updateDetailsPanel=function(){var a=this.getSelectedItems();var d=this;var f=this.propertyInfo;if(a.length==1){var k=a[0];var g=$(k).data("value");if(g){this.$details.empty();var h=null;var b=f.listInfo.constructorInfos;if(b.length>1){for(var c=0;c<b.length;c++){var l=b[c];if(l.nameIsConstructor&&l.name==g._constructorName){h=l.text;break}}}var j=new GuiPropertiesComponent({propertyInfoProvider:f.propertyInfoProvider,object:g,parentPropertyInfo:f,componentRegisters:f.componentRegisters});var e=this;j.changeListeners.push(function(t,o,s){e.callChangeListeners();var n=e.getSelectedItems();for(var p=0;p<n.length;p++){var r=n[p];var m=$(r).data("value");var q=[];e.getListItemContentHtml(m,q);$(r).find(".object-list-item-content")[0].innerHTML=q.join("")}});this.$details.show();j.spawn(this.$details);if(h){j.$component.prepend($("<div><p>"+h+"</p></div>"))}j.alignComponents();this.removeDetailComponent();this.currentDetailComponent=j}}else{this.$details.empty();this.removeDetailComponent()}};GuiObjectListComponent.prototype.listItemSelected=function(a,b){GuiAbstractListComponent.prototype.listItemSelected.call(this,a,b);this.updateDetailsPanel()};GuiObjectListComponent.prototype.listItemUnselected=function(a,b){GuiAbstractListComponent.prototype.listItemUnselected.call(this,a,b);this.updateDetailsPanel()};function UniqueIdManager(){this.listeners={};this.uniqueIdInfos={};this.globalListeners=[]}UniqueIdManager.prototype.addGlobalUniqueIdListener=function(a){this.globalListeners.push(a)};UniqueIdManager.prototype.addUniqueIdListener=function(b,c){var a=this.listeners[b];if(!a){a=[];this.listeners[b]=a}a.push(c)};UniqueIdManager.prototype.removeUniqueIdListener=function(b,c){var a=this.listeners[b];if(a){arrayDelete(a,c)}};UniqueIdManager.prototype.uniqueIdAvailable=function(a,d,b){var c=this.uniqueIdInfos[d];if(!c){return true}var e=c.get(b);if(e===a){return true}if(typeof e==="undefined"){return true}return false};UniqueIdManager.prototype.uniqueIdExists=function(a,d,b){var c=this.uniqueIdInfos[d];if(!c){return false}var e=c.get(b);if(e){return true}return false};UniqueIdManager.prototype.getNextUniqueId=function(d,e){var a=1;var c=this.uniqueIdInfos[d];while(true){var b=e+""+a;if(!c||typeof c.get(b)==="undefined"){return b}a++}};UniqueIdManager.prototype.getUniqueIds=function(b){var a=this.uniqueIdInfos[b];if(!a){return[]}else{return a.listKeys()}};UniqueIdManager.prototype.getListeners=function(b){var a=this.listeners[b];return a?a:[]};UniqueIdManager.prototype.addUniqueId=function(a,e,b){var d=this.uniqueIdInfos[e];if(!d){d=new Map(true);this.uniqueIdInfos[e]=d}if(typeof d.get(b)==="undefined"){d.put(b,a);$.each(this.getListeners(e),function(f,g){g.uniqueIdAdded(a,e,b)});for(var c=0;c<this.globalListeners.length;c++){this.globalListeners[c].uniqueIdAdded(a,e,b)}}else{logit("id already existed in addUniqueId() "+e+" "+b+"<br />")}};UniqueIdManager.prototype.changeUniqueId=function(a,e,g,b){var d=this.uniqueIdInfos[e];if(d){var f=d.get(g);d.remove(g);d.put(b,a);$.each(this.getListeners(e),function(h,i){i.uniqueIdChanged(a,e,g,b)})}else{logit("could not find any ids for namespace "+e+" in changeUniqueId()<br />")}for(var c=0;c<this.globalListeners.length;c++){this.globalListeners[c].uniqueIdChanged(a,e,g,b)}};UniqueIdManager.prototype.removeUniqueId=function(d,e){var c=this.uniqueIdInfos[d];if(c){var a=c.get(e);if(typeof a==="undefined"){logit("owner not exist in removeUniqueId() "+d+" "+e+"<br />")}else{c.remove(e);$.each(this.getListeners(d),function(f,g){g.uniqueIdRemoved(a,d,e)})}}else{logit("could not find any ids for namespace "+d+" in removeUniqueId()<br />")}for(var b=0;b<this.globalListeners.length;b++){this.globalListeners[b].uniqueIdRemoved(a,d,e)}};function PropertyInfoProvider(a){this.uniqueIdManager=getValueOrDefault(a,"uniqueIdManager",new UniqueIdManager());var b=this.uniqueIdManager;this.spsiUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"spsi",initPrefix:"spsi"});this.spsidsUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"spsids",initPrefix:"spsids"});this.phraseGroupTypesUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"phraseGroupTypes",initPrefix:"groupType"});this.eomUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"eom",initPrefix:"eom"});this.eoi1UidInfo=new GuiUniqueIdInfo({manager:b,namespace:"eoi1",initPrefix:"eoi1"});this.eoi2UidInfo=new GuiUniqueIdInfo({manager:b,namespace:"eoi2",initPrefix:"eoi2"});this.eobUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"eob",initPrefix:"eob"});this.emUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"em",initPrefix:"em"});this.ei1UidInfo=new GuiUniqueIdInfo({manager:b,namespace:"ei1",initPrefix:"ei1"});this.ei2UidInfo=new GuiUniqueIdInfo({manager:b,namespace:"ei2",initPrefix:"ei2"});this.ebUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"eb",initPrefix:"eb"});this.amUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"am",initPrefix:"am"});this.ai1UidInfo=new GuiUniqueIdInfo({manager:b,namespace:"ai1",initPrefix:"ai1"});this.ai2UidInfo=new GuiUniqueIdInfo({manager:b,namespace:"ai2",initPrefix:"ai2"});this.abUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"ab",initPrefix:"ab"});this.bdUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"bd",initPrefix:"bd"});this.sdUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"sd",initPrefix:"sd"});this.cdUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"cd",initPrefix:"cd"});this.rdUidInfo=new GuiUniqueIdInfo({manager:b,namespace:"rd",initPrefix:"rd"})}PropertyInfoProvider.prototype.createDefaultBooleanPropertyInfo=function(d,b,a,f,c){var e=new GuiPropertyInfo({propertyName:d,propertyCaption:b,propertyInfoProvider:this,defaultValue:a,dataType:GuiPropertyDataType.BOOLEAN,displayHint:BooleanPropertyDisplayHint.SELECT,shortDescription:f,longDescription:c});return e};PropertyInfoProvider.prototype.createDefaultFloatPropertyInfo=function(d,b,a,c){var f=[];if(c){addAll(f,c)}var e=new GuiPropertyInfo({propertyName:d,propertyCaption:b,propertyInfoProvider:this,defaultValue:a,constraints:f,dataType:GuiPropertyDataType.FLOAT,displayHint:NumberPropertyDisplayHint.TEXT});return e};PropertyInfoProvider.prototype.createDefaultLikelihoodPropertyInfo=function(c,b,a){return this.createDefaultFloatPropertyInfo(c,b,a,[new MinPropertyConstraint(0)])};PropertyInfoProvider.prototype.createDefaultProbabilityPropertyInfo=function(c,b,a){return this.createDefaultFloatPropertyInfo(c,b,a,[new RangePropertyConstraint([0,1])])};PropertyInfoProvider.prototype.createDefaultIntPropertyInfo=function(d,b,a,c){var f=[];if(c){addAll(f,c)}var e=new GuiPropertyInfo({propertyName:d,propertyCaption:b,propertyInfoProvider:this,defaultValue:a,constraints:f,dataType:GuiPropertyDataType.INT,displayHint:NumberPropertyDisplayHint.TEXT});return e};PropertyInfoProvider.prototype.createDefaultIndexPropertyInfo=function(c,b,a){return this.createDefaultIntPropertyInfo(c,b,a,[new MinPropertyConstraint(0)])};PropertyInfoProvider.prototype.createDefaultStringPropertyInfo=function(d,b,a,f,c){var e=new GuiPropertyInfo({propertyName:d,propertyCaption:b,propertyInfoProvider:this,defaultValue:a,dataType:GuiPropertyDataType.STRING,displayHint:StringPropertyDisplayHint.TEXT,shortDescription:f,longDescription:c});return e};PropertyInfoProvider.prototype.createDefaultStringSeedPropertyInfo=function(d,b,a,f,c){var e=new GuiPropertyInfo({propertyName:d,propertyCaption:b,propertyInfoProvider:this,defaultValue:a,dataType:GuiPropertyDataType.STRING,displayHint:StringPropertyDisplayHint.TEXT,shortDescription:f,longDescription:c});return e};PropertyInfoProvider.prototype.createStringTextAreaPropertyInfo=function(c,b,a){var d=new GuiPropertyInfo({propertyName:c,propertyCaption:b,propertyInfoProvider:this,defaultValue:a,dataType:GuiPropertyDataType.STRING,displayHint:StringPropertyDisplayHint.TEXT_AREA});return d};PropertyInfoProvider.prototype.createDefaultMinIntPropertyInfo=function(d,b,a,c){var e=this.createDefaultIntPropertyInfo(d,b,a);e.constraints=[{getMinValue:function(){return c}}];return e};PropertyInfoProvider.prototype.createDefaultMinMaxIntPropertyInfo=function(d,b,a,c,f){var e=this.createDefaultIntPropertyInfo(d,b,a);e.constraints=[{getMinValue:function(){return c},getMaxValue:function(){return f}}];return e};PropertyInfoProvider.prototype.createDefaultMinFloatPropertyInfo=function(d,b,a,c){var e=this.createDefaultFloatPropertyInfo(d,b,a);e.constraints=[{getMinValue:function(){return c}}];return e};PropertyInfoProvider.prototype.createDefaultMinMaxFloatPropertyInfo=function(d,b,a,c,f){var e=this.createDefaultFloatPropertyInfo(d,b,a);e.constraints=[{getMinValue:function(){return c},getMaxValue:function(){return f}}];return e};PropertyInfoProvider.prototype.createDefaultRangePropertyInfo=function(e,c,a,b,d){var g=[{lengthValid:function(h){return h.length==2},lowerUpperValid:function(h){return h[0]<=h[1]},isValid:function(i,h,j){return this.lengthValid(j)&&this.lowerUpperValid(j)},getInvalidDescription:function(i,h,j){if(!this.lengthValid(j)){return"Invalid range. Specify a lower and an upper limit"}if(!this.lowerUpperValid(j)){return"Invalid range. The first value must not be larger than the second"}return""}}];if(d){addAll(g,d)}var f=new GuiPropertyInfo({propertyName:e,propertyCaption:c,propertyInfoProvider:this,defaultValue:a,dataType:b,constraints:g,displayHint:NumberPropertyDisplayHint.TEXT});return f};PropertyInfoProvider.prototype.createDefaultIntRangePropertyInfo=function(d,b,a,c){return this.createDefaultRangePropertyInfo(d,b,a,GuiPropertyDataType.INT_LIST,c)};PropertyInfoProvider.prototype.createDefaultFloatRangePropertyInfo=function(d,b,a,c){return this.createDefaultRangePropertyInfo(d,b,a,GuiPropertyDataType.FLOAT_LIST,c)};PropertyInfoProvider.prototype.createDefaultRangeListPropertyInfo=function(e,c,a,b,d){var g=[];if(d){addAll(g,d)}g.push({rangeLengthValid:function(h){return h.length==2},lowerUpperValid:function(h){return h[0]<=h[1]},rangeValid:function(h){return this.rangeLengthValid(h)&&this.lowerUpperValid(h)},isValid:function(k,j,m){for(var l=0;l<m.length;l++){var h=m[l];if(!this.rangeValid(h)){return false}}return true},getInvalidDescription:function(k,j,m){for(var l=0;l<m.length;l++){var h=m[l];if(!this.rangeLengthValid(h)){return"Invalid range: "+h.join(",")+". Specify a lower and an upper limit"}if(!this.lowerUpperValid(h)){return"Invalid range: "+h.join(",")+". The first value must not be larger than the second"}}return""}});var f=new GuiPropertyInfo({propertyName:e,propertyCaption:c,propertyInfoProvider:this,defaultValue:a,dataType:b,constraints:g,displayHint:NumberPropertyDisplayHint.TEXT});return f};PropertyInfoProvider.prototype.createDefaultIntListPropertyInfo=function(d,b,a,c){var f=[];if(c){addAll(f,c)}var e=new GuiPropertyInfo({propertyName:d,propertyCaption:b,propertyInfoProvider:this,defaultValue:a,constraints:f,dataType:GuiPropertyDataType.INT_LIST,displayHint:NumberPropertyDisplayHint.TEXT});return e};PropertyInfoProvider.prototype.createDefaultIndexListPropertyInfo=function(c,b,a){return this.createDefaultIntListPropertyInfo(c,b,a,[new ArrayElementConstraint(new MinPropertyConstraint(0))])};PropertyInfoProvider.prototype.createDefaultIntList2DPropertyInfo=function(c,b,a){var d=new GuiPropertyInfo({propertyName:c,propertyCaption:b,propertyInfoProvider:this,defaultValue:a,dataType:GuiPropertyDataType.INT_LIST_2D,displayHint:NumberPropertyDisplayHint.TEXT});return d};PropertyInfoProvider.prototype.createDefaultFloatList2DPropertyInfo=function(c,b,a){var d=new GuiPropertyInfo({propertyName:c,propertyCaption:b,propertyInfoProvider:this,defaultValue:a,dataType:GuiPropertyDataType.FLOAT_LIST_2D,displayHint:NumberPropertyDisplayHint.TEXT});return d};PropertyInfoProvider.prototype.createDefaultIntRangeListPropertyInfo=function(c,b,a){var d=this.createDefaultIntList2DPropertyInfo(c,b,a);d.constraints=[{onePresent:function(e){return e.length>0},lengthValid:function(e){for(var f=0;f<e.length;f++){if(e[f].length!=2){return false}}return true},lowerUpperValid:function(e){for(var f=0;f<e.length;f++){if(e[f][0]>e[f][1]){return false}}return true},isValid:function(f,e,g){return this.onePresent(g)&&this.lengthValid(g)&&this.lowerUpperValid(g)},getInvalidDescription:function(f,e,g){if(!this.onePresent(g)){return"There must be at least one range specified"}if(!this.lengthValid(g)){return"Invalid range. Specify lower and upper limits"}if(!this.lowerUpperValid(g)){return"Invalid range. The first value must not be larger than the second"}return""}}];return d};PropertyInfoProvider.prototype.createDefaultProbabilityListPropertyInfo=function(c,b,a){return this.createDefaultFloatListPropertyInfo(c,b,a,[new ArrayElementConstraint(new RangePropertyConstraint([0,1]))])};PropertyInfoProvider.prototype.createDefaultLikelihoodListPropertyInfo=function(c,b,a){return this.createDefaultFloatListPropertyInfo(c,b,a,[new ArrayElementConstraint(new MinPropertyConstraint(0))])};PropertyInfoProvider.prototype.createDefaultFloatListPropertyInfo=function(d,b,a,c){var f=[];if(c){addAll(f,c)}var e=new GuiPropertyInfo({propertyName:d,propertyCaption:b,propertyInfoProvider:this,defaultValue:a,constraints:f,dataType:GuiPropertyDataType.FLOAT_LIST,displayHint:NumberPropertyDisplayHint.TEXT});return e};PropertyInfoProvider.prototype.createStrengthPropertyInfo=function(c,b,a){var d=new GuiPropertyInfo({propertyName:c,propertyCaption:b,propertyInfoProvider:this,defaultValue:a,dataType:GuiPropertyDataType.FLOAT,displayHint:NumberPropertyDisplayHint.TEXT,constraints:[{isValid:function(f,e,g){return g>=0},getInvalidDescription:function(f,e,g){if(g<0){return b+" must not be less than 0"}}}]});return d};PropertyInfoProvider.prototype.createEnumPropertyInfo=function(d,c,b,a){var e=new GuiPropertyInfo({propertyName:d,propertyCaption:c,propertyInfoProvider:this,defaultValue:b,dataType:GuiPropertyDataType.INT,displayHint:NumberPropertyDisplayHint.SELECT,possibleValues:a.getPossibleValues(),displayFunction:function(g,f,h){return a.toString(h)}});return e};PropertyInfoProvider.prototype.createEnumListPropertyInfo=function(d,c,b,a){var e=new GuiPropertyInfo({propertyName:d,propertyCaption:c,propertyInfoProvider:this,defaultValue:[],dataType:GuiPropertyDataType.INT_LIST,displayHint:NumberListPropertyDisplayHint.SELECT_LIST,listInfo:new GuiListInfo({constructorInfos:[new GuiConstructorInfo({name:"stuff",text:"New",nameIsConstructor:false,createValue:function(){return b}})],itemsDisplayFunction:function(f){return a.toString(f)},possibleValues:a.getPossibleValues()})});return e};PropertyInfoProvider.prototype.createProcedureButtonPropertyInfo=function(a,e,d,b){var c=new GuiPropertyInfo({propertyName:e,propertyCaption:a,propertyInfoProvider:this,dataType:GuiPropertyDataType.PROCEDURE,displayHint:ProcedureDisplayHint.BUTTON,procedureInfo:new GuiProcedureInfo({args:b,targetObject:d})});return c};PropertyInfoProvider.prototype.createUniqueIdPropertyInfo=function(b,a){var c=new GuiPropertyInfo({propertyName:"id",propertyCaption:"Name",propertyInfoProvider:this,defaultValue:b+"1",dataType:GuiPropertyDataType.UNIQUE_ID,displayHint:UniqueIdPropertyDisplayHint.TEXT,uniqueIdInfo:a});return c};PropertyInfoProvider.prototype.createPreviewPropertyInfo=function(c){var a=this.module;var b=new GuiPropertyInfo({otherInfo:new GuiOtherInfo({componentConstructor:c,data:a}),dataType:GuiPropertyDataType.OTHER});return b};PropertyInfoProvider.prototype.createIdReferencePropertyInfo=function(c,b,a){var d=new GuiPropertyInfo({propertyName:c,propertyCaption:b,propertyInfoProvider:this,defaultValue:"",dataType:GuiPropertyDataType.ID_REFERENCE,displayHint:IdReferencePropertyDisplayHint.SELECT,uniqueIdInfo:a});return d};PropertyInfoProvider.prototype.createIdReferenceListPropertyInfo=function(c,b,a){var d=new GuiPropertyInfo({propertyName:c,propertyCaption:b,propertyInfoProvider:this,dataType:GuiPropertyDataType.ID_REFERENCE_LIST,displayHint:IdReferencePropertyDisplayHint.SELECT,uniqueIdInfo:a,listInfo:new GuiListInfo({constructorInfos:[new GuiConstructorInfo({name:"stuff",text:"New",nameIsConstructor:false,createValue:function(){return""}})],itemsDisplayFunction:function(e){return e}})});return d};PropertyInfoProvider.prototype.createIdReferenceNotSelfPropertyInfo=function(c,b,a){var d=this.createIdReferencePropertyInfo(c,b,a);d.constraints=[{isValid:function(f,e,g){return f.id!=g},getInvalidDescription:function(f,e,g){if(f.id==g){return"No self reference allowed"}return""}}];return d};PropertyInfoProvider.prototype.createObjectPropertyInfo=function(e,j,f,g){var h=this;var b=new GuiPropertyInfo({propertyName:e,propertyCaption:j,propertyInfoProvider:this,defaultValue:[],dataType:GuiPropertyDataType.OBJECT,uniqueIdInfo:f});var a=[];for(var c=0;c<g.length;c++){var d=g[c];a.push(new GuiConstructorInfo({name:d[0],text:d[1]}))}b.objectInfo=new GuiObjectInfo({constructorInfos:a});return b};PropertyInfoProvider.prototype.createSongPartStructureInfoDataSampleListPropertyInfo=function(b,a,c){var d=this.createObjectListPropertyInfo(b,a,c,[["SongPartStructureInfoDataSample","Song Part Structure Likelihood"]]);d.listInfo.itemsDisplayFunction=function(f){var h=[];var e=f.data;for(var g=0;g<e.length;g++){h.push(SongPartType.toString(e[g].partType))}return"Structure ("+h.join(", ")+"), Likelihood: "+f.likelihood};return d};PropertyInfoProvider.prototype.createSongPartStructureInfoListPropertyInfo=function(b,a,c){var d=this.createObjectListPropertyInfo(b,a,c,[["SongPartStructureInfo","Song Part Structure"]]);d.listInfo.itemsDisplayFunction=function(e){return SongPartType.toString(e.partType)};return d};PropertyInfoProvider.prototype.createPhraseGroupTypeDataSampleListPropertyInfo=function(b,a,c){var d=this.createObjectListPropertyInfo(b,a,c,[["PhraseGroupTypeDataSample","Phrase group likelihood"]]);d.listInfo.itemsDisplayFunction=function(e){return SimpleModuleGeneratorPhraseGroupType.toString(e.data)+", Likelihood: "+e.likelihood};return d};PropertyInfoProvider.prototype.createMidiProgramDataSampleListPropertyInfo=function(b,a,c){var d=this.createObjectListPropertyInfo(b,a,c,[["MidiProgramDataSample","Instrument Likelihood"]]);d.listInfo.itemsDisplayFunction=function(e){return MidiProgram.toString(e.data)+", Likelihood: "+e.likelihood};return d};PropertyInfoProvider.prototype.createMidiDrumDataSampleListPropertyInfo=function(b,a,c){var d=this.createObjectListPropertyInfo(b,a,c,[["MidiDrumDataSample","Drum Likelihood"]]);d.listInfo.itemsDisplayFunction=function(e){return MidiDrum.toString(e.data)+", Likelihood: "+e.likelihood};return d};PropertyInfoProvider.prototype.createIntDataSampleListPropertyInfo=function(b,a,c){var d=this.createObjectListPropertyInfo(b,a,c,[["IntDataSample","Int Likelihood"]]);d.listInfo.itemsDisplayFunction=function(e){return"Value: "+e.data+", Likelihood: "+e.likelihood};return d};PropertyInfoProvider.prototype.createIntListDataSampleListPropertyInfo=function(b,a,c){var d=this.createObjectListPropertyInfo(b,a,c,[["IntListDataSample","Int List Likelihood"]]);d.listInfo.itemsDisplayFunction=function(e){return"Value: "+e.data.join(", ")+", Likelihood: "+e.likelihood};return d};PropertyInfoProvider.prototype.createFloatDataSampleListPropertyInfo=function(b,a,c){var d=this.createObjectListPropertyInfo(b,a,c,[["FloatDataSample","Float Likelihood"]]);d.listInfo.itemsDisplayFunction=function(e){return"Value: "+e.data+", Likelihood: "+e.likelihood};return d};PropertyInfoProvider.prototype.createFloatListDataSampleListPropertyInfo=function(b,a,c){var d=this.createObjectListPropertyInfo(b,a,c,[["FloatListDataSample","Float List Likelihood"]]);d.listInfo.itemsDisplayFunction=function(e){return"Value: "+e.data.join(", ")+", Likelihood: "+e.likelihood};return d};PropertyInfoProvider.prototype.createObjectListPropertyInfo=function(e,j,f,g){var h=this;var b=new GuiPropertyInfo({propertyName:e,propertyCaption:j,propertyInfoProvider:this,defaultValue:[],dataType:GuiPropertyDataType.OBJECT_LIST,uniqueIdInfo:f,propertyInfoProvider:h});var a=[];for(var c=0;c<g.length;c++){var d=g[c];a.push(new GuiConstructorInfo({name:d[0],text:d[1]}))}b.listInfo=new GuiListInfo({constructorInfos:a});return b};PropertyInfoProvider.prototype.createObjectListInTabPropertyInfo=function(e,d,c,a,g,b){var f=this.createObjectListPropertyInfo(e,d,c,a);if(!g){g=d}if(!b){b=d}f.splitInfo=new GuiSplitInfo({group:g,groupCaption:b});return f};PropertyInfoProvider.prototype.getUniqueNamespace=function(b){if(!this.uniqueNamespaces){this.uniqueNamespaces={}}var a=Math.round(Math.random()*99999999);var c=b+""+a;while(true){if(!this.uniqueNamespaces[c]){this.uniqueNamespaces[c]=true;break}a++;c=b+""+a}return c};PropertyInfoProvider.prototype.getOrCreateUniqueIdInfo=function(e,a,d){if(!e.__uniqueIdInfos){e.__uniqueIdInfos={}}var c=e.__uniqueIdInfos[a];if(!c){var f=this.uniqueIdManager;var b=this.getUniqueNamespace(a);c=new GuiUniqueIdInfo({manager:f,namespace:b,initPrefix:d});e.__uniqueIdInfos[a]=c}return c};PropertyInfoProvider.prototype.getMixableExportPropertyInfos=function(a){var b=[new ArrayElementConstraint(new RangePropertyConstraint([0,1]))];a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("melodyVolumeMultipliers","Melody Volume Multipliers",[1],b));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("inner1VolumeMultipliers","Inner 1 Volume Multipliers",[1],b));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("inner2VolumeMultipliers","Inner 2 Volume Multipliers",[1],b));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("bassVolumeMultipliers","Bass Volume Multipliers",[1],b));a.addPropertyInfo(this.createDefaultMinMaxFloatPropertyInfo("percussionVolumeMultiplier","Percussion Volume Multiplier",1,0,1));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("melodyReverbSends","Melody Reverb Sends",[1],b));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("melodyChorusSends","Melody Chorus Sends",[40/127],b));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("bassReverbSends","Bass Reverb Sends",[10/127],b));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("bassChorusSends","Bass Chorus Sends",[10/127],b));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("inner1ReverbSends","Inner 1 Reverb Sends",[10/127],b));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("inner1ChorusSends","Inner 1 Chorus Sends",[10/127],b));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("inner2ReverbSends","Inner 2 Reverb Sends",[10/127],b));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("inner2ChorusSends","Inner 2 Chorus Sends",[10/127],b));a.addPropertyInfo(this.createDefaultMinMaxFloatPropertyInfo("percussionReverbSend","Percussion Reverb Send",0,0,1));a.addPropertyInfo(this.createDefaultMinMaxFloatPropertyInfo("percussionChorusSend","Percussion Chorus Send",0,0,1))};PropertyInfoProvider.prototype.getMidiExportPropertyInfos=function(a){a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("exportVolume","Export Volume",true));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("exportEffects","Export Effects",true));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("mergeChannels","Merge Channels",false));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("exportChordsToNewChannel","Export Chords to New Channel",false));this.getMixableExportPropertyInfos(a)};PropertyInfoProvider.prototype.getWavExportPropertyInfos=function(a){a.addPropertyInfo(this.createEnumPropertyInfo("soundFontType","Sound Font",SoundFontType.STANDARD_LIGHT,SoundFontType));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("normalizeRenderedResult","Normalize",false));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("compressRenderedResult","Compress",false));this.getMidiExportPropertyInfos(a)};PropertyInfoProvider.prototype.getWavClientExportPropertyInfos=function(a){this.getMidiExportPropertyInfos(a)};PropertyInfoProvider.prototype.getDataSamplePropertyInfos=function(a){a.addPropertyInfo(this.createDefaultMinFloatPropertyInfo("likelihood","Likelihood",1,0));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("active","Active",true))};PropertyInfoProvider.prototype.getPlannedHarmonyElementPropertyInfos=function(a){a.addPropertyInfo(this.createDefaultIntPropertyInfo("scaleBaseNote","Scale base note",60));a.addPropertyInfo(this.createEnumPropertyInfo("scaleType","Scale type",ScaleType.MAJOR,ScaleType));a.addPropertyInfo(this.createDefaultIntPropertyInfo("seed","Seed",12345));this.getSequenceHarmonyElementPropertyInfos(a)};PropertyInfoProvider.prototype.getSequenceHarmonyElementPropertyInfos=function(a){a.addPropertyInfo(this.createEnumPropertyInfo("harmonyLengthMode","Length Mode",HarmonyLengthMode.RYTHM_ONLY,HarmonyLengthMode));a.addPropertyInfo(this.createDefaultMinMaxIntPropertyInfo("count","Count",4,1,32));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("lengthPattern","Length pattern",[1],[new ArrayMinLengthConstraint(1),new ArrayElementConstraint(new MinPropertyConstraint(0.01))]));a.addPropertyInfo(this.createEnumPropertyInfo("lengthPatternUnit","Length pattern unit",PositionUnit.MEASURES,PositionUnit));a.addPropertyInfo(this.createDefaultMinMaxFloatPropertyInfo("totalLength","Total length ()",1,0.001,128));a.addPropertyInfo(this.createEnumPropertyInfo("totalLengthUnit","Total length unit",PositionUnit.MEASURES,PositionUnit));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("setTotalLengthExternally","Set total length externally",false));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("beatStrengths","Beat strengths",[1,0.8,0.9,0.6,0.3,0.4,0.2],[new ArrayMinLengthConstraint(1)]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("tsNumerators","Beats per measures",[4],[new ArrayMinLengthConstraint(1)]));a.addPropertyInfo(this.createDefaultIntPropertyInfo("rythmTsNumerator","Rythm beats per measure",4));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("setTsNumeratorExternally","Set beats per measure externally",false))};PropertyInfoProvider.prototype.getGuiPropertyInfos=function(d,b){var a=new GuiPropertyInfos();switch(d._constructorName){case"UserInfo":a.addPropertyInfo(this.createDefaultStringPropertyInfo("name","Name","","Your name"));a.addPropertyInfo(this.createDefaultStringPropertyInfo("email","Email","","Your email address"));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("subscribe","Subscribe to news","","Whether to subscribe to the newsletter or not"));break;case"VoiceChordNotesVoiceLinePlannerConstraint":a.addPropertyInfo(this.createDefaultIntList2DPropertyInfo("chordRootPitchClassConstraints","Voice chord roots",[]));a.addPropertyInfo(this.createDefaultIntList2DPropertyInfo("chordRootPitchClassConstraintCosts","Voice chord root costs",[]));break;case"PhraseHarmonyElement":a.addPropertyInfo(this.createEnumPropertyInfo("phraseType","Phrase type",PhraseHarmonyElementType.COMPLETE,PhraseHarmonyElementType));a.addPropertyInfo(this.createEnumPropertyInfo("majorModulationTarget","Major modulation target",DynamicHarmonyModulationTarget.DOMINANT,DynamicHarmonyModulationTarget));a.addPropertyInfo(this.createEnumPropertyInfo("minorModulationTarget","Minor modulation target",DynamicHarmonyModulationTarget.MEDIANT,DynamicHarmonyModulationTarget));a.addPropertyInfo(this.createDefaultIntPropertyInfo("majorDeceptiveRoot","Major deceptive root",5));a.addPropertyInfo(this.createDefaultIntPropertyInfo("minorDeceptiveRoot","Minor deceptive root",5));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("raiseLeadingTone","Raise leading tone",true));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("staticHarmonyLength","Static harmony length",25));a.addPropertyInfo(this.createEnumPropertyInfo("staticHarmonyLengthUnit","Static harmony length unit",LengthAndCountUnit.LENGTH_PERCENT,LengthAndCountUnit));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("staticHarmonySus2ChordLikelihood","Static harmony sus2 likelihood",1));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("staticHarmonySus4ChordLikelihood","Static harmony sus4 likelihood",1));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("staticHarmonySimpleMixtureLikelihood","Static harmony mixture likelihood",1));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("dynamicHarmonyLength","Dynamic harmony length",25));a.addPropertyInfo(this.createEnumPropertyInfo("dynamicHarmonyLengthUnit","Dynamic harmony length unit",LengthAndCountUnit.LENGTH_PERCENT,LengthAndCountUnit));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("dynamicHarmonySus2ChordLikelihood","Dynamic harmony sus2 likelihood",1));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("dynamicHarmonySus4ChordLikelihood","Dynamic harmony sus4 likelihood",1));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("dynamicHarmonySimpleMixtureLikelihood","Dynamic harmony mixture likelihood",1));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("dominantCadenceHarmonyLength","Dominant cadence harmony length",25));a.addPropertyInfo(this.createEnumPropertyInfo("dominantCadenceHarmonyLengthUnit","Dominant cadence harmony length unit",LengthAndCountUnit.LENGTH_PERCENT,LengthAndCountUnit));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("dominantCadenceHarmonySus2ChordLikelihood","Dominant cadence harmony sus2 likelihood",1));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("dominantCadenceHarmonySus4ChordLikelihood","Dominant cadence harmony sus4 likelihood",1));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("dominantCadenceHarmonySimpleMixtureLikelihood","Dominant cadence harmony mixture likelihood",1));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("tonicCadenceHarmonyLength","Tonic cadence harmony length",25));a.addPropertyInfo(this.createEnumPropertyInfo("tonicCadenceHarmonyLengthUnit","Tonic cadence harmony length unit",LengthAndCountUnit.LENGTH_PERCENT,LengthAndCountUnit));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("tonicCadenceHarmonySus2ChordLikelihood","Tonic cadence harmony sus2 likelihood",1));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("tonicCadenceHarmonySus4ChordLikelihood","Tonic cadence harmony sus4 likelihood",1));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("tonicCadenceHarmonySimpleMixtureLikelihood","Tonic cadence harmony mixture likelihood",1));this.getPlannedHarmonyElementPropertyInfos(a);break;case"SimpleSequenceHarmonyElement":a.addPropertyInfo(this.createDefaultIntListPropertyInfo("scaleBaseNotes","Scale base notes",[60]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("scaleBaseNoteIndices","Scale base note indices",[0]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("startScaleBaseNoteIndices","Start scale base note indices",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("endScaleBaseNoteIndices","End scale base note indices",[]));a.addPropertyInfo(this.createEnumListPropertyInfo("scaleTypes","Scale types",ScaleType.MAJOR,ScaleType));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("scaleTypeIndices","Scale type indices",[0]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("startScaleTypeIndices","Start scale type indices",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("endScaleTypeIndices","End scale type indices",[]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("scaleModes","Scale modes",[0]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("startScaleModes","Start scale modes",[]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("endScaleModes","End scale modes",[]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("chordRoots","Chord roots",[0]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("startChordRoots","Start chord roots",[]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("endChordRoots","End chord roots",[]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("chordInversions","Chord inversions",[0],[new ArrayElementConstraint(new RangePropertyConstraint([0,3]))]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("startChordInversions","Start chord inversions",[],[new ArrayElementConstraint(new RangePropertyConstraint([0,3]))]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("endChordInversions","End chord inversions",[],[new ArrayElementConstraint(new RangePropertyConstraint([0,3]))]));a.addPropertyInfo(this.createEnumListPropertyInfo("chordTypes","Chord types",ChordType.TRIAD,ChordType));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("chordTypeIndices","Chord type indices",[0]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("startChordTypeIndices","Start chord type indices",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("endChordTypeIndices","End chord type indices",[]));a.addPropertyInfo(this.createDefaultIntList2DPropertyInfo("customScales","Custom scales",[[0,2,3,5,7,9,11]]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("customScaleIndices","Custom scale indices",[0]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("startCustomScaleIndices","Start custom scale indices",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("endCustomScaleIndices","End custom scale indices",[]));a.addPropertyInfo(this.createDefaultIntList2DPropertyInfo("customChords","Custom chords",[[0,2,4]]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("customChordIndices","Custom chord indices",[0]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("startCustomChordIndices","Start custom chord indices",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("endCustomChordIndices","End custom chord indices",[]));this.getSequenceHarmonyElementPropertyInfos(a);var c=this.createObjectListPropertyInfo("voiceLineConstraints","Voice line constraints",this.phraseGroupTypesUidInfo,[["VoiceChordNotesVoiceLinePlannerConstraint","Voice chord notes constraint"]]);c.listInfo.itemsDisplayFunction=function(f){var e="Voice line constraint ("+f._constructorName+")";return e};a.addPropertyInfo(c);a.addPropertyInfo(this.createDefaultIntList2DPropertyInfo("voiceLineConstraintIndices","Voice line constraint indices",[]));a.addPropertyInfo(this.createDefaultIntList2DPropertyInfo("startVoiceLineConstraintIndices","Start voice line constraint indices",[]));a.addPropertyInfo(this.createDefaultIntList2DPropertyInfo("endVoiceLineConstraintIndices","End voice line constraint indices",[]));break;case"SongPartStructureInfo":a.addPropertyInfo(this.createEnumPropertyInfo("partType","Part Type",SongPartType.VERSE_1,SongPartType));a.addPropertyInfo(this.createEnumPropertyInfo("strength","Strength",SongPartStrength.DEFAULT,SongPartStrength));a.addPropertyInfo(this.createDefaultProbabilityListPropertyInfo("prefixProbsOverride","Prefix Group Probabilities (Override)",[]));a.addPropertyInfo(this.createDefaultProbabilityListPropertyInfo("postfixProbsOverride","Postfix Group Probabilities (Override)",[]));a.addPropertyInfo(this.createEnumPropertyInfo("majorGroupModulationTarget","Major Group Modulation Target",DynamicHarmonyModulationTarget.NONE,DynamicHarmonyModulationTarget));a.addPropertyInfo(this.createEnumPropertyInfo("minorGroupModulationTarget","Minor Group Modulation Target",DynamicHarmonyModulationTarget.NONE,DynamicHarmonyModulationTarget));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("melodyRenderAmountOverride","Melody render amount overrides",[]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("inner1RenderAmountOverride","Inner 1 render amount overrides",[]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("inner2RenderAmountOverride","Inner 2 render amount overrides",[]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("bassRenderAmountOverride","Bass render amount overrides",[]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("percussionRenderAmountOverride","Percussion render amount overrides",[]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("harmonyRythmCountOverrides","Harmony rythm count overrides",[],[new ArrayElementConstraint(new RangePropertyConstraint([1,32]))]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("harmonyTotalLengthOverrides","Harmony total length overrides",[],[new ArrayElementConstraint(new RangePropertyConstraint([0.125,32]))]));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overrideScaleBaseNote","Override scale base note",false));a.addPropertyInfo(this.createDefaultMinMaxIntPropertyInfo("scaleBaseNote","Scale base note",60,0,127));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overrideScaleType","Override scale type",false));a.addPropertyInfo(this.createEnumPropertyInfo("scaleType","Scale type",SimpleScaleType.MAJOR,SimpleScaleType));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overridePhraseGroupType","Override phrase group type",false));a.addPropertyInfo(this.createEnumPropertyInfo("phraseGroupType","Phrase group type",SimpleModuleGeneratorPhraseGroupType.ANTECEDENT_CONSEQUENT_SHORTEN,SimpleModuleGeneratorPhraseGroupType));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overrideMajorModulationTarget","Override major modulation/tonicization target",false));a.addPropertyInfo(this.createEnumPropertyInfo("majorModulationTarget","Major modulation/tonicization target",DynamicHarmonyModulationTarget.DOMINANT,DynamicHarmonyModulationTarget));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overrideMinorModulationTarget","Override minor modulation/tonicization target",false));a.addPropertyInfo(this.createEnumPropertyInfo("minorModulationTarget","Minor modulation/tonicization target",DynamicHarmonyModulationTarget.DOMINANT,DynamicHarmonyModulationTarget));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("harmonyElementIndices","Custom harmony indices",[0]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("customMelodyCurveIndices","Custom melody indices",[]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("customBassCurveIndices","Custom bass indices",[]));a.addPropertyInfo(this.createDefaultIntList2DPropertyInfo("extraMelodyRenderElementIndices","Extra melody render elements",[]));break;case"ModulationTargetDataSample":a.addPropertyInfo(this.createEnumPropertyInfo("data","Data",DynamicHarmonyModulationTarget.MEDIANT,DynamicHarmonyModulationTarget));this.getDataSamplePropertyInfos(a);break;case"PhraseGroupTypeDataSample":a.addPropertyInfo(this.createEnumPropertyInfo("data","Data",SimpleModuleGeneratorPhraseGroupType.ANTECEDENT_CONSEQUENT,SimpleModuleGeneratorPhraseGroupType));this.getDataSamplePropertyInfos(a);break;case"SongPartStructureInfoDataSample":a.addPropertyInfo(this.createSongPartStructureInfoListPropertyInfo("data","Data",this.spsiUidInfo));this.getDataSamplePropertyInfos(a);break;case"MidiProgramDataSample":a.addPropertyInfo(this.createEnumPropertyInfo("data","Data",MidiProgram.ACOUSTIC_GRAND_PIANO,MidiProgram));this.getDataSamplePropertyInfos(a);break;case"MidiDrumDataSample":a.addPropertyInfo(this.createEnumPropertyInfo("data","Data",MidiDrum.BASS_DRUM_1,MidiDrum));this.getDataSamplePropertyInfos(a);break;case"IntDataSample":a.addPropertyInfo(this.createDefaultIntPropertyInfo("data","Data",0));this.getDataSamplePropertyInfos(a);break;case"IntListDataSample":a.addPropertyInfo(this.createDefaultIntListPropertyInfo("data","Data",[]));this.getDataSamplePropertyInfos(a);break;case"FloatDataSample":a.addPropertyInfo(this.createDefaultFloatPropertyInfo("data","Data",0));this.getDataSamplePropertyInfos(a);break;case"FloatListDataSample":a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("data","Data",[]));this.getDataSamplePropertyInfos(a);break;case"PrimitiveWebAudioPlayerInstrument":a.addPropertyInfo(this.createEnumPropertyInfo("type","Type",PrimitiveWebAudioPlayerInstrumentType.SAW,PrimitiveWebAudioPlayerInstrumentType));break;case"WebAudioPlayerSettings":var c=this.createObjectListPropertyInfo("melodyInstruments","Melody instruments",this.phraseGroupTypesUidInfo,[["PrimitiveWebAudioPlayerInstrument","Primitive"]]);c.listInfo.itemsDisplayFunction=function(e){return"Instrument ("+e._constructorName+")"};a.addPropertyInfo(c);var c=this.createObjectListPropertyInfo("inner1Instruments","Inner 1 instruments",this.phraseGroupTypesUidInfo,[["PrimitiveWebAudioPlayerInstrument","Primitive"]]);c.listInfo.itemsDisplayFunction=function(e){return"Instrument ("+e._constructorName+")"};a.addPropertyInfo(c);var c=this.createObjectListPropertyInfo("inner2Instruments","Inner 2 instruments",this.phraseGroupTypesUidInfo,[["PrimitiveWebAudioPlayerInstrument","Primitive"]]);c.listInfo.itemsDisplayFunction=function(e){return"Instrument ("+e._constructorName+")"};a.addPropertyInfo(c);var c=this.createObjectListPropertyInfo("bassInstruments","Bass instruments",this.phraseGroupTypesUidInfo,[["PrimitiveWebAudioPlayerInstrument","Primitive"]]);c.listInfo.itemsDisplayFunction=function(e){return"Instrument ("+e._constructorName+")"};a.addPropertyInfo(c);this.getMixableExportPropertyInfos(a);break;case"SoundManager2PlayerSettings":case"PlayerSettings":this.getMidiExportPropertyInfos(a);break;case"MidiExportSettings":a.addPropertyInfo(this.createProcedureButtonPropertyInfo("Export Midi","export2",{export2:function(){exportMidi()}}));this.getMidiExportPropertyInfos(a);break;case"WavExportSettings":a.addPropertyInfo(this.createProcedureButtonPropertyInfo("Export Wav","export2",{export2:function(){exportWav()}}));this.getWavExportPropertyInfos(a);break;case"WavClientExportSettings":a.addPropertyInfo(this.createProcedureButtonPropertyInfo("Export Wav","export2",{export2:function(){exportWav()}}));this.getWavClientExportPropertyInfos(a);break;case"Mp3ExportSettings":a.addPropertyInfo(this.createProcedureButtonPropertyInfo("Export Mp3","export2",{export2:function(){exportMp3()}}));this.getWavExportPropertyInfos(a);break;case"OggExportSettings":a.addPropertyInfo(this.createProcedureButtonPropertyInfo("Export Ogg","export2",{export2:function(){exportOgg()}}));this.getWavExportPropertyInfos(a);break;case"ItExportSettings":a.addPropertyInfo(this.createProcedureButtonPropertyInfo("Export IT","export2",{export2:function(){exportIT()}}));break;case"ThemeSettings":a.addPropertyInfo(this.createEnumPropertyInfo("theme","Theme (refresh page to see change)",JQueryUITheme.BLITZER,JQueryUITheme));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("transparentDialogs","Use transparent dialogs",false));break;case"Visualizer3DSettings":a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("on","On",true));a.addPropertyInfo(this.createDefaultMinMaxIntPropertyInfo("webGLFps","FPS (WebGL)",20,1,60));a.addPropertyInfo(this.createDefaultMinMaxIntPropertyInfo("context2DFps","FPS (2D Context)",5,1,60));a.addPropertyInfo(this.createEnumPropertyInfo("stopMovementMode","Stop Movement Mode",Visualizer3DStopMovementMode.PAN,Visualizer3DStopMovementMode));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("forceContext2D","Force 2D Context",false));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("usePerspective","Perspective mode",true));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("addBloom","Add Bloom",true));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("addSimulatedAA","Add Simulated Antialising",true));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("addVignette","Add Vignette",true));break;case"SongSettings":a.addPropertyInfo(this.createDefaultStringPropertyInfo("name","Name","","The name of your song. This is the name that shows up in the 'My Songs' tab"));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("seed","Seed","","The main seed. Determines all the sub seeds for structure, content and indices."));break;case"SongContentSeedSettings":a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("instrumentTypeSeed","Instrument Type Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("melodyInstrumentSeed","Melody Instrument Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("inner1InstrumentSeed","Inner 1 Instrument Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("inner2InstrumentSeed","Inner 2 Instrument Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("bassInstrumentSeed","Bass Instrument Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("melodyMotifSeed","Melody Motif Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("melodyMotifRythmSeed","Melody Rythm Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("melodyMotifEmbellishConnectSeed","Melody Connect Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("bassMotifSeed","Bass Motif Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("bassMotifRythmSeed","Bass Rythm Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("bassMotifEmbellishConnectSeed","Bass Connect Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("harmonyMotifSeed","Harmony Motif Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("harmonyMotifRythmSeed","Harmony Motif Rythm Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("harmonyMotifEmbellishConnectSeed","Harmony Motif Connect Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("percussionMotifSeed","Percussion Motif Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("percussionFillMotifSeed","Percussion Fill Motif Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("percussionInstrumentSeed","Percussion Instrument Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("percussionFillInstrumentSeed","Percussion Fill Instrument Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("percussionMotifRythmSeed","Percussion Rythm Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("percussionFillMotifRythmSeed","Percussion Fill Rythm Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("melodyShapeSeed","Melody Shape Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("bassShapeSeed","Bass Shape Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("harmonyRythmSeed","Harmony Rythm Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("melodyMotifDistributionSeed","Melody Distribution Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("inner1MotifDistributionSeed","Inner 1 Distribution Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("inner2MotifDistributionSeed","Inner 2 Distribution Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("bassMotifDistributionSeed","Bass Distribution Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("percussionMotifDistributionSeed","Percussion Distribution Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("percussionFillMotifDistributionSeed","Percussion Fill Distribution Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("melodyHarmonyPunctationSeed","Melody Harmony Punctation Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("innerHarmonyPunctationSeed","Inner Harmony Punctation Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("harmonySeed","Harmony Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("channelDistributionSeed","Channel Distribution Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("tempoChangeSeed","Tempo Change Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("effectChangeSeed","Effect Change Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("suspendSeed","Suspend Seed",""));break;case"SongStructureSeedSettings":a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("scaleSeed","Scale Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("tsSeed","Time Signature Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("introSeed","Intro Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("endSeed","End Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("renderAmountSeed","Render Amount Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("modulationSeed","Modulation Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("tonicizationSeed","Tonicization Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("songStructureSeed","Song Structure Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("tempoSeed","Tempo Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("glueSeed","Glue Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("phraseGroupSeed","Phrase Group Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("phraseGroupSimilaritySeed","Phrase Group Similarity Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("groupSimilaritySeed","Group Similarity Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("groupDifferenceSeed","Group Difference Seed",""));break;case"SongIndicesSeedSettings":a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("melodyShapeIndicesSeed","Melody Shape Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("bassShapeIndicesSeed","Bass Shape Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("harmonyIndicesSeed","Harmony Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("harmonyRythmIndicesSeed","Harmony Rythm Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("suspendIndicesSeed","Suspend Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("melodyChannelDistributionIndicesSeed","Melody Channel Distribution Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("inner1ChannelDistributionIndicesSeed","Inner 1 Channel Distribution Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("inner2ChannelDistributionIndicesSeed","Inner 2 Channel Distribution Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("bassChannelDistributionIndicesSeed","Bass Channel Distribution Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("melodyMotifDistributionIndicesSeed","Melody Motif Distribution Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("inner1MotifDistributionIndicesSeed","Inner 1 Motif Distribution Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("inner2MotifDistributionIndicesSeed","Inner 2 Motif Distribution Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("bassMotifDistributionIndicesSeed","Bass Motif Distribution Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("percussionMotifDistributionIndicesSeed","Percussion Motif Distribution Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("percussionFillMotifDistributionIndicesSeed","Percussion Fill Distribution Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("harmonyExtraIndicesSeed","Harmony Characteristics Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("renderAmountIndicesSeed","Render Amount Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("tempoIndicesSeed","Tempo Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("sequentialTempoChangeIndicesSeed","Tempo Change 1 Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("parallelTempoChangeIndicesSeed","Tempo Change 2 Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("sequentialMelodyEffectChangeIndicesSeed","Melody Effect Change Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("sequentialInner1EffectChangeIndicesSeed","Inner 1 Effect Change Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("sequentialInner2EffectChangeIndicesSeed","Inner 2 Effect Change Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("sequentialBassEffectChangeIndicesSeed","Bass Effect Change Indices Seed",""));a.addPropertyInfo(this.createDefaultStringSeedPropertyInfo("sequentialPercussionEffectChangeIndicesSeed","Percussion Effect Change Indices Seed",""));break;case"SongParameters":a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("minorScaleLikelihood","Minor Scale Likelihood",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("majorScaleLikelihood","Major Scale Likelihood",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("timeSignature2Likelihood","2/4 Time Signature Likelihood",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("timeSignature3Likelihood","3/4 Time Signature Likelihood",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("timeSignature4Likelihood","4/4 Time Signature Likelihood",3));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("electronicLikelihood","Electronic Instruments Likelihood",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("electricLikelihood","Electric Instruments Likelihood",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("acousticLikelihood","Acoustic Instruments Likelihood",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("strictBuildSongStructureLikelihoodMultiplier","Strict Build Likelihood Multiplier",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("buildSongStructureLikelihoodMultiplier","Build Likelihood Multiplier",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("verseChorusSongStructureLikelihoodMultiplier","Verse Chorus Likelihood Multiplier",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("verseChorusBridgeSongStructureLikelihoodMultiplier","Verse Chorus Bridge Likelihood Multiplier",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("noMelodyPartSongStructureLikelihoodMultiplier","No Melody Part Likelihood Multiplier",1));a.addPropertyInfo(this.createDefaultProbabilityListPropertyInfo("percussionFillProbabilities","Percussion fill probabilities",[0.35]));a.addPropertyInfo(this.createDefaultProbabilityListPropertyInfo("raiseLeadingInMinorProbabilities","Raise Leading Probabilities",[0.5]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("tonicizeLikelihoodMultipliers","Tonicize Likelihood Multipliers",[1]));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("modulateLikelihoodMultiplier","Modulate Likelihood Multiplier",0.25));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("simpleMixtureLikelihoods","Simple Mixture Likelihoods",[1]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("sus2ChordsLikelihoods","Sus2 Chords Likelihoods",[1]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("sus4ChordsLikelihoods","Sus4 Chords Likelihoods",[1]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("neighbourChordsLikelihoods","Neighbour Chords Likelihoods",[1]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("passingChordsLikelihoods","Passing Chords Likelihoods",[1]));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("melodyMotifRythmCountIncreasePerIndex","Melody motif rythm count inc per index",0.4));a.addPropertyInfo(this.createDefaultFloatRangePropertyInfo("melodyMotifRythmCountIncreaseOffsetRange","Melody motif rythm count offet range",[0.5,1]));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("bassMotifRythmCountIncreasePerIndex","Bass motif rythm count inc per index",0.4));a.addPropertyInfo(this.createDefaultFloatRangePropertyInfo("bassMotifRythmCountIncreaseOffsetRange","Bass motif rythm count offset range",[0.25,0.75]));a.addPropertyInfo(this.createDefaultProbabilityListPropertyInfo("melodyMotifZone1Probabilities","Melody motif zone 1 probabilities",[0.5]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("melodyMotifZone1TripletLikelihoods","Melody motif zone 1 triplet likelihoods",[0.5]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("melodyMotifZone1DotFirstLikelihoods","Melody motif zone 1 dot first likelihoods",[2]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("melodyMotifZone1DotSecondLikelihoods","Melody motif zone 1 dot second likelihoods",[0.5]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("melodyMotifZone1DotNormalDotLikelihoods","Melody motif zone 1 dot normal dot likelihoods",[0.5]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("melodyMotifZone1NormalDotDotLikelihoods","Melody motif zone 1 normal dot dot likelihoods",[0.5]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("melodyMotifZone1DotDotNormalLikelihoods","Melody motif zone 1 dot dot normal likelihoods",[0.5]));a.addPropertyInfo(this.createDefaultRangeListPropertyInfo("melodyMotifZone1StartPosRanges","Melody motif zone 1 start pos ranges",[[0,0]],GuiPropertyDataType.FLOAT_LIST_2D));a.addPropertyInfo(this.createDefaultRangeListPropertyInfo("melodyMotifZone1EndPosRanges","Melody motif zone 1 end pos ranges",[[0.75,0.75]],GuiPropertyDataType.FLOAT_LIST_2D));a.addPropertyInfo(this.createDefaultRangeListPropertyInfo("melodyMotifZone1StartEnds","Melody motif zone 1 start ends",[],GuiPropertyDataType.FLOAT_LIST_2D));a.addPropertyInfo(this.createDefaultProbabilityListPropertyInfo("bassMotifZone1Probabilities","Bass motif zone 1 probabilities",[0.5]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("bassMotifZone1TripletLikelihoods","Bass motif zone 1 triplet likelihoods",[0.01]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("bassMotifZone1DotFirstLikelihoods","Bass motif zone 1 dot first likelihoods",[2]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("bassMotifZone1DotSecondLikelihoods","Bass motif zone 1 dot second likelihoods",[0.5]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("bassMotifZone1DotNormalDotLikelihoods","Bass motif zone 1 dot normal dot likelihoods",[0.5]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("bassMotifZone1NormalDotDotLikelihoods","Bass motif zone 1 normal dot dot likelihoods",[0.5]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("bassMotifZone1DotDotNormalLikelihoods","Bass motif zone 1 dot dot normal likelihoods",[0.5]));a.addPropertyInfo(this.createDefaultRangeListPropertyInfo("bassMotifZone1StartPosRanges","Bass motif zone 1 start pos ranges",[[0,0]],GuiPropertyDataType.FLOAT_LIST_2D));a.addPropertyInfo(this.createDefaultRangeListPropertyInfo("bassMotifZone1EndPosRanges","Bass motif zone 1 end pos ranges",[[0.75,0.75]],GuiPropertyDataType.FLOAT_LIST_2D));a.addPropertyInfo(this.createDefaultRangeListPropertyInfo("bassMotifZone1StartEnds","Bass motif zone 1 start ends",[],GuiPropertyDataType.FLOAT_LIST_2D));a.addPropertyInfo(this.createDefaultProbabilityPropertyInfo("allInstrumentsDifferentProbability","All Instrument Different Probability",0.35));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("adaptHarmonyRythmToTempo","Adapt Harmony Rythm to Tempo",true));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("adaptHarmonyRythmToTimeSignature","Adapt Harmony Rythm to Time Signature",true));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("adaptSuspensionToTempo","Adapt Suspension to Tempo",true));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("adaptMotifRythmsToTempo","Adapt Motif Rythms to Tempo",true));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("filterFEffectsProbMultiplier","Filter F Probability Multiplier",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("filterBWEffectsProbMultiplier","Filter BW Probability Multiplier",1));a.addPropertyInfo(this.createDefaultLikelihoodPropertyInfo("panEffectsProbMultiplier","Pan Effect Probability Multiplier",1));a.addPropertyInfo(this.createDefaultProbabilityPropertyInfo("oddHarmonyRythmProbability","Odd Harmony Rythm Probability",0.01));a.addPropertyInfo(this.createDefaultProbabilityListPropertyInfo("melodyShareProbabilities","Melody Share Probabilities",[0.3]));a.addPropertyInfo(this.createDefaultProbabilityPropertyInfo("endSongTempoChangeProbability","End Song Tempo Change Probability",0.5));a.addPropertyInfo(this.createDefaultProbabilityListPropertyInfo("endPhraseGroupTempoChangeProbabilities","End Phrase Group Tempo Change Probabilities",[0]));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("adaptTempoToRenderAmount","Adapt Tempo to Render Amount",true));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("tempoAdaptBias","Tempo Adapt Bias",3));a.addPropertyInfo(this.createDefaultFloatPropertyInfo("tempoAdaptRandomMultiplier","Tempo Adapt Random Multiplier",3));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("useNaturalTempoChanges","Use Natural Tempo Changes",true));a.addPropertyInfo(this.createDefaultProbabilityListPropertyInfo("voiceLineSuspensionProbabilities","Voice Line Suspension Probabilities",[0.5]));a.addPropertyInfo(this.createDefaultProbabilityPropertyInfo("songIntroProbability","Song Intro Probability",0.7));a.addPropertyInfo(this.createDefaultProbabilityPropertyInfo("songEndProbability","Song End Probability",0.5));a.addPropertyInfo(this.createDefaultMinMaxFloatPropertyInfo("withinPhraseGroupSimilarRandomFraction","Within Phrase Group Similar Fraction",0.35,0,1));a.addPropertyInfo(this.createDefaultMinMaxFloatPropertyInfo("withinPhraseGroupSimilarBias","Within Phrase Group Similar Bias",0.55,0,1));a.addPropertyInfo(this.createDefaultMinMaxFloatPropertyInfo("samePhraseGroupIndexSimilarRandomFraction","Same Phrase Group Index Similar Fraction",0.25,0,1));a.addPropertyInfo(this.createDefaultMinMaxFloatPropertyInfo("samePhraseGroupIndexSimilarBias","Same Phrase Group Index Similar Bias",0.5,0,1));a.addPropertyInfo(this.createDefaultMinMaxFloatPropertyInfo("differentPhraseGroupIndexDifferentRandomFraction","Different Phrase Group Index Different Fraction",0.3,0,1));a.addPropertyInfo(this.createDefaultMinMaxFloatPropertyInfo("differentPhraseGroupIndexDifferentBias","Different Phrase Group Index Different Bias",0.25,0,1));a.addPropertyInfo(this.createDefaultProbabilityPropertyInfo("prefixGlueProbabilityMultiplier","Prefix Group Probability Multiplier",1));a.addPropertyInfo(this.createDefaultProbabilityPropertyInfo("postfixGlueProbabilityMultiplier","Postfix Group Probability Multiplier",1));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("useMaxHarmonyElementLength","Use max harmony element length",true));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("prolongStaticLikelihoods","Prolong Static Likelihoods",[2]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("prolongDynamicLikelihoods","Prolong Dynamic Likelihoods",[4]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("prolongDominantCadenceLikelihoods","Prolong Dominant Cadence Likelihoods",[3]));a.addPropertyInfo(this.createDefaultLikelihoodListPropertyInfo("prolongTonicCadenceLikelihoods","Prolong Tonic Cadence Likelihoods",[1]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("prolongHarmonyPartBiases","Prolong Harmony Part Biases",[20]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("prolongHarmonyPartRandomFractions","Prolong Harmony Part Fractions",[50]));break;case"SongPartTypeOverrideInfo":a.addPropertyInfo(this.createEnumPropertyInfo("partType","Part type",SongPartType.VERSE_1,SongPartType));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overridePhraseGroupType","Override phrase group type",false));a.addPropertyInfo(this.createEnumPropertyInfo("phraseGroupType","Phrase group type",SimpleModuleGeneratorPhraseGroupType.ANTECEDENT_CONSEQUENT_SHORTEN,SimpleModuleGeneratorPhraseGroupType));a.addPropertyInfo(this.createEnumListPropertyInfo("customPhraseTypes","Custom phrase types",PhraseHarmonyElementType.COMPLETE,PhraseHarmonyElementType));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overrideMajorModulationTarget","Override major modulation/tonicization target",false));a.addPropertyInfo(this.createEnumPropertyInfo("majorModulationTarget","Major modulation/tonicization target",DynamicHarmonyModulationTarget.DOMINANT,DynamicHarmonyModulationTarget));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overrideMinorModulationTarget","Override minor modulation/tonicization target",false));a.addPropertyInfo(this.createEnumPropertyInfo("minorModulationTarget","Minor modulation/tonicization target",DynamicHarmonyModulationTarget.DOMINANT,DynamicHarmonyModulationTarget));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("harmonyElementIndices","Custom harmony indices",[]));a.addPropertyInfo(this.createEnumListPropertyInfo("sameGroupIndexSames","Same part sames",PhraseGroupIndexProperty.HARMONY_RYTHM,PhraseGroupIndexProperty));a.addPropertyInfo(this.createEnumListPropertyInfo("sameGroupIndexDifferents","Same part differents",PhraseGroupIndexProperty.HARMONY_RYTHM,PhraseGroupIndexProperty));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("melodyShapeIndexOverride","Melody Shape index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("bassShapeIndexOverride","Bass Shape index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("harmonyRythmIndexOverride","Harmony rythm index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("suspendIndexOverride","Suspend index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("melodyChannelDistributionIndexOverride","Melody instrument index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("inner1ChannelDistributionIndexOverride","Inner 1 instrument index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("inner2ChannelDistributionIndexOverride","Inner 2 instrument index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("bassChannelDistributionIndexOverride","Bass instrument index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("melodyMotifDistributionIndexOverride","Melody motif distribution index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("inner1MotifDistributionIndexOverride","Inner 1 motif distribution index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("inner2MotifDistributionIndexOverride","Inner 2 motif distribution index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("bassMotifDistributionIndexOverride","Bass motif distribution index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("percussionMotifDistributionIndexOverride","Percussion motif distribution index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("percussionFillMotifDistributionIndexOverride","Percussion fill motif distribution index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("harmonyExtraIndexOverride","Harmony characteristics index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("renderAmountIndexOverride","Render amount index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("sequentialMelodyEffectChangeIndexOverride","Melody effect index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("sequentialInner1EffectChangeIndexOverride","Inner 1 effect index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("sequentialInner2EffectChangeIndexOverride","Inner 2 effect index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("sequentialBassEffectChangeIndexOverride","Bass effect index override",[]));a.addPropertyInfo(this.createDefaultIndexListPropertyInfo("sequentialPercussionEffectChangeIndexOverride","Percussion effect index override",[]));break;case"LinearInterpolatedCustomVoiceLineCurveInfo":a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("xValues","X Values",[0,1]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("yValues","Y Values",[60,70]));break;case"SongDetails":a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("setScaleBaseNote","Set scale base note",false));a.addPropertyInfo(this.createDefaultMinMaxIntPropertyInfo("scaleBaseNote","Scale base note",60,0,127));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overwriteSongPartStructure","Overwrite Song Structure",false));a.addPropertyInfo(this.createSongPartStructureInfoListPropertyInfo("songPartStructure","Song Structure",this.spsidsUidInfo));var c=this.createObjectListPropertyInfo("songPartTypeOverrideInfos","Song part type override infos",this.phraseGroupTypesUidInfo,[["SongPartTypeOverrideInfo","Song part type override info"]]);c.listInfo.itemsDisplayFunction=function(e){return SongPartType.toString(e.partType)};a.addPropertyInfo(c);a.addPropertyInfo(this.createDefaultIntListPropertyInfo("harmonyRythmMeasureCountOverrides","Harmony Rythm Measure Count overrides",[],[new ArrayElementConstraint(new RangePropertyConstraint([1,32]))]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("harmonyRythmNoteCountOverrides","Harmony Rythm note count overrides",[],[new ArrayElementConstraint(new RangePropertyConstraint([0.125,32]))]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("harmonyRythmDensityCurveAmplitudeOverrides","Harmony Rythm Density curve amp overrides",[]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("harmonyRythmDensityCurveFrequencyOverrides","Harmony Rythm Density curve freq overrides",[]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("melodyMotifRythmNoteCountOverrides","Melody motif rythm note count overrides",[]));a.addPropertyInfo(this.createDefaultFloatListPropertyInfo("bassMotifRythmNoteCountOverrides","Bass motif rythm note count overrides",[]));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overwriteMelodyInstruments","Override Melody Instruments",false));a.addPropertyInfo(this.createEnumListPropertyInfo("melodyInstruments","Melody Instruments",MidiProgram.ACOUSTIC_GRAND_PIANO,MidiProgram));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overwriteInner1Instruments","Override Inner 1 Instruments",false));a.addPropertyInfo(this.createEnumListPropertyInfo("inner1Instruments","Inner 1 Instruments",MidiProgram.ACOUSTIC_GRAND_PIANO,MidiProgram));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overwriteInner2Instruments","Override Inner 2 Instruments",false));a.addPropertyInfo(this.createEnumListPropertyInfo("inner2Instruments","Inner 2 Instruments",MidiProgram.ACOUSTIC_GRAND_PIANO,MidiProgram));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overwriteBassInstruments","Override Bass Instruments",false));a.addPropertyInfo(this.createEnumListPropertyInfo("bassInstruments","Bass Instruments",MidiProgram.ACOUSTIC_GRAND_PIANO,MidiProgram));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("percussionFillMotifIndicesOverride","Fill motif indices override",[]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("addBassDrumsOverride","Add Bass Drum Overrides",[]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("addSnareDrumsOverride","Add Snare Drum Overrides",[]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("addCrashDrumsOverride","Add Crash Overrides",[]));a.addPropertyInfo(this.createDefaultIntListPropertyInfo("addRideDrumsOverride","Add Ride Overrides",[]));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overrideBassDrumNote","Override bass drum note",false));a.addPropertyInfo(this.createEnumPropertyInfo("bassDrumNote","Bass Drum",MidiDrum.BASS_DRUM_1,MidiDrum));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overrideSnareDrumNote","Override snare drum note",false));a.addPropertyInfo(this.createEnumPropertyInfo("snareDrumNote","Snare Drum",MidiDrum.SNARE_DRUM_1,MidiDrum));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overrideCrashDrumNote","Override crash drum note",false));a.addPropertyInfo(this.createEnumPropertyInfo("crashDrumNote","Crash Drum",MidiDrum.CRASH_CYMBAL_1,MidiDrum));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overrideRideDrumNotes","Override ride notes",false));a.addPropertyInfo(this.createEnumListPropertyInfo("rideDrumNotes","Ride Drums",MidiDrum.RIDE_BELL,MidiDrum));var c=this.createObjectListPropertyInfo("harmonyElements","Harmony elements",this.phraseGroupTypesUidInfo,[["SimpleSequenceHarmonyElement","Simple Harmony Sequence"],["PhraseHarmonyElement","Phrase Harmony"]]);c.listInfo.itemsDisplayFunction=function(f){var e="Harmony Element ("+f._constructorName+")";return e};a.addPropertyInfo(c);var c=this.createObjectListPropertyInfo("customMelodyCurveInfos","Melody curve infos",this.phraseGroupTypesUidInfo,[["LinearInterpolatedCustomVoiceLineCurveInfo","Linear Interpolation"]]);c.listInfo.itemsDisplayFunction=function(f){var e="Voice line curve ("+f._constructorName+")";return e};a.addPropertyInfo(c);var c=this.createObjectListPropertyInfo("customBassCurveInfos","Bass curve infos",this.phraseGroupTypesUidInfo,[["LinearInterpolatedCustomVoiceLineCurveInfo","Linear Interpolation"]]);c.listInfo.itemsDisplayFunction=function(f){var e="Voice line curve ("+f._constructorName+")";return e};a.addPropertyInfo(c);break;case"SongDomains":a.addPropertyInfo(this.createDefaultFloatRangePropertyInfo("tempoRange","Tempo Range",[],[new ArrayElementConstraint(new RangePropertyConstraint([10,500]))]));a.addPropertyInfo(this.createDefaultRangeListPropertyInfo("melodyShapeAmpRanges","Melody Shape Amplitude Ranges",[[6,12]],GuiPropertyDataType.FLOAT_LIST_2D,[new ArrayElementConstraint(new ArrayElementConstraint(new RangePropertyConstraint([-12,12])))]));a.addPropertyInfo(this.createDefaultRangeListPropertyInfo("melodyShapeBiasRanges","Melody Shape Bias Ranges",[[68,76]],GuiPropertyDataType.FLOAT_LIST_2D,[new ArrayElementConstraint(new ArrayElementConstraint(new RangePropertyConstraint([50,90])))]));a.addPropertyInfo(this.createDefaultRangeListPropertyInfo("bassShapeAmpRanges","Bass Shape Amplitude Ranges",[[2,4]],GuiPropertyDataType.FLOAT_LIST_2D,[new ArrayElementConstraint(new ArrayElementConstraint(new RangePropertyConstraint([-12,12])))]));a.addPropertyInfo(this.createDefaultRangeListPropertyInfo("bassShapeBiasRanges","Bass Shape Bias Ranges",[[35,45]],GuiPropertyDataType.FLOAT_LIST_2D,[new ArrayElementConstraint(new ArrayElementConstraint(new RangePropertyConstraint([25,55])))]));a.addPropertyInfo(this.createDefaultBooleanPropertyInfo("overwriteSongPartStructureRndInfos","Overwrite Song Structure Domain",false));a.addPropertyInfo(this.createSongPartStructureInfoDataSampleListPropertyInfo("songPartStructureRndInfos","Song Structure Domain",this.spsidsUidInfo));a.addPropertyInfo(this.createPhraseGroupTypeDataSampleListPropertyInfo("phraseGroupTypes","Phrase group types",this.phraseGroupTypesUidInfo));a.addPropertyInfo(this.createPhraseGroupTypeDataSampleListPropertyInfo("modulatePhraseGroupTypes","Modulate phrase group types",this.phraseGroupTypesUidInfo));a.addPropertyInfo(this.createIntDataSampleListPropertyInfo("majorDeceptiveRootRndInfos","Major deceptive root likelihoods",this.phraseGroupTypesUidInfo));a.addPropertyInfo(this.createIntDataSampleListPropertyInfo("minorDeceptiveRootRndInfos","Minor deceptive root likelihoods",this.phraseGroupTypesUidInfo));a.addPropertyInfo(this.createPhraseGroupTypeDataSampleListPropertyInfo("introGroupTypes","Intro group types",this.phraseGroupTypesUidInfo));a.addPropertyInfo(this.createPhraseGroupTypeDataSampleListPropertyInfo("endGroupTypes","End group types",this.phraseGroupTypesUidInfo));a.addPropertyInfo(this.createPhraseGroupTypeDataSampleListPropertyInfo("glueGroupTypes","Postfix/prefix group types",this.phraseGroupTypesUidInfo));var c=this.createObjectListPropertyInfo("majorModulationTargetInfos","Major modulation/tonicization targets",this.phraseGroupTypesUidInfo,[["ModulationTargetDataSample","Major modulation/tonicization target likelihood"]]);c.listInfo.itemsDisplayFunction=function(e){return DynamicHarmonyModulationTarget.toString(e.data)+", Likelihood: "+e.likelihood};a.addPropertyInfo(c);var c=this.createObjectListPropertyInfo("minorModulationTargetInfos","Minor modulation/tonicization targets",this.phraseGroupTypesUidInfo,[["ModulationTargetDataSample","Minor modulation/tonicization target likelihood"]]);c.listInfo.itemsDisplayFunction=function(e){return DynamicHarmonyModulationTarget.toString(e.data)+", Likelihood: "+e.likelihood};a.addPropertyInfo(c);a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("electronicMelodyInstrInfos","Electronic Melody Instrument Distribution",this.eomUidInfo));a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("electronicInnerFastInstrInfos","Electronic Inner 1 Instrument Distribution",this.eoi1UidInfo));a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("electronicInnerSlowInstrInfos","Electronic Inner 2 Instrument Distribution",this.eoi2UidInfo));a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("electronicBassInstrInfos","Electronic Bass Instrument Distribution",this.eobUidInfo));a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("electricMelodyInstrInfos","Electric Melody Instrument Distribution",this.emUidInfo));a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("electricInnerFastInstrInfos","Electric Inner 1 Instrument Distribution",this.ei1UidInfo));a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("electricInnerSlowInstrInfos","Electric Inner 2 Instrument Distribution",this.ei2UidInfo));a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("electricBassInstrInfos","Electric Bass Instrument Distribution",this.ebUidInfo));a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("acousticMelodyInstrInfos","Acoustic Melody Instrument Distribution",this.amUidInfo));a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("acousticInnerFastInstrInfos","Acoustic Inner 1 Instrument Distribution",this.ai1UidInfo));a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("acousticInnerSlowInstrInfos","Acoustic Inner 2 Instrument Distribution",this.ai2UidInfo));a.addPropertyInfo(this.createMidiProgramDataSampleListPropertyInfo("acousticBassInstrInfos","Acoustic Bass Instrument Distribution",this.abUidInfo));a.addPropertyInfo(this.createMidiDrumDataSampleListPropertyInfo("bassDrumRndInfos","Bass Drum Distribution",this.bdUidInfo));a.addPropertyInfo(this.createMidiDrumDataSampleListPropertyInfo("snareRndInfos","Snare Drum Distribution",this.sdUidInfo));a.addPropertyInfo(this.createMidiDrumDataSampleListPropertyInfo("crashRndInfos","Crash Drum Distribution",this.cdUidInfo));a.addPropertyInfo(this.createMidiDrumDataSampleListPropertyInfo("rideRndInfos","Ride Drum Distribution",this.rdUidInfo));break}return a};var SongSettingsComponent=(function(){function changeComponentValue(newValue,createdComps,index,tabsId,changeListener){var oldComp=createdComps[index];var oldValue=oldComp.object;$("#"+oldComp.id).remove();copyObjectPropertiesDeep(oldValue,newValue);var comp=new GuiPropertiesComponent({object:oldValue,propertyInfoProvider:propertyInfoProvider});createdComps[index]=comp;var contentArr=[];comp.createJQueryStrings(contentArr);var $theTab=$("#"+tabsId+index);$theTab.append($(contentArr.join("")));var $tabs=$("#"+tabsId);comp.jQueryCreated($tabs);addChangeListener(index,createdComps,changeListener);oldValue.dirty=true;settingsDirty=true;if(changeListener){changeListener(comp,oldValue,oldValue)}comp.$component.detach();$("#topdiv").append(comp.$component);comp.alignComponents();comp.$component.detach();$theTab.append(comp.$component);addSideButtons(comp,index)}function addChangeListener(index,createdComps,changeListener){var comp=createdComps[index];var oldValue=comp.object;comp.changeListeners.push(function(){oldValue.dirty=true});if(changeListener){comp.changeListeners.push(changeListener)}}function compIsSeed(c){var propInfo=c.propertyInfo;return stringEndsWith(propInfo.propertyName.toLowerCase(),"seed")}function compIsControlEtc(c){var propInfo=c.propertyInfo;var test=propInfo.propertyName.toLowerCase();var result=stringEndsWith(test,"volumemultipliers")||stringEndsWith(test,"volumemultiplier")||stringEndsWith(test,"reverbsends")||stringEndsWith(test,"reverbsend")||stringEndsWith(test,"chorussends")||stringEndsWith(test,"chorussend");return result}function compIsLikelihoodOrProbEtc(c){var propInfo=c.propertyInfo;var test=propInfo.propertyName.toLowerCase();var result=stringEndsWith(test,"renderamountoverride")||stringEndsWith(test,"probsoverride")||stringEndsWith(test,"likelihood")||stringEndsWith(test,"likelihoods")||stringEndsWith(test,"likelihoodmultiplier")||stringEndsWith(test,"likelihoodmultipliers")||stringEndsWith(test,"probmultipliers")||stringEndsWith(test,"fraction")||stringEndsWith(test,"probability")||stringEndsWith(test,"probabilities");return result}function zeroInput(comp){comp.$input.val("0");comp.setValueVerifyRaw()}function oneInput(comp){comp.$input.val("1");comp.setValueVerifyRaw()}function clearSeed(comp){comp.$input.val("");comp.setValueVerifyRaw()}function randomizeSeed(comp){var seed=globalRnd.genrand_int32();comp.$input.val(""+seed);comp.setValueVerifyRaw()}function explicitizeSeed(comp){var mainSeed=getMainSeed();var rnd=new MersenneTwister(mainSeed);var createModuleSeed=rnd.genrand_int31();var genInfoRnd=new MersenneTwister(createModuleSeed);globalGenInfo.randomize(genInfoRnd);var propInfo=comp.propertyInfo;var explicitSeed=globalGenInfo[propInfo.propertyName];if(explicitSeed){comp.$input.val(""+explicitSeed);comp.setValueVerifyRaw()}}function getAllChildrenWithTest(index,createdComps,test){var result=[];var comp=createdComps[index];for(var j=0;j<comp.children.length;j++){var child=comp.children[j];if(test(child)){result.push(child)}}return result}function getAllSeedChildren(index,createdComps){return getAllChildrenWithTest(index,createdComps,compIsSeed)}function getAllLikelihoodChildren(index,createdComps){return getAllChildrenWithTest(index,createdComps,compIsLikelihoodOrProbEtc)}function addSideButtons(comp,index){function addSeedButtonsEventHandlers(child,$clearButton,$randomizeButton,$explicitButton){var propInfo=child.propertyInfo;$clearButton.click(function(){clearSeed(child)});$randomizeButton.click(function(){randomizeSeed(child)});if($explicitButton){$explicitButton.click(function(){explicitizeSeed(child)})}}function addLikelihoodButtonsEventHandlers(child,$zeroButton,$oneButton){$zeroButton.click(function(){zeroInput(child)});$oneButton.click(function(){oneInput(child)})}function addButtonValueEventHandler(child,$button,value){$button.click(function(){child.$input.val(""+value);child.setValueVerifyRaw()})}for(var i=0;i<comp.children.length;i++){var child=comp.children[i];if(compIsLikelihoodOrProbEtc(child)){var propInfo=child.propertyInfo;var $zeroButton=$('<button style="height: 3em; font-size: 60%" title="Set to zero" class="zero-likelihood-button">0</button>');var $oneButton=$('<button style="height: 3em; font-size: 60%" title="Set to one" class="one-likelihood-button">1</button>');child.$component.append($zeroButton);child.$component.append($oneButton);$zeroButton.button();$oneButton.button();addLikelihoodButtonsEventHandlers(child,$zeroButton,$oneButton)}if(compIsControlEtc(child)){var propInfo=child.propertyInfo;var divisions=100;var strValue=child.$input.val();var value=parseFloat(strValue);if(isNaN(value)){}else{var $ctrlSlider=$('<div style="width: 10em; margin-right: 1em; height: 1em; display: inline-block; font-size: 60%"  class="ctrl-slider"></div>');child.$component.append($ctrlSlider);function refreshCtrl(toRefresh,$slider){return function(){var value=clamp((1/divisions)*$slider.slider("value"),0,1);toRefresh.$input.val(""+value);toRefresh.setValueVerifyRaw()}}$ctrlSlider.slider({min:0,max:divisions,value:clamp(Math.round(value*divisions),0,divisions),slide:refreshCtrl(child,$ctrlSlider),change:refreshCtrl(child,$ctrlSlider)});var values=[0,1];for(var j=0;j<values.length;j++){var value=values[j];var $valueButton=$('<button style="height: 3em; font-size: 60%" title="Set to zero" class="zero-ctrl-button">'+value+"</button>");child.$component.append($valueButton);$valueButton.button();$valueButton.click((function(){var $slider=$ctrlSlider;var v=value;return function(){$slider.slider("option","value",clamp(v*divisions,0,divisions))}})())}}}if(compIsSeed(child)){var propInfo=child.propertyInfo;var $clearButton=$('<button style="height: 3em; font-size: 60%" title="Clear seed" class="clear-seed-button">C</button>');var $randomizeButton=$('<button style="height: 3em; font-size: 60%" title="Randomize seed" class="randomizer-seed-button">R</button>');child.$component.append($clearButton);child.$component.append($randomizeButton);$clearButton.button();$randomizeButton.button();var $explicitButton=null;if(globalGenInfo[propInfo.propertyName]){var $explicitButton=$('<button style="height: 3em; font-size: 60%" title="Explicit seed" class="explicit-seed-button">E</button>');child.$component.append($explicitButton);$explicitButton.button()}addSeedButtonsEventHandlers(child,$clearButton,$randomizeButton,$explicitButton)}}}function createTabs($parent,tabsId,tabsClass,tabCaptions,tabObjects,changeListener,presets,addSeeds){if(!addSeeds){addSeeds=[]}var tabsArr=['<div id="'+tabsId+'">'];var createdComps=[];var contentArrs=[];tabsArr.push('<ul class="'+tabsClass+'-ul">');for(var i=0;i<tabCaptions.length;i++){tabsArr.push('<li><a href="#'+(tabsId+i)+'" >'+tabCaptions[i]+"</a></li>")}tabsArr.push("</ul>");var hasSeeds=[];var hasLikelihoods=[];if(presets){for(var i=0;i<presets.length;i++){var preset=presets[i];for(var j=0;j<preset.items.length;j++){var item=preset.items[j];uidManager.addUniqueId(uidManager,tabsId+i,item.name)}}}function addHeaderHtml(arr,index){var defaultButtonId=(tabsId+"_default_button_"+index);var saveButtonId=(tabsId+"_save_button_"+index);var loadButtonId=(tabsId+"_load_button_"+index);var manageButtonId=(tabsId+"_manage_button_"+index);var clearSeedsButtonId=(tabsId+"_clear_seeds_button_"+index);var randomizeSeedsButtonId=(tabsId+"_randomize_seeds_button_"+index);var explicitSeedsButtonId=(tabsId+"_explicit_seeds_button_"+index);var buttonStyle='style="height: 3em; font-size: 50%"';var headerArr=['<div id="'+(tabsId+"_header_"+i)+'" class="'+tabsClass+'"  >',(presets?'<button  style="'+buttonStyle+'" id="'+defaultButtonId+'" title="All settings to default values"  >Set Default</button>':""),(hasSeeds[index]&&addSeeds[index]?'<button  style="'+buttonStyle+'" id="'+clearSeedsButtonId+'" title="Clear all seed values" >Clear Seeds</button>':""),(hasSeeds[index]&&addSeeds[index]?'<button  style="'+buttonStyle+'" id="'+randomizeSeedsButtonId+'" title="Randomize all seed values" >Randomize Seeds</button>':""),(hasSeeds[index]&&addSeeds[index]?'<button  style="'+buttonStyle+'" id="'+explicitSeedsButtonId+'" title="Set all seeds to their explicit values"  >Explicit Seeds</button>':""),(presets?'<button  style="'+buttonStyle+'" id="'+saveButtonId+'" title="Save current settings as a preset" >Save</button>':""),(presets?'<button  style="'+buttonStyle+'" id="'+loadButtonId+'" title="Load settings preset" >Load</button>':""),(presets?'<button  style="'+buttonStyle+'" id="'+manageButtonId+'" title="Edit settings presets" >Edit Presets</button>':""),"</div>"];arr.push(headerArr.join(""))}function createHeaderComponents(index){var defaultButtonId=(tabsId+"_default_button_"+index);var saveButtonId=(tabsId+"_save_button_"+index);var loadButtonId=(tabsId+"_load_button_"+index);var manageButtonId=(tabsId+"_manage_button_"+index);var clearSeedsButtonId=(tabsId+"_clear_seeds_button_"+index);var randomizeSeedsButtonId=(tabsId+"_randomize_seeds_button_"+index);var explicitSeedsButtonId=(tabsId+"_explicit_seeds_button_"+index);if(hasSeeds[index]&&addSeeds[index]){$("#"+clearSeedsButtonId).button().click(function(){var seedChildren=getAllSeedChildren(index,createdComps);for(var i=0;i<seedChildren.length;i++){clearSeed(seedChildren[i])}});$("#"+randomizeSeedsButtonId).button().click(function(){var seedChildren=getAllSeedChildren(index,createdComps);for(var i=0;i<seedChildren.length;i++){randomizeSeed(seedChildren[i])}});$("#"+explicitSeedsButtonId).button().click(function(){var seedChildren=getAllSeedChildren(index,createdComps);for(var i=0;i<seedChildren.length;i++){explicitizeSeed(seedChildren[i])}})}if(presets){$("#"+saveButtonId).button().click(function(){var content="";var idSuggest=uidManager.getNextUniqueId(tabsId+index,tabCaptions[index]+" Sub-Settings ");content+="<div>";content+='<span class="preset-name-label" >Name:</span>';content+='<input class="preset-name-input ui-corner-all" value="'+idSuggest+'" />';content+="</div>";var options={modal:true,width:450,buttons:{Save:function(){if(presets){var newId=$(this).find(".preset-name-input")[0].value;var preset=presets[index];var item=preset.getItemWithName(newId);if(!item){item=new PresetItem();preset.items.push(item);uidManager.addUniqueId(uidManager,tabsId+index,newId)}item.name=newId;item.data=copyValueDeep(tabObjects[index]);preset.saveToLocalStorage()}$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}};showModalDialog("Save "+tabCaptions[index]+" Sub-Settings",content,options)});$("#"+loadButtonId).button().click(function(){var content="";content+="<div>";content+='<select class="preset-name-select ui-corner-all" >';if(presets){var preset=presets[index];for(var i=0;i<preset.items.length;i++){var item=preset.items[i];content+='<option value="'+item.name+'" >'+item.name+"</option>"}}content+="</select>";content+="</div>";var options={modal:true,width:450,buttons:{Load:function(){if(presets){var presetName=$(this).find(".preset-name-select")[0].value;var preset=presets[index];var item=null;for(var i=0;i<preset.items.length;i++){if(preset.items[i].name==presetName){item=preset.items[i];break}}if(item&&item.data){changeComponentValue(item.data,createdComps,index,tabsId,changeListener)}}$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}};showModalDialog("Load "+tabCaptions[index]+" Sub-Settings",content,options)});$("#"+manageButtonId).button().click(function(){var content="";content+="<div>";content+='<ol class="preset-list" >';if(presets){var preset=presets[index];for(var i=0;i<preset.items.length;i++){var item=preset.items[i];content+='<li class="ui-widget-content" >'+item.name+"</li>"}}content+="</ol>";content+="</div>";content+="<div>";content+='<button class="preset-rename-button">Rename</button>';content+='<button class="preset-duplicate-button">Duplicate</button>';content+='<button class="preset-delete-button">Delete</button>';content+="</div>";var options={modal:true,width:450,buttons:{Close:function(){$(this).dialog("close")}}};var selectedList=[];var selectedSet={};var $dialog=showModalDialog("Edit "+tabCaptions[index]+" Sub-Settings",content,options);var $list=$dialog.find(".preset-list").selectable({selected:function(event,ui){var selected=ui.selected;if(!arrayContains(selectedList,selected.innerHTML)){selectedList.push(selected.innerHTML)}selectedSet[selected.innerHTML]=selected},unselected:function(event,ui){var unselected=ui.unselected;arrayDelete(selectedList,unselected.innerHTML);selectedSet[unselected.innerHTML]=null}});var $renameButton=$dialog.find(".preset-rename-button").button();var $duplicateButton=$dialog.find(".preset-duplicate-button").button();var $deleteButton=$dialog.find(".preset-delete-button").button();$renameButton.click(function(){if(selectedList.length==1){logit("Renaming "+selectedList[0])}});$deleteButton.click(function(){if(presets){var preset=presets[index];for(var i=0;i<selectedList.length;i++){var item=preset.getItemWithName(selectedList[i]);arrayDelete(preset.items,item);var $sel=$(selectedSet[selectedList[i]]);$sel.remove()}preset.saveToLocalStorage();selectedList=[];selectedSet={}}})});$("#"+defaultButtonId).button().click(function(){var newValue=eval("new "+tabObjects[index]._constructorName+"()");changeComponentValue(newValue,createdComps,index,tabsId,changeListener)})}}for(var i=0;i<tabCaptions.length;i++){var obj=tabObjects[i];var headerArr=[];var contentArr=[];if(obj){var comp=new GuiPropertiesComponent({object:obj,propertyInfoProvider:propertyInfoProvider});createdComps[i]=comp;var seedChildren=getAllSeedChildren(i,createdComps);hasSeeds[i]=seedChildren.length>0;var likelihoodChildren=getAllLikelihoodChildren(i,createdComps);hasLikelihoods[i]=likelihoodChildren.length>0;comp.createJQueryStrings(contentArr);contentArrs.push(contentArr);addHeaderHtml(headerArr,i)}tabsArr.push('<div id="'+(tabsId+i)+'" class="'+tabsClass+'"  >'+headerArr.join("")+contentArr.join("")+"</div>")}tabsArr.push("</div>");var $tabs=$(tabsArr.join(""));$parent.append($tabs);for(var i=0;i<tabCaptions.length;i++){var $tab=$("#"+tabsId+i)}for(var i=0;i<createdComps.length;i++){var comp=createdComps[i];comp.jQueryCreated($tabs);addChangeListener(i,createdComps,changeListener);createHeaderComponents(i)}for(var i=0;i<createdComps.length;i++){var comp=createdComps[i];comp.alignComponents();addSideButtons(comp)}$tabs.tabs();return{createdComps:createdComps,changeListener:changeListener}}return{createTabs:createTabs,changeComponentValue:changeComponentValue}})();var AsyncServerChildTaskType={RENDER:0,EXPORT_MIDI:1,EXPORT_WAV:2,EXPORT_MP3:3,EXPORT_OGG:4,SAVE_PRESET:5,SAVE_SONG:6,DELETE_SONG:7,RENAME_SONG:8,DUPLICATE_SONGS:9,OVERWRITE_SONG:10};var WorkerTaskType={RENDER:0,EXPORT_MIDI:1,EXPORT_WAV:2};function AsyncOperation(a){this.requireLogin=getValueOrDefault(a,"requireLogin",true);this.onDone=getValueOrDefault(a,"onDone",function(b){});this.onFail=getValueOrDefault(a,"onFail",function(b){});this.onCancel=getValueOrDefault(a,"onCancel",function(b){});this.onSuccess=getValueOrDefault(a,"onSuccess",function(b){});this.id=getValueOrDefault(a,"id","theId");this.caption=getValueOrDefault(a,"caption","Progress "+this.id+"("+this.type+")");this.doneCaption=getValueOrDefault(a,"doneCaption","Done!");this.maxCount=getValueOrDefault(a,"maxCount",1);this.progressDivId=getValueOrDefault(a,"progressDivId","progressdiv");this.resultDivId=getValueOrDefault(a,"resultDivId","progressdiv");this.createProgress=getValueOrDefault(a,"createProgress",true);this.done=false;this.cancelled=false;this.failReason="";this.removeDelay=2000;this.$progressBar=null;this.$progressComp=null;this.$captionComp=null;this.$cancelButton=null}AsyncOperation.prototype.update=function(){};AsyncOperation.prototype.start=function(){};AsyncOperation.prototype.cancel=function(){var a=this;setTimeout(function(){a.removeProgress()},this.removeDelay);if(this.$progressComp){}if(a.onCancel){a.onCancel(a)}a.cancelled=true};AsyncOperation.prototype.removeProgress=function(a){if(this.$progressComp){var b=this;this.$progressComp.hide("fast",function(){b.$progressComp.remove()})}};AsyncOperation.prototype.addResultUrl=function(b){if(this.resultDivId){var a=$("#"+this.resultDivId);a.prepend($('<div style="display: none" class="ui-widget-content ui-corner-all progress-component" ><a href="'+b+'">Result</a></div>'));a.show("fast")}};AsyncOperation.prototype.updateProgress=function(a){if(this.createProgress){var b=this.$progressBar.attr("id");this.$progressBar.progressbar("option","value",a)}};AsyncOperation.prototype.success=function(){var a=this;setTimeout(function(){a.removeProgress()},a.removeDelay);if(a.createProgress){a.updateProgress(100);a.$captionComp.html(a.doneCaption);a.$cancelButton.button("disable")}if(a.onSuccess){a.onSuccess(a)}if(a.onDone){a.onDone(a)}a.done=true};AsyncOperation.prototype.fail=function(){var b=this;setTimeout(function(){b.removeProgress()},this.removeDelay);if(this.$progressComp){var a=this.id+"_caption";var c=this.failReason?this.failReason:"Failed...";this.$progressComp.find("#"+a)[0].innerHTML=c}if(b.onFail){b.onFail(b)}if(b.onDone){b.onDone(b)}b.done=true};AsyncOperation.prototype.addProgress=function(){if(this.createProgress){var e=$("#"+this.progressDivId);var f=this.id+"_progressbar";var a=this.id+"_caption";var d=this.id+"_cancelbutton";var b=['<div style="display: none" class="ui-widget-content ui-corner-all progress-component" >','<div class="ui-widget" id="'+a+'" >'+this.caption+"</div>",'<div id="'+f+'" class="progress-bar" ></div>','<button id="'+d+'">Cancel</button>',"</div>"];this.$progressComp=$(b.join(""));e.prepend(this.$progressComp);this.$progressComp.show("fast");this.$progressBar=this.$progressComp.find("#"+f);this.$progressBar.progressbar();this.$captionComp=this.$progressComp.find("#"+a);this.$cancelButton=this.$progressComp.find("#"+d);this.$cancelButton.button();var c=this;this.$cancelButton.click(function(){c.cancel()})}};function LoadSamplesAsyncOperation(a){if(a){a.caption="Loading samples..."}AsyncOperation.call(this,a);this.requireLogin=false;this.audioType=getValueOrDefault(a,"audioType","audio/mpeg");this.bufferUrls=getValueOrDefault(a,"bufferUrls",[]);this.resultBuffers=[];this.loadedCount=0}LoadSamplesAsyncOperation.prototype=new AsyncOperation();function LoadSM2SoundsAsyncOperation(a){LoadSamplesAsyncOperation.call(this,a)}LoadSM2SoundsAsyncOperation.prototype=new LoadSamplesAsyncOperation();LoadSM2SoundsAsyncOperation.prototype.sm2Loaded=false;LoadSM2SoundsAsyncOperation.prototype._bufferMap={};LoadSM2SoundsAsyncOperation.prototype.start=function(){var e=this;if(!LoadSM2SoundsAsyncOperation.prototype.sm2Loaded){$.ajax("js/soundmanager2-nodebug-jsmin.js",{complete:function(f,g){if(g=="success"){$.globalEval(f.responseText);soundManager.setup({url:"swf/",onready:function(){logit("Soundmanager is ready!!!");LoadSM2SoundsAsyncOperation.prototype.sm2Loaded=true;e.start()}})}else{console.log("Could not load: "+g);e.failReason="Unable to initialize player";e.fail()}},type:"GET"});return}this.addProgress();function a(f,i,h){LoadSM2SoundsAsyncOperation.prototype._bufferMap[i]=f;e.resultBuffers[h]=f;e.loadedCount++;var j=e.loadedCount/e.bufferUrls.length;var g=Math.round(100*j);e.updateProgress(g);if(!e.cancelled){if(e.loadedCount==e.bufferUrls.length){e.success()}}}function d(h){var g=e.bufferUrls[h];var f=LoadSM2SoundsAsyncOperation.prototype._bufferMap[g];if(f){a(f,g,h)}else{var i=soundManager.createSound({id:g,url:g});i.load();a(i,g,h)}}try{if(e.bufferUrls.length>0){for(var c=0;c<this.bufferUrls.length;c++){d(c)}}}catch(b){e.failReason="Error when loading samples";e.fail();throw b}};function LoadAudioBuffersAsyncOperation(a){LoadSamplesAsyncOperation.call(this,a);this.audioContext=getValueOrDefault(a,"audioContext",null)}LoadAudioBuffersAsyncOperation.prototype=new LoadSamplesAsyncOperation();LoadAudioBuffersAsyncOperation.prototype._bufferMap={};LoadAudioBuffersAsyncOperation.prototype.createBuffer=function(d,f){var a=this.context.createBuffer(1,this.context.sampleRate,this.context.sampleRate);var e=a.getChannelData(0);for(var c=0;c<e.length;c++){var b=c/(e.length-1);e[c]=0.5*d(b*f)}return a};LoadAudioBuffersAsyncOperation.prototype.start=function(){var e=this;this.addProgress();var b=1;function a(g,j,i){LoadAudioBuffersAsyncOperation.prototype._bufferMap[j]=g;e.resultBuffers[i]=g;e.loadedCount++;var k=e.loadedCount/e.bufferUrls.length;var h=Math.round(100*k);e.updateProgress(h);if(!e.cancelled){if(e.loadedCount==e.bufferUrls.length){e.success()}else{var f=i+b;if(f<e.bufferUrls.length){d(f)}}}}function d(h){var g=e.bufferUrls[h];var f=LoadAudioBuffersAsyncOperation.prototype._bufferMap[g];if(f){a(f,g,h)}else{var i=new XMLHttpRequest();i.open("GET",g,true);i.responseType="arraybuffer";i.onfail=function(){e.fail()};i.onload=function(){e.audioContext.decodeAudioData(i.response,function(j){a(j,g,h)},function(){e.fail()})};i.send()}}if(e.bufferUrls.length>0){for(var c=0;c<b;c++){d(c)}}};function AsyncServerChildTask(a){AsyncOperation.call(this,a);this.taskType=getValueOrDefault(a,"taskType",AsyncServerChildTaskType.RENDER);this.user=getValueOrDefault(a,"user","guest");this.content=getValueOrDefault(a,"content",{});switch(this.taskType){case AsyncServerChildTaskType.EXPORT_MIDI:case AsyncServerChildTaskType.EXPORT_MP3:case AsyncServerChildTaskType.EXPORT_OGG:case AsyncServerChildTaskType.RENDER:this.requireLogin=false;break}this.resultUrl=null;this.resultRenderData=null;this.resultRenderDataLength=1;this.resultSongStructureInfo=null;this.resultSectionTimes=null;this.resultChannelMaps=null;this.taskName=null}AsyncServerChildTask.prototype=new AsyncOperation();AsyncServerChildTask.prototype.cancel=function(){AsyncOperation.prototype.cancel.call(this);var b={type:"cancelTask",taskName:this.taskName};var a=this;$.ajax("task",{data:JSON.stringify(b),contentType:"application/json",complete:function(d,e){if(e=="success"){var c=$.parseJSON(d.responseText)}else{console.log("Task cancel ajax complete. Text status not success: "+e)}},type:"POST"})};AsyncServerChildTask.prototype.update=function(){if(this.cancelled||this.done){return}var b={type:"getTaskProgress",taskType:this.taskType,taskName:this.taskName};if(this.taskName&&!this.done){var a=this;$.ajax("task",{data:JSON.stringify(b),contentType:"application/json",complete:function(f,d){if(a.done){return}if(d=="success"){var g=$.parseJSON(f.responseText);if(g.type=="progress"){var k=Math.round(100*g.progress);a.updateProgress(k);if(g.progress==1&&(g.result||g.resultUrl)){if(g.resultUrl){if(a.resultDivId){var i=$("#"+a.resultDivId);var h=true;var m="audio/mp3";switch(a.taskType){case AsyncServerChildTaskType.EXPORT_MP3:h=true;m="audio/mp3";break;case AsyncServerChildTaskType.EXPORT_OGG:h=true;m="audio/ogg";break;case AsyncServerChildTaskType.EXPORT_WAV:case AsyncServerChildTaskType.EXPORT_MIDI:case AsyncServerChildTaskType.RENDER:h=false;break}var l="";if(h){l='<audio style="width: 20em; height: 3em; " class="audio-player" controls="controls" preload="none" ><source src="'+g.resultUrl+'" type="'+m+'" /></audio>'}var j=g.resultUrl.replace(/\/|\./g,"_")+"_button";var c=g.resultUrl.replace(/\/|\./g,"_")+"_div";var e=$('<div style="display: none" class="ui-widget-content ui-corner-all progress-component" id="'+c+'" >'+l+'<a class="result-url" href="'+g.resultUrl+'" target="_blank" >Result Link</a><button id="'+j+'">Remove</button></div>');i.prepend(e);$("#"+j).button().click(function(){$("#"+c).detach()});e.show("slow");if(h){a.$audioElement=e.find("audio")}}}if(g.result){a.resultRenderData=g.result.renderData;a.resultRenderDataLength=g.result.renderDataLength;a.resultSongStructureInfo=g.result.songStructureInfo;a.resultChannelMaps=g.result.channelMaps;a.resultSectionTimes=g.result.sectionTimes}a.success()}}else{if(g.type=="error"){if(!a.done){a.failReason="Unable to get progress";logit(g);a.fail()}}else{logit("Ignoring result from getTaskProgress");logit(g)}}}else{console.log("Task progress ajax complete. Text status not success: "+d);a.fail()}},type:"POST"})}};AsyncServerChildTask.prototype.start=function(){var b={type:"startTask",taskType:this.taskType,user:this.user,content:this.content};var a=this;$.ajax("task",{data:JSON.stringify(b),contentType:"application/json",complete:function(d,e){if(e=="success"){var c=$.parseJSON(d.responseText);if(c.type=="error"){a.failReason=c.message;a.fail()}a.taskName=c.taskName}else{a.fail();console.log("Task start ajax complete. Text status not success: "+e)}},type:"POST"});this.addProgress()};function AsyncWorkerTask(c){AsyncOperation.call(this,c);this.requireLogin=false;this.taskType=getValueOrDefault(c,"taskType",WorkerTaskType.RENDER);this.content=getValueOrDefault(c,"content",{});this.transferableSupported=false;this.resultRenderData=null;this.resultRenderDataLength=1;this.resultSongStructureInfo=null;this.resultChannelMaps=null;this.resultSectionTimes=null;this.progress=0;var b="js/worker.js";this.worker=new Worker(b);this.worker.postMessage({});var f=this;var g=new ArrayBuffer(1);try{this.worker.postMessage(g,[g]);if(g.byteLength){}else{}}catch(a){logit("Exception thrown when trying to post message to worker.")}function h(j,i){var k=""+j;while(k.length<i){k="0"+k}return k}function e(){var i=new Date();var j="song";return j+"_"+h(i.getUTCFullYear(),4)+""+h(i.getUTCMonth()+1,2)+""+h(i.getUTCDate(),2)+"_"+h(i.getUTCHours(),2)+""+h(i.getUTCMinutes(),2)+""+h(i.getUTCSeconds(),2)+"_"+h(i.getUTCMilliseconds(),3)}var d=function(x){var o=x.data;var m=o.type;if(m){switch(m){case"log":console.log(o.data);break;case"error":f.failReason=o.data;f.fail();f.worker.terminate();break;case"result":var s=JSON.parse(o.data);f.resultRenderData=s.renderData;f.resultRenderDataLength=s.renderDataLength;f.resultChannelMaps=s.channelMaps;f.resultSongStructureInfo=s.songStructureInfo;f.resultSectionTimes=s.sectionTimes;if(f.taskType==WorkerTaskType.EXPORT_MIDI||f.taskType==WorkerTaskType.EXPORT_WAV){var t=null;var q=".mid";var z=false;var y="audio/wav";switch(f.taskType){case WorkerTaskType.EXPORT_MIDI:var u=new FakeByteArray();Midi.encodeMidi(s.midiData,u);t=u.toBuffer();break;case WorkerTaskType.EXPORT_WAV:if(!f.resultBuffer){logit("Expected a result buffer from the worker before the result message")}t=f.resultBuffer;q=".wav";z=true;y="audio/wav";break}if(t){var i=new Blob([new Uint8Array(t)]);var k=window.URL.createObjectURL(i);var A="";if(z){if(z){A='<audio style="width: 20em; height: 3em; " class="audio-player" controls="controls" preload="none" ><source src="'+k+'" type="'+y+'" /></audio>'}}var p=f.id+"_result_remove_button";var r=f.id+"_result_load_button";var v=f.id+"_result_div";var n=$("#"+f.resultDivId);var j=e()+q;var l="";var B=document.createElement("a");if(typeof B.download==="undefined"){l='<div>You need to "save link target as" and ensure that the filename ends with "'+q+'"</div>'}var w=$('<div style="display: none" class="ui-widget-content ui-corner-all progress-component" id="'+v+'" >'+A+'<a class="result-url" download="'+j+'" href="'+k+'" target="_blank" >Result Link</a><button id="'+p+'">Remove</button><button id="'+r+'">Load</button>'+l+"</div>");n.prepend(w);$("#"+p).button().click(function(){$("#"+v).detach()});$("#"+r).button().click(function(){updateSongSettingsComponent(f.content.genInfo,{name:f.content.name,seed:""+f.content.strSeed});afterExport(f)});w.show("slow");if(z){f.$audioElement=w.find("audio")}}else{logit("Could not create wav blob...")}}f.worker.removeEventListener("message",d);f.worker.terminate();f.success();break;case"progressReport":f.progress=Math.round(100*parseFloat(o.progress));break}}else{f.resultBuffer=o}};this.worker.addEventListener("message",d,false)}AsyncWorkerTask.prototype=new AsyncOperation();AsyncWorkerTask.prototype.cancel=function(){AsyncOperation.prototype.cancel.call(this);var a={type:"cancelTask"}};AsyncWorkerTask.prototype.update=function(){if(this.cancelled||this.done){return}if(!this.done){this.updateProgress(this.progress)}};AsyncWorkerTask.prototype.start=function(){var a={type:"startTask",transferableSupported:this.transferableSupported,taskType:this.taskType,content:this.content};this.worker.postMessage(a);this.addProgress()};function gatherEventsWithType(c,d){var a=[];for(var b=0;b<c.length;b++){var f=c[b];if(f.y==d){a.push(f)}}return a}function beatsToSeconds(a,b){return 60*(a/b)}function secondsToBeats(b,a){return b*a/60}function predictBeat(h,c){var l=120;var b=0;var n=0;var k=0;for(var j=0;j<h.length;j++){n=b;var m=h[j];var g=m.t-k;var d=beatsToSeconds(g,l);if(c>=b&&c<=b+d){var f=(c-b)/d;k+=f*g;b+=d*2;break}b+=d;k+=g;l=m.b}if(c>b){var o=c-b;var a=secondsToBeats(o,l);k+=a}return k}function gatherNotesFromEvents(u){var o={};var b={};var n=[];var m=120;var a=0;var l=0;for(var g=0;g<u.length;g++){var r=u[g];var f=r.t-l;if(f<0){logit("The events must be sorted "+f)}var k=beatsToSeconds(f,m);a+=k;switch(r.y){case"c":r.seconds=a;break;case"n":var q=o[r.c];if(!q){q=[];o[r.c]=q}q.push({onEvent:r,onTime:a});break;case"f":var q=o[r.c];if(!q){logit("Found note off without noteOn")}else{var h=null;for(var d=0;d<q.length;d++){var s=q[d];if(r.n==s.onEvent.n){if(!h||s.onEvent.t<h.onEvent.t){h=s}}}if(!h){logit("Failed to find matching noteOn event")}else{h.offEvent=r;h.offTime=a;var t=b[r.c];if(!t){t=[];b[r.c]=t}t.push(h);n.push(h);arrayDelete(q,h)}}break;case"t":r.seconds=a;var p=r.b;m=p;break;default:logit("Unknown event type "+r.y);break}l=r.t}return b}var AudioPlayerMode={STOP:0,PLAY:1,PAUSE:2};function AudioPlayer(){this.audioType="audio/mpeg";this.loadSamplesAsyncOperationConstructor=LoadAudioBuffersAsyncOperation;this.controlChannelInfos=[];this.channelNodes=[];this.notesPerSample=1;this.mode=AudioPlayerMode.STOP;this.channelMaps=null;this.data=null;this.origData=null;this.notes=null;this.origNotes=null;this.tempoEvents=null;this.origTempoEvents=null;this.controlEvents=null;this.origControlEvents=null;this.songPlayBeatTime=0;this.currentTempo=60;this.playSeconds=0;this.contextOffset=0;this.soundFontType=SoundFontType.STANDARD_HEAVY;this.settings=new WebAudioPlayerSettings();this.percussionBufferLengths=[125];this.playingVoices=[];this.bufferInfos={}}AudioPlayer.prototype.title="Player";AudioPlayer.prototype.updateVoice=function(a){if(a.offTime<this.getContextTime()){this.stopVoice(a);return false}else{return true}};AudioPlayer.prototype.step=function(){var k=this.getContextTime()-this.contextOffset-this.playSeconds;switch(this.mode){case AudioPlayerMode.PAUSE:this.contextOffset+=k;break;case AudioPlayerMode.STOP:this.playSeconds=0;this.contextOffset=this.getContextTime();break;case AudioPlayerMode.PLAY:var g=this.getBeatStep(k);var c=2;var l=this.splitSortedEvents(this.tempoEvents,this.playSeconds+k);var b=l[0];this.tempoEvents=l[1];for(var h=0;h<b.length;h++){this.currentTempo=b[h].b}var m=this.splitSortedEvents(this.controlEvents,this.playSeconds+k);var e=m[0];this.controlEvents=m[1];for(var h=0;h<e.length;h++){var d=e[h];this.scheduleControl(d)}var f=this.splitSortedNotes(this.notes,this.playSeconds+c,128);this.notes=f[1];var n=f[0];for(var a in n){var j=n[a];for(var h=0;h<j.length;h++){var o=j[h];if(o.onTime>this.playSeconds+c){logit("  stupid note should not play yet ")}this.scheduleNoteOnOff(j[h])}}this.playSeconds+=k;this.songPlayBeatTime+=g;break}this.updateVoices()};AudioPlayer.prototype.stopAllPlayingVoices=function(){for(var b=0;b<this.playingVoices.length;b++){var a=this.playingVoices[b];this.stopVoice(a)}this.playingVoices=[]};AudioPlayer.prototype.updateVoices=function(){var a=[];for(var c=0;c<this.playingVoices.length;c++){var b=this.playingVoices[c];if(this.updateVoice(b)){a.push(b)}}this.playingVoices=a};AudioPlayer.prototype.noteToFrequency=function(a){var c=a-69;var b=Math.pow(2,c/12);return 440*b};AudioPlayer.prototype.beatsToSeconds=function(a,b){b=b?b:this.currentTempo;return 60*(a/b)};AudioPlayer.prototype.secondsToBeats=function(b,a){a=a?a:this.currentTempo;return b*a/60};AudioPlayer.prototype.getBeatStep=function(a){return(this.currentTempo*a)/60};AudioPlayer.prototype.setRenderData=function(a){this.data=copyValueDeep(a);this.origData=copyValueDeep(a);this.notes=copyValueDeep(gatherNotesFromEvents(this.data.events));this.origNotes=copyValueDeep(this.notes);this.tempoEvents=copyValueDeep(gatherEventsWithType(this.data.events,"t"));this.origTempoEvents=copyValueDeep(this.tempoEvents);this.controlEvents=copyValueDeep(gatherEventsWithType(this.data.events,"c"));this.origControlEvents=copyValueDeep(this.controlEvents);return this};AudioPlayer.prototype.setChannelMaps=function(c){this.channelMaps={};for(var a=0;a<c.length;a++){var b=c[a];this.channelMaps[b.renderChannel]=b}};AudioPlayer.prototype.splitSortedEvents=function(c,h){var d=[];var g=[];var a=c.length;for(var b=0;b<c.length;b++){var f=c[b];if(f.seconds<h){d.push(f)}else{a=b;break}}for(var b=a;b<c.length;b++){g.push(c[b])}return[d,g]};AudioPlayer.prototype.splitSortedNotes=function(k,m,e){var l={};var c={};e=e?e:128;var j=0;for(var a in k){var g=k[a];var o=null;var d=g.length;for(var f=0;f<g.length;f++){var n=g[f];var b=n.onTime;if(b<m&&j<e){if(o==null){o=[];l[a]=o}o.push(n);j++}else{d=f;break}}if(d<g.length){var h=[];c[a]=h;for(var f=d;f<g.length;f++){h.push(g[f])}}}return[l,c]};AudioPlayer.prototype.createContextIfNecessary=function(){};AudioPlayer.prototype.play=function(){this.createContextIfNecessary();switch(this.mode){case AudioPlayerMode.PAUSE:break;case AudioPlayerMode.STOP:this.contextOffset=this.getContextTime();break}this.mode=AudioPlayerMode.PLAY};AudioPlayer.prototype.predictTime=function(b,h){var k=0;var f=120;var d=0;for(var c=0;c<b.length;c++){var g=b[c];if(g.t<h){var j=g.t-d;var a=this.beatsToSeconds(j,f);k+=a;f=g.b;d=g.t}else{break}}if(h>d){var j=h-d;var a=this.beatsToSeconds(j,f);k+=a}return k};AudioPlayer.prototype.gotoBeat=function(c){this.stopAllPlayingVoices();var a=Math.max(0,c);this.data=copyValueDeep(this.origData);this.notes=copyValueDeep(this.origNotes);this.tempoEvents=copyValueDeep(this.origTempoEvents);this.controlEvents=copyValueDeep(this.origControlEvents);var b=this.predictTime(this.tempoEvents,a);this.tempoEvents=this.splitSortedEvents(this.tempoEvents,b)[1];this.controlEvents=this.splitSortedEvents(this.controlEvents,b)[1];this.notes=this.splitSortedNotes(this.notes,b)[1];var d=b-this.playSeconds;this.songPlayBeatTime=a;this.playSeconds=b;this.contextOffset-=d};AudioPlayer.prototype.stop=function(){this.stopAllPlayingVoices();this.mode=AudioPlayerMode.STOP;this.data=copyValueDeep(this.origData);this.notes=copyValueDeep(this.origNotes);this.tempoEvents=copyValueDeep(this.origTempoEvents);this.controlEvents=copyValueDeep(this.origControlEvents);this.songPlayBeatTime=0;this.playSeconds=0;this.contextOffset=this.getContextTime()};AudioPlayer.prototype.pause=function(){this.stopAllPlayingVoices();this.mode=AudioPlayerMode.PAUSE};AudioPlayer.prototype.getProgramIndex=function(a){return a.program};AudioPlayer.prototype.getBufferInfoId=function(f){var a=this.getSoundFontPrefix(this.soundFontType);var e=f.onEvent;var b=this.data.renderChannelNames[e.c];var d=this.channelMaps[b];var c=this.getProgramIndex(d);if(b.indexOf("percussion")==0){a+="_perc_"}else{a+="_"+c+"_"}a+=""+e.n;return a};AudioPlayer.prototype.createBufferInfos=function(){for(var c in this.notes){var a=this.notes[c];for(var b=0;b<a.length;b++){this.createBufferInfoForNoteData(a[b])}}};AudioPlayer.prototype.getSoundFontPrefix=function(a){return SoundFontType.getSamplesPrefix(a)};AudioPlayer.prototype.createBufferInfoForNoteData=function(a){var h=a.onEvent;var t=a.offEvent;var b=h.n;var s=this.data.renderChannelNames[h.c];var u=s.indexOf("percussion")==0;var f=s.substring(0,s.indexOf("Render"));var p=parseInt(s.substring(s.length-1,s.length))-1;var g=clamp(Math.ceil(b/this.notesPerSample)*this.notesPerSample,0,127);if(u){g=b}var v=this.channelMaps[s];var d=[125];var j=this.getProgramIndex(v);var k="program"+j;if(u){d=this.percussionBufferLengths;k="percussion"}var l=(a.offTime-a.onTime);var m=1000*l;var e=d[0];for(var r=0;r<d.length;r++){var c=d[r];if(c<=m){e=c}}var o=this.getBufferInfoId(a);var n=this.bufferInfos[o];if(!n){var q=this.getSoundFontPrefix(this.soundFontType);n={id:o,channelName:s,channelPrefix:f,voiceIndex:p,isPercussion:u,url:u?"samples/"+q+"/"+k+"/length"+e+"/note_"+g+(canPlayMp3?".mp3":".ogg"):"",buffer:null};this.bufferInfos[o]=n}};AudioPlayer.prototype.getReadyForPlay=function(h,b){this.createBufferInfos();var e=[];var a=[];for(var g in this.bufferInfos){var d=this.bufferInfos[g];if(!d.buffer){var c=d.url;if(c){e.push(c);a.push(d)}}}this.createContextIfNecessary();if(e.length==0){h()}else{if(canPlayMp3){this.audioType="audio/mpeg"}else{this.audioType="audio/ogg"}var f=new this.loadSamplesAsyncOperationConstructor({bufferUrls:e,audioContext:this.context,audioType:this.audioType,onDone:function(){for(var k=0;k<a.length;k++){var j=a[k];j.buffer=f.resultBuffers[k]}h()},onCancel:function(){if(b){b()}}});addAsyncOperation(f)}};AudioPlayer.prototype.scheduleControl=function(c){var b=0.1;var f=c.seconds+this.contextOffset+b;var a=c.c;var d=c.v;var e=this.getChannelInfoForControlChannel(a);this.scheduleControlWithChannelInfo(e,d,f)};AudioPlayer.prototype.getChannelInfoForControlChannel=function(j){var d=this.controlChannelInfos[j];if(!d){d={};var g=this.data.controlChannelNames[j];var f=-1;var h="ControlChannel";var c=g.substring(0,g.indexOf(h))+"RenderChannel"+g.charAt(g.length-1);var b=g.substring(g.indexOf(h)+h.length,g.length-1);d.controlType=b;for(var e=0;e<this.data.renderChannelNames.length;e++){var k=this.data.renderChannelNames[e];if(k==c){f=e;break}}if(f!=-1){var a=this.getOrCreateChannelNodes(f);d.nodes=a}else{}this.controlChannelInfos[j]=d}return d};function AudioElementVoice(){this.audioElement=null;this.offTime=0;this.isPlaying=false;this.timeout=null}function SoundManager2Player(){AudioPlayer.call(this);this.notesPerSample=1;this.contextStartTime=-1;this.loadSamplesAsyncOperationConstructor=LoadSM2SoundsAsyncOperation}SoundManager2Player.prototype=new AudioPlayer();SoundManager2Player.prototype.title="Sound Manager 2 (Web Audio not detected)";SoundManager2Player.prototype.getSoundFontPrefix=function(a){return SoundFontType.getSamplesPrefix(SoundFontType.STANDARD_HEAVY)};SoundManager2Player.prototype.getProgramIndex=function(a){return 0};SoundManager2Player.prototype.getContextTime=function(){var a=Date.now()*0.001;if(this.contextStartTime==-1){this.contextStartTime=a}return a-this.contextStartTime};SoundManager2Player.prototype.stopVoice=function(a){if(a.timeout!=null){clearTimeout(a.timeout);a.timeout=null}};SoundManager2Player.prototype.getOrCreateChannelNodes=function(b){var a=this.channelNodes[b];if(!a){a={};a.channelName=this.data.renderChannelNames[b];this.channelNodes[b]=a}return a};SoundManager2Player.prototype.scheduleControlWithChannelInfo=function(b,a){};SoundManager2Player.prototype.scheduleNoteOnOff=function(l){var k=l.onEvent;var e=0.1;var a=l.onTime+this.contextOffset+e;var c=l.offTime+this.contextOffset+e;c+=2;var d=this.getBufferInfoId(l);var f=this.bufferInfos[d];var j=f.buffer;var h=1;if(f.channelPrefix=="percussion"){h=this.settings.percussionVolumeMultiplier}else{var g=this.settings[f.channelPrefix+"VolumeMultipliers"];if(g.length>0){h=g[f.voiceIndex%g.length]}}var i=new AudioElementVoice();i.audioElement=j;i.offTime=c;i.isPlaying=true;this.playingVoices.push(i);var b=Math.max(0,a-this.getContextTime());i.timeout=setTimeout(function(){j.play({volume:Math.round(clamp(h*100,0,100))})},Math.round(b*1000))};function WebAudioVoice(){this.outputNode=null;this.offTime=0}function WebAudioChannelNodes(){this.channelName="";this.chorusSend=null;this.delaySend=null;this.reverbSend=null;this.gain=null;this.filter=null;this.panner=null}function WebAudioPlayer(){AudioPlayer.call(this);this.notesPerSample=6;this.context=null;this.compressor=null;this.melodicBuffers={};this.percussionBuffers={};this.bufferAmpScale=0.1}WebAudioPlayer.prototype=new AudioPlayer();WebAudioPlayer.prototype.title="Web Audio";WebAudioPlayer.prototype.getContextTime=function(){return this.context.currentTime};WebAudioPlayer.prototype.contextSupported=function(){return this.getContextConstructor()!=null};WebAudioPlayer.prototype.getContextConstructor=function(){var a=null;if(typeof(AudioContext)!="undefined"){a=AudioContext}else{if(typeof(webkitAudioContext)!="undefined"){a=webkitAudioContext}}return a};WebAudioPlayer.prototype.createContextIfNecessary=function(){if(!this.context){var a=this.getContextConstructor();this.context=new a()}};WebAudioPlayer.prototype.createBuffer=function(d,f){var a=this.context.createBuffer(1,this.context.sampleRate,this.context.sampleRate);var e=a.getChannelData(0);for(var c=0;c<e.length;c++){var b=c/(e.length-1);e[c]=d.call(this,b*f)}return a};WebAudioPlayer.prototype.stopVoice=function(a){a.outputNode.disconnect()};WebAudioPlayer.prototype.getOrCreateChannelNodes=function(b){if(!this.compressor){this.compressor=this.context.createDynamicsCompressor();this.compressor.connect(this.context.destination);this.context.listener.setPosition(0,0,0);this.context.listener.setOrientation(0,0,-1,0,1,0)}var a=this.channelNodes[b];if(!a){a=new WebAudioChannelNodes();a.channelName=this.data.renderChannelNames[b];this.channelNodes[b]=a;a.panner=this.context.createPanner();a.panner.setPosition(0,0,1);a.panner.connect(this.compressor);a.filter=this.context.createBiquadFilter();a.filter.type=0;a.filter.frequency.value=10000;a.filter.Q.value=0;a.filter.connect(a.panner);a.gain=this.context.createGain();a.gain.connect(a.filter)}return a};WebAudioPlayer.prototype.scheduleControlWithChannelInfo=function(c,j,e){try{if(c.nodes){switch(c.controlType){case"Pan":var a=Math.PI/4;var k=2*(j-0.5);var f=k*a;var b=1;c.nodes.panner.setPosition(b*Math.sin(f),0,-b*Math.cos(f));break;case"FilterF":var l=this.noteToFrequency(127);var d=this.noteToFrequency(0);var i=d+(l-d)*j;c.nodes.filter.frequency.exponentialRampToValueAtTime(i,e);break;case"FilterQ":var g=1/(0.01+0.1*j);c.nodes.filter.Q.exponentialRampToValueAtTime(g,e);break;default:logit("Unknown control type "+c.controlType);break}}}catch(h){logit("Error when scheduling control")}};WebAudioPlayer.prototype.sineBufferFunc=function(c){var b=2*Math.PI*c;return this.bufferAmpScale*Math.sin(b)};WebAudioPlayer.prototype.sawBufferFunc=function(a){a=mod(a,1);return this.bufferAmpScale*(-1+2*a)};WebAudioPlayer.prototype.squareBufferFunc=function(a){a=mod(a,1);return this.bufferAmpScale*(a<0.5?-1:1)};WebAudioPlayer.prototype.triangleBufferFunc=function(a){a=mod(a,1);return this.bufferAmpScale*(a<0.5?-1+4*a:3-4*a)};WebAudioPlayer.prototype.snareBufferFunc=function(a){return this.bufferAmpScale*(-1+2*Math.random())};WebAudioPlayer.prototype.scheduleNoteOnOff=function(e){var i=this.getBufferInfoId(e);var q=this.bufferInfos[i];var B=q.channelPrefix=="percussion";var o=e.onEvent;var C=0.1;var d=e.onTime+this.contextOffset+C;var z=e.offTime+this.contextOffset+C;var n=z;z+=1;var s=q.voiceIndex;var E=null;var f=null;switch(q.channelPrefix){case"melody":f=this.settings.melodyInstruments;break;case"inner1":f=this.settings.inner1Instruments;break;case"inner2":f=this.settings.inner2Instruments;break;case"bass":f=this.settings.bassInstruments;break}if(f!=null){if(f.length>0){var g=f[s%f.length];if(g instanceof PrimitiveWebAudioPlayerInstrument){E=g.type}}else{E=PrimitiveWebAudioPlayerInstrumentType.SQUARE}}if(!B&&typeof(E)==="undefined"){E=PrimitiveWebAudioPlayerInstrumentType.MATCH}if(E==null){return}var t=this.getOrCreateChannelNodes(o.c);var k=this.context.createBufferSource();var y=k;var u=null;if(B){u=q.buffer;if(!u){logit("Could not find percussion buffer "+o.n);u=this.percussionBuffers[o.n];if(!u){var A=this.snareBufferFunc;u=this.createBuffer(A,1);this.percussionBuffers[o.n]=u}var x=this.context.createGain();var b=x.gain;b.setValueAtTime(0,d);b.exponentialRampToValueAtTime(1,d+0.01);b.exponentialRampToValueAtTime(0,d+0.25);k.connect(x);k.playbackRate.value=1;y=x}}else{k.loop=true;var l=this.noteToFrequency(o.n);var h=22;u=this.melodicBuffers[E];if(!u){var A=this.sineBufferFunc;switch(E){case PrimitiveWebAudioPlayerInstrumentType.SAW:A=this.sawBufferFunc;break;case PrimitiveWebAudioPlayerInstrumentType.SINE:A=this.sineBufferFunc;break;case PrimitiveWebAudioPlayerInstrumentType.TRIANGLE:A=this.triangleBufferFunc;break;case PrimitiveWebAudioPlayerInstrumentType.SQUARE:A=this.squareBufferFunc;break}u=this.createBuffer(A,h);this.melodicBuffers[E]=u}k.playbackRate.value=l/h;var p=n-d;var w=Math.min(0.05,p*0.5);var j=Math.min(0.2,p*0.5);var a=0.25;var m=0.25;var x=this.context.createGain();var b=x.gain;b.setValueAtTime(0,d);b.linearRampToValueAtTime(1,d+w);b.linearRampToValueAtTime(a,d+w+j);b.linearRampToValueAtTime(a,n);b.linearRampToValueAtTime(0,n+m);k.connect(x);y=x}k.buffer=u;var r=1;if(q.channelPrefix=="percussion"){r=this.settings.percussionVolumeMultiplier}else{var c=this.settings[q.channelPrefix+"VolumeMultipliers"];if(c&&c.length>0){r=c[q.voiceIndex%c.length]}}var v=this.context.createGain();v.gain.value=o.v*r;y.connect(v);v.connect(t.gain);k.start(d);k.stop(z);var D=new WebAudioVoice();D.outputNode=y;D.offTime=z;this.playingVoices.push(D)};function FrustumCullingChunks(){this.objects=[];this.boundingSpheres=[];this.maxDistance=1000;this.objectsInScene=[];this.objectsNotInScene=[];this.planes=[new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4()]}FrustumCullingChunks.prototype.addChunk=function(b,a){this.objects.push(b);this.boundingSpheres.push(a);this.objectsInScene.push(this.objects.length-1)};FrustumCullingChunks.prototype.updateScene=function(B,t){var b;var n=this.planes;var C=t.elements;var r=C[0],p=C[1],o=C[2],l=C[3];var k=C[4],j=C[5],h=C[6],g=C[7];var f=C[8],e=C[9],y=C[10],w=C[11];var v=C[12],u=C[13],s=C[14],q=C[15];n[0].set(l-r,g-k,w-f,q-v);n[1].set(l+r,g+k,w+f,q+v);n[2].set(l+p,g+j,w+e,q+u);n[3].set(l-p,g-j,w-e,q-u);n[4].set(l-o,g-h,w-y,q-s);n[5].set(l+o,g+h,w+y,q+s);for(var x=0;x<6;x++){b=n[x];b.divideScalar(Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z))}var A=[];var a=[];var E=[];var z=[];for(var x=0;x<this.objectsInScene.length;x++){var d=this.objectsInScene[x];var D=this.objects[d];var c=this.boundingSpheres[d];if(!this.contains(D,c)){A.push(D);z.push(d)}else{E.push(d)}}for(var x=0;x<this.objectsNotInScene.length;x++){var d=this.objectsNotInScene[x];var D=this.objects[d];var c=this.boundingSpheres[d];if(this.contains(D,c)){a.push(D);E.push(d)}else{z.push(d)}}this.objectsNotInScene=z;this.objectsInScene=E;for(var x=0;x<a.length;x++){B.add(a[x])}for(var x=0;x<A.length;x++){B.remove(A[x])}};FrustumCullingChunks.prototype.contains=function(d,f){var h=0;var c=this.planes;var b=d.matrixWorld;var g=b.elements;var a=-f.radius*b.getMaxScaleOnAxis();for(var e=0;e<6;e++){h=c[e].x*g[12]+c[e].y*g[13]+c[e].z*g[14]+c[e].w;if(h<=a){return false}}return true};var VisualizerMode={PLAY:0,PAUSE:1,STOP:2};function Visualizer(){this.mode=VisualizerMode.STOP;this.currentBeatTime=0;this.currentStopBeatTime=0;this.minBeat=0;this.maxBeat=1;this.focusBeat=0;this.sectionTimes=null;this.songStructureInfo=null}Visualizer.prototype.updateSectionFramework=function(){};Visualizer.prototype.setSectionInfos=function(b,a){this.sectionTimes=b;this.songStructureInfo=a;this.updateSectionFramework();return this};Visualizer.prototype.setMode=function(a){this.mode=a;return this};Visualizer.prototype.render=function(){};Visualizer.prototype.step=function(a){};Visualizer.prototype.setCurrentPlayBeatTime=function(a){this.currentBeatTime=a;return this};Visualizer.prototype.addRenderData=function(b,a){};Visualizer.prototype.resetRenderData=function(){this.mode=VisualizerMode.STOP;this.minBeat=0;this.maxBeat=1};var Visualizer3DPlayMovementMode={ROTATE:0,PAN:1};var Visualizer3DPauseMovementMode={ROTATE:0,PAN:1};function Visualizer3D(b,j){Visualizer.call(this);if(b){this.mousePageX=b.width*0.5;this.mousePageY=b.height*0.5;this.mouseCanvasX=b.width*0.5;this.mouseCanvasY=b.height*0.5;this.mouseCanvasDragDx=0;this.mouseCanvasDragDy=0;this.mouseCanvasDown=false;this.fractionDragVelX=0;this.fractionDragVelY=0;this.currentAngle=0;var f=this;$(document).on("mousemove",function(l){if(f.mouseCanvasDown){var k=l.pageX-f.mousePageX;var h=l.pageY-f.mousePageY;f.mouseCanvasDragDx+=k;f.mouseCanvasDragDy+=h}f.mousePageX=l.pageX;f.mousePageY=l.pageY});$(b).on("mousemove",function(h){if(f.mouseCanvasDown){f.mouseCanvasDragDx+=h.pageX-f.mouseCanvasX;f.mouseCanvasDragDy+=h.pageY-f.mouseCanvasY}f.mouseCanvasX=h.pageX;f.mouseCanvasY=h.pageY});$(b).on("mousedown",function(h){f.mouseCanvasDown=true});$(document).on("mouseup",function(h){f.mouseCanvasDown=false});this.clearColor=328976;this.renderChannelNames=[];this.playMovementMode=Visualizer3DPlayMovementMode.PAN;this.stopMovementMode=Visualizer3DStopMovementMode.PAN_INTERACTIVE_HOVER;this.pauseMovementMode=Visualizer3DPauseMovementMode.PAN;this.beatLengthScale=2;var i=b.width;var d=b.height;var c=75;var g=1;var e=1000;this.canvas=b;this.camera=new THREE.CombinedCamera(i,d,c,g,e,g,e);this.camera.position.set(0,60,50);this.camera.lookAt(new THREE.Vector3(0,40,0));this.scene=new THREE.Scene();this.scene.fog=new THREE.FogExp2(this.clearColor,0.008);this.landscapeChunkSize=128;this.landscapeChunkDivisions=this.getLandscapeChunkDivisions();var a=new MersenneTwister(3423432);this.perlin=new ClassicalNoise(a);this.frustumChunks=new FrustumCullingChunks();this.createLandscape();this.addGlobalLights();this.noteChunks=[];this.noteCollisionGrid=[];this.allNoteDatas=[];this.currentLookAt=new THREE.Vector3(0,0,0)}}Visualizer3D.prototype=new Visualizer();Visualizer3D.prototype.getLandscapeChunkDivisions=function(){return 16};Visualizer3D.prototype.clearHighlightNotes=function(){this.upperLight.intensity=0;this.middleLight.intensity=0;this.lowerLight.intensity=0;for(var a=0;a<this.allNoteDatas.length;a++){var b=this.allNoteDatas[a];b.mesh.scale.set(b.w,1,1);b.material.emissive=new THREE.Color(b.normalEmissive);b.material.color=new THREE.Color(b.normalColor)}};Visualizer3D.prototype.highlightNotes=function(a){var t=Math.floor(a);this.upperLight.intensity=0;this.middleLight.intensity=0;this.lowerLight.intensity=0;var r=[{light:this.upperLight,colorVec:new THREE.Vector3(0.01,0.01,0.01),pos:new THREE.Vector3(0,0,0),count:0},{light:this.middleLight,colorVec:new THREE.Vector3(0.01,0.01,0.01),pos:new THREE.Vector3(0,0,0),count:0},{light:this.lowerLight,colorVec:new THREE.Vector3(0.01,0.01,0.01),pos:new THREE.Vector3(0,0,0),count:0}];if(t>=0){var c=this.noteCollisionGrid[t];if(c){for(var o=0;o<c.length;o++){var s=c[o];var j=s.onEvent;var u=j.c;var p=this.renderChannelNames[u];var q=s.offEvent;if(a>=j.t&&a<=q.t){var e=(a-j.t)/(q.t-j.t);var l=1-e;var k=0.7;var d=new THREE.Color(s.normalColor);var m=new THREE.Color(s.playColor);s.material.emissive=d;s.material.color=m;s.mesh.scale.set(s.w,1+k*l,1+k*l);var g=0;if(p.indexOf("inner")==0){g=1}else{if(p.indexOf("bass")==0||p.indexOf("percussion")==0){g=2}}var f=r[g];var h=Math.max(0.5,l);f.colorVec.add(new THREE.Vector3(d.r*h,d.g*h,d.b*h));f.pos.add(new THREE.Vector3(s.minX,s.minY,s.minZ));f.count++}else{s.mesh.scale.set(s.w,1,1);s.material.emissive=new THREE.Color(s.normalEmissive);s.material.color=new THREE.Color(s.normalColor)}}}}for(var o=0;o<r.length;o++){var f=r[o];if(f.count>0){f.pos.divideScalar(f.count);f.light.position.copy(f.pos);f.light.intensity=0.5*f.colorVec.length();f.colorVec.normalize();var n=new THREE.Color();n.r=f.colorVec.x;n.g=f.colorVec.y;n.b=f.colorVec.z;f.light.color=n}}};Visualizer3D.prototype.step=function(i){var p=new THREE.Vector3();var z=new THREE.Vector3(1,0,0);var J=new THREE.Vector3().copy(this.camera.position);var q=this.currentLookAt;var K=0.9;var P=window.innerWidth;var h=window.innerHeight;var s=this.mousePageX/P;var r=this.mousePageY/h;var y=this.mouseCanvasDragDx/P;var w=this.mouseCanvasDragDy/h;var u=i*0.001;if(!P||!h){var v=$(document);P=v.innerWidth();h=v.innerWidth()}if(u>0&&P&&h){if(this.mouseCanvasDown){var I=0.5;var m=1-I;var d=y/u;var M=w/u;this.fractionDragVelX=this.fractionDragVelX*I+d*m;this.fractionDragVelY=this.fractionDragVelY*I+M*m}else{var e=1.5;var E=-e*this.fractionDragVelX;var D=-e*this.fractionDragVelY;this.fractionDragVelX+=E*u;this.fractionDragVelY+=D*u}}switch(this.mode){case VisualizerMode.PLAY:var C=this.currentBeatTime*this.beatLengthScale;var l=70;var G=70;p.set(C,G,l);z.set(C,G,0);this.highlightNotes(this.currentBeatTime);break;case VisualizerMode.PAUSE:case VisualizerMode.STOP:this.currentStopBeatTime+=i*0.002;var n=this.currentStopBeatTime;switch(this.stopMovementMode){case Visualizer3DStopMovementMode.ROTATE_INTERACTIVE_HOVER:var c=this.maxBeat*0.5*this.beatLengthScale;var t=150-100*r;var a=150-100*r;var k=Math.PI*s;p.set(t*Math.cos(k)+c,a,t*Math.sin(k));z.set(c,60,0);break;case Visualizer3DStopMovementMode.ROTATE_PAN_INTERACTIVE_HOVER:var c=this.maxBeat*s*this.beatLengthScale;var t=100-50*r;var a=100-50*r;var k=-0.75*Math.PI*(s-0.5)-Math.PI*1.5;p.set(t*Math.cos(k)+c,a,t*Math.sin(k));z.set(c,60,0);break;case Visualizer3DStopMovementMode.PAN_INTERACTIVE_HOVER:var c=this.maxBeat*s*this.beatLengthScale;var j=60;var a=80-40*r;p.set(c,a,j);z.set(c,a,0);break;case Visualizer3DStopMovementMode.PAN_INTERACTIVE_DRAG:var N=clamp(q.x-P*this.fractionDragVelX*u,0,this.maxBeat*this.beatLengthScale);var L=clamp(q.y+h*this.fractionDragVelY*u,0,127);var j=60;p.set(N,L,j);z.set(N,L,0);break;case Visualizer3DStopMovementMode.ROTATE_INTERACTIVE_DRAG:var c=this.maxBeat*0.5*this.beatLengthScale;this.currentAngle+=this.fractionDragVelX*u;var B=this.camera.position;var o=clamp(B.y+h*this.fractionDragVelY*u,40,500);var a=o;var t=o;var G=60;p.set(c+t*Math.cos(this.currentAngle),a,t*Math.sin(this.currentAngle));z.set(c,G,0);break;case Visualizer3DStopMovementMode.ROTATE_PAN_INTERACTIVE_DRAG:var B=this.camera.position;var N=clamp(q.x-P*this.fractionDragVelX*u,0,this.maxBeat*this.beatLengthScale);var L=clamp(B.y+500*this.fractionDragVelY*u,20,300);s=N/(this.maxBeat*this.beatLengthScale);var k=0.25*Math.PI*(s-0.5)-Math.PI*1.5;var t=L;p.set(t*Math.cos(k)+N,L,t*Math.sin(k));z.set(N,60,0);break;case Visualizer3DStopMovementMode.PAN:var f=1;var t=60;var O=0;if(this.maxBeat>5){var A=2*this.maxBeat*this.beatLengthScale;var F=f*this.beatLengthScale*n;O=mod(F,A)/A;if(O>=0.5){O=1-(O-0.5)*2}else{O*=2}}var C=O*this.maxBeat*2;p.set(C,t,t);z.set(C,60,0);break;case Visualizer3DStopMovementMode.ROTATE:var c=this.maxBeat*0.5*this.beatLengthScale;var t=100;var a=100;var b=0.01;var k=b*Math.PI*2*n+Math.PI/2;p.set(100*Math.cos(k)+c,a,100*Math.sin(k));z.set(c,60,0);break}break}var Q=1-K;this.camera.position.set(p.x*Q+J.x*K,p.y*Q+J.y*K,p.z*Q+J.z*K);q=new THREE.Vector3(z.x*Q+q.x*K,z.y*Q+q.y*K,z.z*Q+q.z*K);var H=this.camera.position.distanceTo(q);if(H<0.0001){q.add(new THREE.Vector3(0.1*Math.random()+0.01,0.1*Math.random(),0.1*Math.random()))}this.camera.lookAt(q);this.currentLookAt=q;var g=new THREE.Matrix4();g.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse);this.frustumChunks.updateScene(this.scene,g);this.mouseCanvasDragDx=0;this.mouseCanvasDragDy=0};Visualizer3D.prototype.getLandscapeNormal=function(b,i){var g=0.1;var e=this.randomHeight(b,i);var f=(this.randomHeight(b+g,i)-e)/g;var c=(this.randomHeight(b,i+g)-e)/g;var a=new THREE.Vector3(-f,1,-c).normalize();return a};Visualizer3D.prototype.randomHeight=function(i,h){var b=3;var d=this.landscapeChunkSize;var l=this.perlin;var f=34.342352;var c=l.noise(b*i/d,b*h/d,f);b*=2;f=21.23423;c+=0.5*l.noise(b*i/d,b*h/d,f);b*=2;f=43.24891;c+=0.25*l.noise(b*i/d,b*h/d,f);var m=40+c*20;var e=35;var k=15;var g=0.5;var a=Math.abs(h);if(a<e){var j=(e-a)/e;j=Math.min(j,g);m=j*k+(1-j)*m}return m};Visualizer3D.prototype.createLandscapeChunk=function(j,h){var q=this.landscapeChunkSize;var z=this.landscapeChunkDivisions;var d=new THREE.Object3D();var B=new THREE.PlaneGeometry(q,q,z-1,z-1);var c=new THREE.Matrix4();c.rotateX(-Math.PI*0.5);var u=j*q;var t=h*q;B.applyMatrix(c);var m=q/z;for(var A=0,w=B.vertices.length;A<w;A++){var p=A%z;var o=~~(A/z);var r=B.vertices[A];r.y=this.randomHeight(r.x+u,r.z+t)}var k=B.vertices;for(var A=0;A<B.faces.length;A++){var n=B.faces[A];var g=k[n.a];var f=k[n.b];var e=k[n.c];var b=k[n.d];n.vertexNormals[0].copy(this.getLandscapeNormal(g.x+u,g.z+t));n.vertexNormals[1].copy(this.getLandscapeNormal(f.x+u,f.z+t));n.vertexNormals[2].copy(this.getLandscapeNormal(e.x+u,e.z+t));n.vertexNormals[3].copy(this.getLandscapeNormal(b.x+u,b.z+t))}B.computeFaceNormals();B.normalsNeedUpdate=true;var s=this.getLandscapeMaterial(4473924,3355443);B.computeCentroids();var a=new THREE.Mesh(B,s);d.add(a);d.position.set(u,0,t);return d};Visualizer3D.prototype.createLandscape=function(){this.landscapeInfos=[];var g=-1;var j=5;var e=-1;var i=1;var f=this.landscapeChunkSize/Math.sqrt(2);for(var h=g;h<=j;h++){for(var d=e;d<=i;d++){var a=h;var b=d;var c=this.createLandscapeChunk(a,b);this.scene.add(c);this.frustumChunks.addChunk(c,{radius:f})}}};Visualizer3D.prototype.render=function(){this.renderer.render(this.scene,this.camera)};Visualizer3D.prototype.resized=function(a,b){this.camera.aspect=a/b;this.camera.updateProjectionMatrix();this.renderer.setSize(a,b)};Visualizer3D.prototype.addGlobalLights=function(){var a=new THREE.DirectionalLight(16777215,0.5);var b=new THREE.Vector3(0.5,0.5,0.5).normalize();a.position.copy(b);this.scene.add(a);this.upperLight=new THREE.PointLight(16777215,0,100);this.middleLight=new THREE.PointLight(16777215,0,100);this.lowerLight=new THREE.PointLight(16777215,0,100);this.scene.add(this.upperLight);this.scene.add(this.middleLight);this.scene.add(this.lowerLight)};Visualizer3D.prototype.getNoteMaterial=function(a,b){if(!a){a=0}if(!b){b=0}return new THREE.MeshPhongMaterial({color:a,emissive:b,overdraw:true})};Visualizer3D.prototype.getLandscapeMaterial=function(a,b){return new THREE.MeshPhongMaterial({color:a,emissive:b,overdraw:true})};Visualizer3D.prototype.createNoteGeometry=function(){return new THREE.CubeGeometry(1,1,1)};Visualizer3D.prototype.getChannelPlayColors=function(){return{melody:[16711680,16746496,16746632],inner1:[65280,8978176,8978312],inner2:[255,8913151,8947967],bass:[16711680,16746496,16746632],percussion:[6710886]}};Visualizer3D.prototype.addRenderData=function(O,l){Visualizer.prototype.addRenderData.call(this,O,l);this.renderChannelNames=O.renderChannelNames;var o=O.events;var d=new THREE.Object3D();this.maxBeat=Math.max(this.maxBeat,l);var t=gatherNotesFromEvents(o);var N={melody:[16711680,16746496,16746632],inner1:[65280,8978176,8978312],inner2:[255,8913151,8947967],bass:[16711680,16746496,16746632],percussion:[6710886]};var P=this.getChannelPlayColors();var H={melody:[131072,131328,131329],inner1:[512,66048,66049],inner2:[2,65538,65794],bass:[131072,131328,131329],percussion:[65793]};var u={melody:2,inner1:1,inner2:0,bass:-1,percussion:-2};function p(w,y,j){var i=j;for(var x in w){if(y.indexOf(x)==0){i=w[x]}}return i}var M=2;var c=this.createNoteGeometry();for(var K=0;K<=l;K++){this.noteCollisionGrid[K]=[]}this.allNoteDatas=[];for(var v in t){var h=parseInt(v);var f=O.renderChannelNames[h];if(f=="chordsRenderChannel"){continue}var a=t[v];addAll(this.allNoteDatas,a);var C=parseInt(f.charAt(f.length-1))-1;var r=p(N,f,16777215)[C];var b=p(P,f,16777215)[C];var k=p(H,f,16777215)[C];var A=M*p(u,f,-4);for(var J=0;J<a.length;J++){var q=a[J];var G=q.onEvent;var e=q.offEvent;if(!e){continue}var F=Math.floor(G.t);var n=Math.ceil(e.t);for(var s=F;s<=n;s++){var g=this.noteCollisionGrid[s];if(!g){g=[];this.noteCollisionGrid[s]=g}g.push(q)}var L=1;var Q=1;var D=G.t*this.beatLengthScale;var B=G.n;var E=this.beatLengthScale*(Math.max(0.05,(e.t-G.t-0.1)));var I=this.getNoteMaterial(r,k);var m=new THREE.Mesh(c,I);q.minX=D;q.maxX=e.t*this.beatLengthScale;q.minY=B;q.maxY=B+Q;q.minZ=A;q.maxZ=A+L;q.material=I;q.normalColor=r;q.playColor=b;q.normalEmissive=k;q.w=E;q.mesh=m;m.position.set(D+E*0.5,B,A);m.scale.set(E,1,1);d.add(m)}}this.scene.add(d);this.noteChunks.push(d);this.render()};Visualizer3D.prototype.updateSectionFramework=function(){if(this.sectionMarkers&&this.sectionMarkers.frameworkObject){this.scene.remove(this.sectionMarkers.frameworkObject)}if(this.songStructureInfo&&this.sectionTimes){var h=new THREE.Object3D();this.sectionMarkers={frameworkObject:h};function g(o,n,i,r,q,p,v){var s=new THREE.Geometry();var u=new THREE.Vector3();u.x=o;u.z=i;u.y=n;var t=new THREE.Vector3();t.x=r;t.z=p;t.y=q;s.vertices.push(u);s.vertices.push(t);var w=new THREE.Line(s,v);return w}function f(i,t,r,q,n){var p=12;var o=new THREE.ParticleCanvasMaterial({color:16777215,program:function(u){u.scale(1,-1);u.font=p+"px Segoe UI,Arial,sans-serif";u.fillText(q,0,p*1.5)}});var s=new THREE.Particle(o);s.position.x=i;s.position.y=t;s.position.z=r;s.scale.x=s.scale.y=n/p;return s}var l=new THREE.LineBasicMaterial({color:16776960,opacity:0.5});var d=arrayCopy(this.sectionTimes);d.unshift(0);var c=20;var a=105;var m=this.songStructureInfo.indexInfos;for(var e=0;e<d.length;e++){var b=d[e];var j=b*this.beatLengthScale;h.add(g(j,a,0,j,a,0,l));h.add(g(j,c,0,j,a,0,l));if(e<m.length){var k=getSongPartName(e,this.songStructureInfo);h.add(f(j+1,a,0,k,2))}}this.scene.add(h)}};Visualizer3D.prototype.resetRenderData=function(){Visualizer.prototype.resetRenderData.call(this);for(var a=0;a<this.noteChunks.length;a++){var b=this.noteChunks[a];this.scene.remove(b)}this.noteChunks=[];this.noteCollisionGrid=[];this.currentBeatTime=0;this.currentStopBeatTime=0};function CanvasVisualizer3D(c,b){Visualizer3D.call(this,c,b);var a=c.width;var d=c.height;this.renderer=new THREE.CanvasRenderer({canvas:c});this.renderer.sortObjects=false;this.renderer.setSize(a,d);this.renderer.setClearColorHex(this.clearColor,1)}CanvasVisualizer3D.prototype=new Visualizer3D();CanvasVisualizer3D.prototype.getChannelPlayColors=function(){return{melody:[16777215,16777215,16777215],inner1:[16777215,16777215,16777215],inner2:[16777215,16777215,16777215],bass:[16777215,16777215,16777215],percussion:[16777215]}};CanvasVisualizer3D.prototype.createNoteGeometry=function(){return new THREE.PlaneGeometry(1,1)};CanvasVisualizer3D.prototype.getLandscapeChunkDivisions=function(){return 8};CanvasVisualizer3D.prototype.getNoteMaterial=function(b,c){var a=new THREE.MeshBasicMaterial({color:b,emissive:c,wireframe:false});a.side=THREE.DoubleSide;return a};CanvasVisualizer3D.prototype.getLandscapeMaterial=function(a,b){return new THREE.MeshBasicMaterial({color:a,emissive:b,wireframe:true})};function WebGLVisualizer3D(c,b){Visualizer3D.call(this,c,b);this.addBloom=getValueOrDefault(b,"addBloom",true);this.addVignette=getValueOrDefault(b,"addVignette",true);this.addSimulatedAA=getValueOrDefault(b,"addSimulatedAA",true);var a=c.width;var e=c.height;this.renderer=new THREE.WebGLRenderer({canvas:c,antialias:false});this.renderer.sortObjects=false;this.renderer.setSize(a,e);this.renderer.setClearColorHex(this.clearColor,1);this.renderer.autoClear=false;var d=new THREE.RenderPass(this.scene,this.camera);var g=new THREE.BloomPass(1,25,4,512);var f=new THREE.ShaderPass(THREE.CopyShader);this.effectFXAA=new THREE.ShaderPass(THREE.FXAAShader);this.effectFXAA.uniforms.resolution.value.set(1/a,1/e);var i=new THREE.ShaderPass(THREE.VignetteShader);i.uniforms.darkness.value=1.1;i.uniforms.offset.value=1;f.renderToScreen=true;this.composer=new THREE.EffectComposer(this.renderer);this.composer.addPass(d);if(this.addBloom){this.composer.addPass(g)}if(this.addSimulatedAA){this.composer.addPass(this.effectFXAA)}if(this.addVignette){this.composer.addPass(i)}this.composer.addPass(f)}WebGLVisualizer3D.prototype=new Visualizer3D();WebGLVisualizer3D.prototype.render=function(){this.renderer.clear();this.composer.render()};WebGLVisualizer3D.prototype.resized=function(a,b){Visualizer3D.prototype.resized.call(this,a,b);this.effectFXAA.uniforms.resolution.value.set(1/a,1/b);this.composer.reset()};var lightServerMode=true;window.URL=window.URL||window.webkitURL||window.mozURL||window.oURL||window.msURL;var loaderTimeout=10;var allLoaded=false;var usingWebGL=false;var AudioPlayerConstructor=null;if(Modernizr.webaudio){AudioPlayerConstructor=WebAudioPlayer}var canPlayMp3=true;var loggedIn=false;var user=null;var userInfo=null;var globalRnd=new MersenneTwister();var globalGenInfo=new GenInfo();var settingsDirty=false;var songSettingsChangedWhileRendering=false;var audioPlayer=null;var uidManager=new UniqueIdManager();var songSettingsCompInfo=null;var songSettingsDirty=false;var asyncOperations=[];var asyncOperationCounter=0;var propertyInfoProvider=new PropertyInfoProvider();var visualizer=null;var $playButton=null;var $stopButton=null;var $forwardButton=null;var $rewindButton=null;var $refreshButton=null;function getMainSeed(){var a=213124;if(songSettings.seed){var b=parseInt(songSettings.seed);if(isNaN(b)){a=hashCode(songSettings.seed)}else{a=b}}return a}function getSeedStringsObject(b,d){var a={};for(var e in b){if(e.indexOf("Seed")>=0){var c=d[e];if(typeof(c)!="undefined"){a[e]=""+c}else{a[e]=""}}}return a}function getSeeds(a,c){for(var e in c){if(e.indexOf("Seed")>=0){var d=c[e];if(d){var b=parseInt(d);if(isNaN(b)){b=hashCode(d)}if(!isNaN(b)){a[e]=b}}}}}function copyWithPropertyInfoProvider(a,c,e){if(!a){a={}}if(!e){e=c}var g=propertyInfoProvider.getGuiPropertyInfos(c).getAsArray();for(var b=0;b<g.length;b++){var f=g[b];var d=e[f.propertyName];if(!isFunction(d)){a[f.propertyName]=d}}return a}function getGenInfo(){var a={};getSeeds(a,songStructureSeedSettings);getSeeds(a,songContentSeedSettings);getSeeds(a,songIndicesSeedSettings);copyWithPropertyInfoProvider(a,songParameters);copyWithPropertyInfoProvider(a,songDomains);copyWithPropertyInfoProvider(a,songDetails);return a}function showModalDialog(d,b,a){var c=$('<div title="'+d+'" >'+b+"</div>");$("#dialogsdiv").append(c);if(!a){a={modal:true,buttons:{Ok:function(){$(this).dialog("close")}}}}c.dialog(a);return c}function showConfirmDialog(h,f,g,c,a,d){var e={};e[g]=function(){$(this).dialog("close");if(a){a()}};e[c]=function(){$(this).dialog("close");if(d){d()}};var b={modal:true,buttons:e};return showModalDialog(h,f,b)}function setSongSettingsDirty(a){songSettingsDirty=a;if($refreshButton){$refreshButton.button("option","disabled",!a)}}var $latestAudioElement=null;var exportTimeout=null;var tempTempoEvents=null;function afterExport(b){stopSong();updateRenderStorageAndVisualizer(b);if(b.$audioElement){$latestAudioElement=b.$audioElement;function a(){if($latestAudioElement&&$latestAudioElement[0]){var d=$latestAudioElement[0].currentTime;if(d){var c=predictBeat(tempTempoEvents,d);visualizer.setCurrentPlayBeatTime(c)}exportTimeout=setTimeout(a,100)}}$latestAudioElement.on("play",function(){visualizer.setMode(VisualizerMode.PLAY);visualizer.setCurrentPlayBeatTime(0);a()});$latestAudioElement.on("pause",function(){visualizer.setMode(VisualizerMode.PAUSE)});$latestAudioElement.on("stop",function(){visualizer.setMode(VisualizerMode.STOP);visualizer.setCurrentPlayBeatTime(0)})}else{$latestAudioElement=null}}function joinNotEmpty(a,d){var c=[];for(var b=0;b<a.length;b++){if(a[b]){c.push(a[b])}}return c.join(d)}var exportSupportArr=[(window.ArrayBuffer?"":"Array Buffer"),(window.DataView?"":"Data View"),(window.URL?"":"URL object"),(Modernizr.webworkers?"":"Web Workers"),(Modernizr.blobconstructor?"":"Blob Constructor")];function exportMidi(){var f=Modernizr.webworkers&&Modernizr.blobconstructor&&window.URL&&window.ArrayBuffer&&window.DataView;if(lightServerMode&&!f){showModalDialog("Midi Export Not Supported by this browser","The browser need support for "+joinNotEmpty(exportSupportArr,", "))}else{var a=getMainSeed();var e=getGenInfo();copyWithPropertyInfoProvider(e,midiExportSettings);delete e.export2;var c={seed:a,strSeed:songSettings.seed,name:songSettings.name,sectionIndex:-1,genInfo:e};var d={taskType:AsyncServerChildTaskType.EXPORT_MIDI,content:c,caption:"Exporting midi...",doneCaption:"Done!",resultDivId:"midi-export-result-div",onSuccess:function(g){afterExport(g)},id:"task"+asyncOperationCounter};var b=null;if(f){d.taskType=WorkerTaskType.EXPORT_MIDI;b=new AsyncWorkerTask(d)}else{b=new AsyncServerChildTask(d)}addAsyncOperation(b)}}function exportWav(){var f=Modernizr.webworkers&&Modernizr.blobconstructor&&window.URL&&window.ArrayBuffer&&window.DataView;if(lightServerMode&&!f){showModalDialog("Wav Export Not Supported by this browser","The browser need support for "+joinNotEmpty(exportSupportArr,", "))}else{var a=getMainSeed();var e=getGenInfo();if(f){copyWithPropertyInfoProvider(e,wavClientExportSettings)}else{copyWithPropertyInfoProvider(e,wavExportSettings)}delete e.export2;var c={seed:a,strSeed:songSettings.seed,name:songSettings.name,sectionIndex:-1,genInfo:e};var d={taskType:AsyncServerChildTaskType.EXPORT_WAV,content:c,caption:"Exporting wav...",doneCaption:"Done!",resultDivId:"wav-export-result-div",onSuccess:function(g){afterExport(g)},id:"task"+asyncOperationCounter};var b=null;if(f){d.taskType=WorkerTaskType.EXPORT_WAV;b=new AsyncWorkerTask(d)}else{b=new AsyncServerChildTask(d)}addAsyncOperation(b)}}function exportIT(){showModalDialog("","IT export not implemented.")}function savePreset(){var a=getMainSeed();var d=getGenInfo();copyWithPropertyInfoProvider(d,mp3ExportSettings);var c={seed:a,sectionIndex:-1,genInfo:d};var b=new AsyncServerChildTask({taskType:AsyncServerChildTaskType.SAVE_PRESET,content:c,caption:"Saving preset...",doneCaption:"Done!",requireLogin:false,resultDivId:"",id:"task"+asyncOperationCounter});addAsyncOperation(b)}function exportMp3(){if(lightServerMode){showModalDialog("Mp3 Export Not Supported","The server doesn't support this operation and you can not do this in the browser yet.")}else{var a=getMainSeed();var e=getGenInfo();copyWithPropertyInfoProvider(e,mp3ExportSettings);var d={seed:a,sectionIndex:-1,genInfo:e};var c=false;var b=new AsyncServerChildTask({taskType:AsyncServerChildTaskType.EXPORT_MP3,content:d,caption:"Exporting mp3...",doneCaption:"Done!",resultDivId:"mp3-export-result-div",onSuccess:function(f){afterExport(f)},id:"task"+asyncOperationCounter});addAsyncOperation(b)}}function exportOgg(){if(lightServerMode){showModalDialog("Mp3 Export Not Supported","The server doesn't support this operation and you can not do this in the browser yet.")}else{var a=getMainSeed();var e=getGenInfo();copyWithPropertyInfoProvider(e,oggExportSettings);var d={seed:a,sectionIndex:-1,genInfo:e};var c=getFirstRunningServerTaskWithType(AsyncServerChildTaskType.EXPORT_OGG);var b=new AsyncServerChildTask({taskType:AsyncServerChildTaskType.EXPORT_OGG,content:d,caption:"Exporting ogg...",doneCaption:"Done!",resultDivId:"ogg-export-result-div",onSuccess:function(f){afterExport(f)},id:"task"+asyncOperationCounter});addAsyncOperation(b)}}function updateAsyncOperations(){var a=[];for(var b=0;b<asyncOperations.length;b++){var c=asyncOperations[b];c.update();if(!c.done&&!c.cancelled){a.push(c)}}asyncOperations=a;if(asyncOperations.length>0){setTimeout(updateAsyncOperations,500)}}function addAsyncOperation(a){if(!a){return false}if(loggedIn||!a.requireLogin){asyncOperations.push(a);a.start();updateAsyncOperations();asyncOperationCounter++;return true}else{showModalDialog("Not logged in","You must log in to export or compose new songs.");return false}}function logit(a){console.log(a)}function getFirstRunningServerTaskWithType(b){for(var a=0;a<asyncOperations.length;a++){var c=asyncOperations[a];if(c.taskType==b){return c}}return null}function createExportPanel(){var b=["Midi","Mp3","Ogg","IT"];var c=[midiExportSettings,mp3ExportSettings,oggExportSettings,itExportSettings];var a=[midiExportSettingsPresets,mp3ExportSettingsPresets,oggExportSettingsPresets,itExportSettingsPresets];if(lightServerMode){b.length=1;c.length=1;a.length=1}SongSettingsComponent.createTabs($("#exportDialogDiv"),"exportTab","export-panel",b,c,function(){settingsDirty=true},a);if(lightServerMode){$("#exportTab0").prepend($('<div id="midi-export-result-div" ></div>'))}else{$("#exportTab0").prepend($('<div id="midi-export-result-div" ></div>'));$("#exportTab1").prepend($('<div id="mp3-export-result-div" ></div>'));$("#exportTab2").prepend($('<div id="ogg-export-result-div" ></div>'));$("#exportTab3").prepend($('<div id="it-export-result-div" ></div>'))}}function createSongInfoPanel(){var a=$("#songInfoTabs");a.tabs()}function getSongPartName(c,b){var e="Part";var a=b.indexInfos[c];var d=b.songPartTypes[c];if(a.isIntro){e="Intro"}else{if(a.isEnd){e="End"}else{if(a.isConnectGroup){e="Connect";if(a.isPostfixGroup){e="Postfix"}else{if(a.isPrefixGroup){e="Prefix"}}}else{switch(d){case 0:case 1:e="Verse "+(d+1);break;case 2:case 3:e="Chorus "+(d-1);break;case 4:case 5:e="Bridge "+(d-3);break;case 6:case 7:e="Misc "+(d-5);break}if(a.phraseGroupCount>1){e+=", "+(a.phraseGroupIndex+1)}}}}return e}function updateSongInfoPanel(){var h=$("#songInfoTabStructure");var b=$("#songInfoTabInstruments");b.empty();h.empty();var p=renderStorage.songStructureInfo;var c=["evenTableRow","oddTableRow"];if(p){var o=p.indexInfos;var m=[];m.push('<table class="songInfoInstrumentsTable">');var k=0;function l(u,q){var r=c[k%c.length];m.push('<tr class="'+r+'">');m.push("<td>"+u+"</td>");for(var s=0;s<q.length;s++){var t=""+q[s];m.push("<td>"+t+"</td>")}k++}if(o){var g=c[k%c.length];m.push('<tr class="'+g+'">');m.push("<td>Type</td>");for(var f=0;f<o.length;f++){var n=getSongPartName(f,p);m.push("<td>"+n+"</td>")}m.push("</tr>");k++;l("Harmony Rythm",p.harmonyRythmIndices);l("Harmony Char.",p.harmonyExtraIndices);l("Melody Shape",p.melodyShapeIndices);l("Bass Shape",p.bassShapeIndices);l("Melody Motif Dist.",p.melodyMotifDistributionIndices);l("Bass Motif Dist.",p.bassMotifDistributionIndices);l("Inner 1 Motif Dist.",p.inner1MotifDistributionIndices);l("Inner 2 Motif Dist.",p.inner2MotifDistributionIndices);l("Percussion Dist.",p.percussionMotifDistributionIndices);l("Percussion Fill Dist.",p.percussionFillMotifDistributionIndices);l("Melody Instr.",p.melodyChannelDistributionIndices);l("Bass Instr.",p.bassChannelDistributionIndices);l("Inner 1 Instr.",p.inner1ChannelDistributionIndices);l("Inner 2 Instr.",p.inner2ChannelDistributionIndices);l("Melody Effects",p.sequentialMelodyEffectChangeIndices);l("Bass Effects",p.sequentialBassEffectChangeIndices);l("Inner 1 Effects",p.sequentialInner1EffectChangeIndices);l("Inner 2 Effects",p.sequentialInner2EffectChangeIndices);l("Percussion Effects",p.sequentialPercussionEffectChangeIndices)}m.push("</table>");h.append(m.join(""))}var e=renderStorage.channelMaps;if(e){var m=[];m.push('<table class="songInfoInstrumentsTable">');for(var f=0;f<e.length-1;f++){var g=c[f%c.length];m.push('<tr class="'+g+'">');var d=e[f];var j=MidiProgram.toString(d.program);var a="Unknown";switch(f){case 0:case 1:case 2:a="Melody instrument "+(f+1);break;case 3:case 4:case 5:a="Inner 1 instrument "+(f+2);break;case 6:case 7:case 8:a="Inner 2 instrument "+(f-5);break;case 9:case 10:case 11:a="Bass instrument "+(f-8);break}m.push("<td>"+a+"</td>");m.push("<td>"+j+"</td>");m.push("</tr>")}m.push("</table>");b.append(m.join(""))}}function deleteSong(a,b){showConfirmDialog("Really delete?","Do you really want to delete the song?","Yes","No",function(){var d={songIndex:a};var c=new AsyncServerChildTask({taskType:AsyncServerChildTaskType.DELETE_SONG,content:d,caption:"Deleting song...",doneCaption:"Done!",resultDivId:"",onDone:function(e){b()},id:"task"+asyncOperationCounter});addAsyncOperation(c)},function(){})}function renameSong(a,b,e){var d={newName:b,songIndex:a};var c=new AsyncServerChildTask({taskType:AsyncServerChildTaskType.RENAME_SONG,content:d,caption:"Renaming song...",doneCaption:"Done!",resultDivId:"",onDone:function(f){e()},id:"task"+asyncOperationCounter});addAsyncOperation(c)}function overwriteSong(f,e){var b=getMainSeed();var d=songSettings.name;var g=getGenInfo();copyWithPropertyInfoProvider(g,mp3ExportSettings);var a={seed:b,songName:d,prefix:e.prefix,genInfo:g};var c=new AsyncServerChildTask({taskType:AsyncServerChildTaskType.OVERWRITE_SONG,content:a,caption:"Overwriting song...",doneCaption:"Done!",resultDivId:"",onDone:function(){loadMySongsList()},id:"task"+asyncOperationCounter});if(!addAsyncOperation(c)){logit("Failed to add async op for overwrite song?")}}function completeGenInfo(d){var b=new GenInfo();for(var e in b){if(!stringEndsWith(e,"Seed")){var a=b[e];var c=d[e];if(!isFunction(a)&&typeof(c)==="undefined"){d[e]=copyValueDeep(a)}}}}function updateSongSettingsComponent(e,d){var a="songSettingsTab";completeGenInfo(e);var b=[d,getSeedStringsObject(songStructureSeedSettings,e),getSeedStringsObject(songContentSeedSettings,e),getSeedStringsObject(songIndicesSeedSettings,e),copyWithPropertyInfoProvider(null,songParameters,e),copyWithPropertyInfoProvider(null,songDomains,e),copyWithPropertyInfoProvider(null,songDetails,e)];for(var c=0;c<b.length;c++){SongSettingsComponent.changeComponentValue(b[c],songSettingsCompInfo.createdComps,c,a,songSettingsCompInfo.changeListener)}}function loadSong(d,a,c){function b(){var e=d+"/"+a.prefix+".json";$.ajax(e,{complete:function(g,j){if(j=="success"){var f=$.parseJSON(g.responseText);if(f){var i=f.genInfo;var h={name:a.name||"Song",seed:""+f.seed};updateSongSettingsComponent(i,h);if(f.channelMaps&&f.renderData){stopSong();renderStorage.channelMaps=f.channelMaps;renderStorage.renderData=f.renderData;renderStorage.renderDataLength=Math.max(1,f.renderDataLength);renderStorage.dirty=true;settingsDirty=true;visualizer.resetRenderData();visualizer.addRenderData(renderStorage.renderData,renderStorage.renderDataLength);setSongSettingsDirty(false)}else{settingsDirty=true;setSongSettingsDirty(false);if(loggedIn){renderSong(function(){stopSong()})}}}}else{console.log("Failed to load song: "+e)}},type:"GET"})}if(songSettingsDirty&&loggedIn&&!c){showConfirmDialog("Load?","Really load the song? This will overwrite the current song settings","Yes","No",function(){b()},function(){})}else{b()}}function loadPresetSong(a,b){loadSong("songpresets",a,b)}function getUserInfo(a,c,b){if(lightServerMode){}else{$.ajax("task",{data:JSON.stringify({type:"getUserInfo"}),contentType:"application/json",complete:function(e,f){if(f=="success"){var d=$.parseJSON(e.responseText);if(a){a(d)}}else{if(c){c(e,f)}}if(b){b(e,f)}},type:"POST"})}}function loadMySongsList(){if(lightServerMode){}else{$("#my-songs-song-list").remove();var a="users/"+userToDirName(user);var b=a+"/index.json";var c=$("#my-songs-tab");getUserInfo(function(d){if(d&&d.songs){createSongList(d,c,a,"my-songs","Song",true,true,true)}else{console.log("Did not get a valid UserInfo from server.")}},function(d,e){console.log("Did not get an answer for getUserInfo from server. Text status not success: "+e)})}}function createLoadButton(d,c,b,a){var e=b.find("#"+d);e.button();e.click(function(){loadSong(a,c)})}function createOverwriteButton(d,c,b,a){var e=b.find("#"+d);e.button();e.click(function(){overwriteSong(a,c)})}function createDeleteButton(c,e,d,b,a){var f=b.find("#"+c);f.button();f.click(function(){deleteSong(d,function(){loadMySongsList()})})}function createRenameButton(c,e,d,b,a){var f=b.find("#"+c);f.button();f.click(function(){})}function createSongList(A,r,n,f,h,s,p,a){var D=A.songs;var t="";t+='<ol id="'+f+'-song-list" class="song-list" >';var B="margin-right: 0.5em;";for(var x=0;x<D.length;x++){var l=D[x];var q=l.name;if(!q){q=h+" "+(x+1)}var z="<tr><td>"+q+"</td>";var e=1;var d=1;if(l.soundfonts&&l.soundfonts.length>0){var y=l.soundfonts[0];var w=n+"/"+l.prefix;var c=w+".mid";var E=w+"_"+y+".mp3";var g=w+"_"+y+".ogg";z+='<td><a style="'+B+'" href="'+c+'" >Midi</a>';z+='<a style="'+B+'" href="'+E+'" >Mp3</a>';z+='<a style="'+B+'" href="'+g+'" >Ogg</a></td>';d+=1}z+="<td>";d+=1;if(p){var o=f+"-delete-song-button-"+x;z+='<button id="'+o+'" >Delete</button>'}if(a){var v=f+"-rename-song-button-"+x;z+='<button id="'+v+'" >Rename</button>'}if(s){var m=f+"-load-song-button-"+x;z+='<button id="'+m+'" >Load</button>'}z+="</td>";z+="</tr>";e=d;d=0;t+='<table style="margin: 0px; padding: 0px; border: 0px; width: 100%" class="ui-widget-content" >';t+="<colgroup>";var C=100/e;for(var u=0;u<e;u++){t+='<col span="1" style="width: '+Math.round(C)+'%;">'}t+="</colgroup>";t+=z;t+="</table>"}t+="</ol>";var b=$(t);r.append(b);for(var x=0;x<D.length;x++){var l=D[x];if(s){var k=f+"-load-song-button-"+x;createLoadButton(k,l,r,n)}if(p){var k=f+"-delete-song-button-"+x;createDeleteButton(k,D,x,r,n)}if(a){var k=f+"-rename-song-button-"+x;createRenameButton(k,D,x,r,n)}}}function createSongsPanel(){if(loggedIn&&user){$("#songtabs ul").append($('<li><a href="#my-songs-tab">My Songs</a></li>'));var a="";a+='<button id="save-song-button">Save Current Song</button>';$("#songtabs").append($('<div id="my-songs-tab" >'+a+"</div> "))}$("#save-song-button").button().click(function(){var c=getMainSeed();var e=songSettings.name;var f=getGenInfo();copyWithPropertyInfoProvider(f,mp3ExportSettings);var g={seed:c,songName:e,genInfo:f};var d=new AsyncServerChildTask({taskType:AsyncServerChildTaskType.SAVE_SONG,content:g,caption:"Saving song...",doneCaption:"Done!",resultDivId:"",onDone:function(){loadMySongsList()},id:"task"+asyncOperationCounter});if(!addAsyncOperation(d)){logit("Failed to add async op for saving song?")}});$("#songtabs").tabs();var b=$("#example-songs-tab");$.ajax("songpresets/index.json",{complete:function(d,f){if(f=="success"){var c=$.parseJSON(d.responseText);if(c){createSongList(c,b,"songpresets","preset","Song Example",true,false,false);var e=c.songs;if(!renderStorage.renderData&&e.length>0){loadPresetSong(e[0],true)}}}else{console.log("Failed to get preset songs: "+f)}},type:"GET"});if(loggedIn&&user){loadMySongsList()}}function UserInfo(){this.name="";this.email="";this.subscribe=false;this.acceptedTOU=false;this._constructorName="UserInfo"}function sendSimpleCommand(a){$.ajax("task",{data:JSON.stringify(a),contentType:"application/json",complete:function(b,c){if(c=="success"){}else{logit("Failed to send simple command:");logit(a)}},type:"POST"})}function updateUserInfo(a){if($updateUserInfoButton){$updateUserInfoButton.button("disable")}sendSimpleCommand({type:"updateUserInfo",name:userInfo.name,email:userInfo.email,subscribe:userInfo.subscribe,acceptedTOU:userInfo.acceptedTOU});if(a){showModalDialog("User info updated","<p>Your personal information will only be used for support, unless you subscribe to the newsletter.</p>")}}var $updateUserInfoButton=null;function createAccountPanel(){if(lightServerMode){}else{loggedIn=false;var a=null;getUserInfo(function(c){if(c._constructorName=="UserInfo"){loggedIn=true;userInfo=c;if(typeof(userInfo.name)=="undefined"){userInfo.name=""}if(typeof(userInfo.email)=="undefined"){userInfo.email=""}if(typeof(userInfo.subscribe)=="undefined"){userInfo.subscribe=false}if(typeof(userInfo.acceptedTOU)=="undefined"){userInfo.acceptedTOU=false}function b(){if(allLoaded){showAcceptTermsOfUseIfNecessary()}else{setTimeout(b,100)}}b()}else{console.log(c)}},function(b,c){console.log("Failed to get user info in account panel "+c)},function(){var e="<p></p>";if(loggedIn){e='<form action="logout" method="get" id="logout_form"><fieldset><div id="logout_input_area"><input id="openid_submit" type="submit" value="Log Out"/></div></fieldset></form>';var d=new GuiPropertiesComponent({object:userInfo,propertyInfoProvider:propertyInfoProvider});d.changeListeners.push(function(){if($updateUserInfoButton){$updateUserInfoButton.button("enable")}});var f=[];d.createJQueryStrings(f);e+=f.join("");e+='<button id="updateUserInfoButton" >Submit personal info</button>'}else{e='<form action="auth" method="get" id="openid_form"><input type="hidden" name="action" value="verify" /><fieldset><legend>Sign-in or Create New Account</legend><div id="openid_choice"><p>Please click your account provider:</p><div id="openid_btns"></div></div><div id="openid_input_area"><input id="openid_identifier" name="openid_identifier" type="text" value="http://" /><input id="openid_submit" type="submit" value="Sign-In"/></div><noscript><p>OpenID is service that allows you to log-on to many different websites using a single identity.Find out <a href="http://openid.net/what/">more about OpenID</a> and <a href="http://openid.net/get/">how to get an OpenID enabled account</a>.</p></noscript></fieldset></form>'}e+='<p><button id="touButton" >Terms of use</button></p>';var b=$(e);var c=$("#accountDialogDiv");c.append(b);$updateUserInfoButton=$("#updateUserInfoButton");$updateUserInfoButton.button().click(function(){updateUserInfo(true)});$updateUserInfoButton.button("disable");$touButton=$("#touButton");$touButton.button().click(function(){showTermsOfUse()});openid.init("openid_identifier");c.find("#openid_submit").button();if(d){d.jQueryCreated(c);d.alignComponents()}})}}function createTutorialsPanel(){var b=$("#tutorialtabs");var a=["<ul>"];a.push('<li><a href="tutorials/info.html">Info</a></li>');for(var c=1;c<=5;c++){a.push('<li><a href="tutorials/tutorial_'+c+'.html">Tutorial '+c+"</a></li>")}a.push("</ul>");b.append($(a.join("")));b.tabs()}function createPlayerPanel(){var k=$("#playerDialogDiv");if(AudioPlayerConstructor){var g=["wa"];var p=["rewind","play","stop","forward"];var e=["seek-prev","play","stop","seek-next"];for(var f=0;f<g.length;f++){var l=g[f];for(var h=0;h<p.length;h++){var c=$("#"+l+p[h]+"button");var n=e[h];c.button({text:false,icons:{primary:"ui-icon-"+n}})}}var b=$("#waPlayerDiv");var d=[AudioPlayerConstructor.prototype.title];var m=[webAudioPlayerSettings];var a=null;var o=SongSettingsComponent.createTabs(k,"playerSettingsTab","player-settings-panel",d,m,function(i,j,q){settingsDirty=true},a);b.detach();$("#playerSettingsTab0").prepend(b);return o}else{k.remove();return null}}function createVisualizerSettingsPanel(){var c=["Visualizer","Interface"];var d=[visualizer3DSettings,themeSettings];var a=null;var e="visualizerSettingsTab";var b="visualizer-settings-panel";SongSettingsComponent.createTabs($("#visualizerSettingsDialogDiv"),e,b,c,d,function(f,g,h){settingsDirty=true},a)}function createSongSettingsPanel(){var f=$("#songSettingsDialogDiv");var d=["Song","Structure Seeds","Content Seeds","Indices Seeds","Parameters","Domains","Details"];var e=[songSettings,songStructureSeedSettings,songContentSeedSettings,songIndicesSeedSettings,songParameters,songDomains,songDetails];var a=[songSettingsPresets,songStructureSeedSettingsPresets,songContentSeedSettingsPresets,songIndicesSeedSettingsPresets,songParametersPresets,songDomainsPresets,songDetailsPresets];var c=[false,true,true,true,false,false,false];var b="songSettingsTab";return SongSettingsComponent.createTabs(f,b,"settings-panel",d,e,function(g,h,i){settingsDirty=true;setSongSettingsDirty(true);if(getFirstRunningServerTaskWithType(AsyncServerChildTaskType.RENDER)){songSettingsChangedWhileRendering=true}},a,c)}function updateGuiFromEditorSettings(c){for(var b=0;b<c.length;b++){var a=c[b];var d=$("#"+a+"DialogDiv");var f=editorSettings[a+"Position"];if(f){d.dialog("option","position",{my:"left top",at:"left+"+f[0]+" top+"+f[1]})}else{logit("Could not find pos for "+a)}var e=!!editorSettings[a+"Visible"];if(!e){d.dialog("close")}}}function createDialogAndToggle(h,i,b,e){var f=$("#buttonsDiv");f.append($('<input type="checkbox" checked="checked" id="'+h+'DialogShow"/><label class="toggle-button" for="'+h+'DialogShow">'+i+"</label>"));var a=$("#"+h+"DialogShow");var d=$("#"+h+"DialogDiv");d.dialog({closeText:"hide",width:b,resizable:false,show:{effect:"fade",duration:"fast"},create:function(j,l){var k=$(this).dialog("widget");$(".ui-dialog-titlebar-close span",k).removeClass("ui-icon-closethick").addClass("ui-icon-minusthick")},dragStop:function(j,k){editorSettings[h+"Position"]=[k.position.left,k.position.top];settingsDirty=true;editorSettings.dirty=true}});d.dialog("option","position",{my:"center",at:e});var c=d.dialog("widget");if(themeSettings.transparentDialogs){c.addClass("transparent");d.addClass("very-transparent")}function g(){if(visualizer&&!visualizer.mouseCanvasDown){c.removeClass("transparent");d.removeClass("very-transparent");d.removeClass("transparent")}}c.on("mousedown",function(){g();d.dialog("moveToTop");d.data("dragging",true)});c.on("mouseup",function(){g();d.data("dragging",false)});c.on("mouseenter",function(){if(visualizer&&!visualizer.mouseCanvasDown){g()}});c.on("mouseleave",function(){if(themeSettings.transparentDialogs&&!d.data("dragging")){c.addClass("transparent");d.addClass("very-transparent");d.removeClass("transparent")}});d.on("dialogclose",function(){a[0].checked=false;a.button("refresh");editorSettings[h+"Visible"]=false;editorSettings.dirty=true;settingsDirty=true});d.css("max-height","35em");d.on("dialogopen",function(){editorSettings[h+"Visible"]=true;editorSettings.dirty=true;settingsDirty=true});a.button().on("change",function(){var j=d.dialog("isOpen");if(this.checked&&!j){d.dialog("open")}else{if(!this.checked&&j){d.dialog("close")}}})}function stopSong(){if(audioPlayer){audioPlayer.stop()}visualizer.clearHighlightNotes();visualizer.setMode(VisualizerMode.STOP);if(audioPlayer){visualizer.setCurrentPlayBeatTime(audioPlayer.songPlayBeatTime)}$playButton.button("option","icons",{primary:"ui-icon-play"})}var termsOfUseContent=["<p>","<ul>","<li>All songs that are generated through this site (abundant-music.com) are public domain by default. Users do not get copyright of any generated song, but since the songs are public domain, they can be used commercially.</li>","<li>The user is responsible that the generated songs or their use do not infringe any other copyrights. In such cases, the generated songs are not public domain.</li>","<li>It is not allowed to use this site as an API. It is only allowed to use through abundant-music.com's graphical user interface. It is not allowed to use the site in parallel from several computers with same login.</li>","<li>The site uses cookies, which are small files stored on the user's computer. The cookies on the site are only used to determine whether users are logged in or not.</li>","</ul>","<p>","<p>Note that these terms of use may change.</p>"];function showTermsOfUse(){showModalDialog("Terms of Use",termsOfUseContent.join(""),{resizable:false,draggable:false,width:"40em",modal:true,closeOnEscape:false,buttons:{OK:function(){$(this).dialog("close")}}})}function showAcceptTermsOfUseIfNecessary(){if(userInfo&&!userInfo.acceptedTOU){showModalDialog("Terms of Use",termsOfUseContent.join(""),{resizable:false,draggable:false,beforeClose:function(){if(!userInfo.acceptedTOU){return false}},width:"40em",modal:true,closeOnEscape:false,buttons:{"I Accept":function(){userInfo.acceptedTOU=true;updateUserInfo(false);$(this).dialog("close")},Logout:function(){window.location.href="logout"}}})}}function updateRenderStorageAndVisualizer(a){renderStorage.channelMaps=a.resultChannelMaps;renderStorage.channelMaps=a.resultChannelMaps;renderStorage.renderData=a.resultRenderData;renderStorage.sectionTimes=a.resultSectionTimes;renderStorage.songStructureInfo=a.resultSongStructureInfo;renderStorage.renderDataLength=Math.max(1,a.resultRenderDataLength);renderStorage.dirty=true;settingsDirty=true;tempTempoEvents=copyValueDeep(gatherEventsWithType(renderStorage.renderData.events,"t"));visualizer.resetRenderData();visualizer.addRenderData(renderStorage.renderData,renderStorage.renderDataLength);visualizer.setSectionInfos(a.resultSectionTimes,a.resultSongStructureInfo);updateSongInfoPanel();if(!songSettingsChangedWhileRendering){setSongSettingsDirty(false)}}function renderSong(f,b,e){if(lightServerMode&&!window.Worker){showModalDialog("Not Supported","The server doesn't support this operation and you need a browser with WebWorker support to do this in the client.")}else{songSettingsChangedWhileRendering=false;var a=getMainSeed();var d={seed:a,sectionIndex:-1,genInfo:getGenInfo()};var g={taskType:WorkerTaskType.RENDER,content:d,caption:"Composing song...",doneCaption:"Done!",onSuccess:function(h){updateRenderStorageAndVisualizer(h);if(f){f()}},onCancel:function(h){if(b){b()}},onFail:function(h){if(e){e()}},id:"task"+asyncOperationCounter};var c=null;if(window.Worker){c=new AsyncWorkerTask(g)}else{if(lightServerMode){showModalDialog("No Web Worker Support Detected","This browser doesn't support web workers, which is necessary when Abundant Music runs on a lightweight server")}else{g.taskType=AsyncServerChildTaskType.RENDER;c=new AsyncServerChildTask(g)}}if(!addAsyncOperation(c)){if(e){e()}}}}var first=true;function setVisualizerSize(){var a=window.innerWidth;var b=window.innerHeight;if(!a||!b){var d=$(document);a=d.innerWidth();b=d.innerWidth()}if(first){$body=$("body");var e=clamp(Math.min(a,b)/1000,0.5,2);var c=16*e;$body.css("font-size",c+"px");first=false}visualizer.resized(a,b)}function sendFeedback(){var a=$("#feedbackTextArea").val();if(a){sendSimpleCommand({type:"giveFeedback",feedback:a});showModalDialog("Feedback sent","<p>Thanks a lot!</p>")}else{showModalDialog("Feedback info","<p>Feedback text empty?</p>")}}function composeSetup1(){loggedIn=$.cookie("loggedin")=="true";user=decodeURIComponent($.cookie("loggedinuser"));var e=$(window);var f=$("#canvasfor2dcontext");var b=f[0];var d=Date.now();if(Modernizr.webgl&&!visualizer3DSettings.forceContext2D){var c={addBloom:visualizer3DSettings.addBloom,addSimulatedAA:visualizer3DSettings.addSimulatedAA,addVignette:visualizer3DSettings.addVignette};try{visualizer=new WebGLVisualizer3D(b,c);usingWebGL=true}catch(a){console.log(a);console.log("Error when initializing webgl. Using 2D context.");visualizer=new CanvasVisualizer3D(b,d);visualizer3DSettings.forceContext2D=true}}else{visualizer=new CanvasVisualizer3D(b,d)}e.on("resize",function(){setVisualizerSize();visualizer.render()});setVisualizerSize();setTimeout(composeSetup2,loaderTimeout);updateLoaderProgress(70)}function composeSetup2(){songSettingsCompInfo=createSongSettingsPanel();setTimeout(composeSetup3,loaderTimeout);updateLoaderProgress(80)}function composeSetup3(){createVisualizerSettingsPanel();createExportPanel();createSongInfoPanel();createPlayerPanel();createAccountPanel();createTutorialsPanel();$("#helpTabs").tabs();createSongsPanel();setTimeout(composeSetup4,loaderTimeout);updateLoaderProgress(90)}function composeSetup4(){var c=$("#feedbackDialogDiv");if(!loggedIn){c.empty();c.append("Log in to enable feedback. Thanks!")}else{c.find("#submitFeedbackButton").button().click(function(){sendFeedback();c.find("#feedbackTextArea").val("")})}var t=["songSettings","songInfo","player","visualizerSettings","tutorials","songs","export","help","feedback","account"];var a=["Song Settings","Song Info","Player","Visual Settings","Tutorials","Songs","Export","Help/Credits","Feedback","Account"];var g=["60em","60em",Modernizr.webaudio?"45em":null,"45em","55em","45em","45em","50em",lightServerMode?null:"45em",lightServerMode?null:"40em"];var m=["right","right top","right","top","left","top","top","left","left","left"];for(var p=0;p<t.length;p++){var q=t[p];var l=g[p];var s=a[p];if(l){createDialogAndToggle(q,s,l,m[p])}else{var u=$("#"+q+"DialogDiv");u.remove()}}$refreshButton=$('<button style="margin-left: 1em;">Compose</button>');var r=$("#buttonsDiv");r.append($refreshButton);$refreshButton.button({icons:{primary:"ui-icon-locked"}});$refreshButton.click(function(){if(songSettingsDirty){$refreshButton.button("option","disabled",true);renderSong(function(){},function(){$refreshButton.button("option","disabled",false)},function(){$refreshButton.button("option","disabled",false)})}});updateGuiFromEditorSettings(t);$playButton=$("#waplaybutton");$stopButton=$("#wastopbutton");$forwardButton=$("#waforwardbutton");$rewindButton=$("#warewindbutton");var e=10;function o(){var i=500;if(audioPlayer){var w=Date.now();audioPlayer.step();var y=Date.now();var x=y-w;e=0.95*e+0.05*x;if(audioPlayer.mode==AudioPlayerMode.PLAY){visualizer.setCurrentPlayBeatTime(audioPlayer.songPlayBeatTime);i=100}}setTimeout(o,i)}function v(){if(audioPlayer==null){audioPlayer=new AudioPlayerConstructor()}$latestAudioElement=null;audioPlayer.soundFontType=webAudioPlayerSettings.soundFontType;audioPlayer.settings=webAudioPlayerSettings;audioPlayer.setRenderData(renderStorage.renderData);audioPlayer.setChannelMaps(renderStorage.channelMaps);function i(){audioPlayer.play();visualizer.setMode(VisualizerMode.PLAY);visualizer.setCurrentPlayBeatTime(audioPlayer.songPlayBeatTime);$playButton.button("option","icons",{primary:"ui-icon-pause"})}audioPlayer.getReadyForPlay(function(){$playButton.button("option","disabled",false);i()},function(){$playButton.button("option","disabled",false)})}function b(){audioPlayer.pause();visualizer.setMode(VisualizerMode.PAUSE);$playButton.button("option","icons",{primary:"ui-icon-play"})}function j(){if(audioPlayer){audioPlayer.gotoBeat(audioPlayer.songPlayBeatTime+8);visualizer.clearHighlightNotes();visualizer.setCurrentPlayBeatTime(audioPlayer.songPlayBeatTime)}}function f(){if(audioPlayer){audioPlayer.gotoBeat(audioPlayer.songPlayBeatTime-8);visualizer.clearHighlightNotes();visualizer.setCurrentPlayBeatTime(audioPlayer.songPlayBeatTime)}}$playButton.click(function(){if(audioPlayer&&audioPlayer.mode==AudioPlayerMode.PLAY){b()}else{$playButton.button("option","disabled",true);if(songSettingsDirty){renderSong(function(){v()},function(){$playButton.button("option","disabled",false)},function(){logit("kljd");$playButton.button("option","disabled",false)})}else{$playButton.button("option","disabled",true);v()}}});$stopButton.click(function(){stopSong()});$forwardButton.click(function(){j()});$rewindButton.click(function(){f()});function n(){if(settingsDirty){saveSettingsToLocalStorage();settingsDirty=false;logit("Saving settings")}setTimeout(n,500)}n();var k=Date.now();var h=0;function d(){requestAnimationFrame(d);var w=visualizer3DSettings.context2DFps;if(usingWebGL){w=visualizer3DSettings.webGLFps}if(visualizer3DSettings.usePerspective){if(!visualizer.camera.inPerspectiveMode){visualizer.camera.toPerspective()}}else{if(!visualizer.camera.inOrthographicMode){visualizer.camera.toOrthographic()}}var i=clamp(Math.round(60/w),1,60);var y=Date.now();var x=y-k;visualizer.stopMovementMode=visualizer3DSettings.stopMovementMode;visualizer.step(x);h++;if((h%i)==0){if(visualizer3DSettings.on){visualizer.render()}}k=y}d();o();if(renderStorage.renderData){setSongSettingsDirty(false);visualizer.addRenderData(renderStorage.renderData,renderStorage.renderDataLength)}if(renderStorage.songStructureInfo&&renderStorage.sectionTimes){visualizer.setSectionInfos(renderStorage.sectionTimes,renderStorage.songStructureInfo)}updateSongInfoPanel();$("#hider-div").remove();allLoaded=true};